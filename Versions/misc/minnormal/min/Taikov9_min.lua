Split=function(f,g)local h={}for i,j in f:gmatch("([^"..g.."]*)("..g.."?)")do table.insert(h,i)if j==''then return h end end end;Trim=function(f)local g=f:gsub("^%s*(.-)%s*$","%1")return g end;TrimLeft=function(f)local g=f:gsub("^%s*(.-)$","%1")return g end;TrimRight=function(f)local g=f:gsub("^(.-)%s*$","%1")return g end;StartsWith=function(f,g)return f:sub(1,#g)==g end;EndsWith=function(f,g)return f:sub(-#g,-1)==g end;Table={}function Table.Clone(f,g)g=g or{}local h=type(f)local i;if h=='table'then if g[f]then i=g[f]else i={}g[f]=i;for j,k in next,f,nil do i[Table.Clone(j,g)]=Table.Clone(k,g)end;setmetatable(i,Table.Clone(getmetatable(f),g))end else i=f end;return i end;ClipN=function(f,g,h)if f<g then return g elseif f>h then return h else return f end end;function Error(f)error(f)end;LineN=nil;function ParseError(f,g,h)Error('Line: '..LineN..'\n'..f..': '..g.. (h and(', '..h)or''))end;function MsToS(f)return f/1000 end;function SToMs(f)return f*1000 end;Taiko={}Taiko.Data={Languages={'','EN','JA','CN','TW','KO'},GenreName={Pop={'pop','j-pop'},Anime={'anime','アニメ'},Kids={'kids','どうよう'},Variety={'variety','バラエティ'},VOCALOID={'vocaloid','ボーカロイド'},Classic={'classic','クラシック'},['Game Music']={'game music','ゲームミュージック'},['Namco Original']={'namco original','ナムコオリジナル'}},CourseId={easy=0,normal=1,hard=2,oni=3,edit=4,tower=5,dan=6,ura=4},CourseName={[0]='Easy','Normal','Hard','Oni','Edit','Tower','Dan','Ura'},RatingMultiplier={[0]=0,[1]=0.5,[2]=1,[3]=2},ScoreMode={[0]=function(f,g,h,i,j)return f+ ( ( (g<200)and(h or 1000)or( (h or 1000)+ (i or 1000)))*Taiko.Data.RatingMultiplier[j])end,[1]=function(f,g,h,i,j)return f+ (h+math.max(0,i*math.floor((math.min(g,100)-1)/10)))*Taiko.Data.RatingMultiplier[j]end,[2]=function(f,g,h,i,j)return f+ (h+i* ( (g>=100)and 8 or(g>=50)and 4 or(g>=30)and 2 or(g>=10)and 1 or 0))*Taiko.Data.RatingMultiplier[j]end},Autoscore={[0]=function(f)end,[1]=function(f)end,[2]=function(f)end},SideId={normal=1,ex=2,both=3},SideName={'normal','ex','both'},StyleId={single=1,double=2,couple=2},StyleName={'single','double'},Exam={Condition={g=true,jp=true,jg=true,jb=true,s=true,r=true,h=true,c=true},Scope={m=true,l=true}},Branch={PathId={N=0,E=1,M=2},PathName={[0]='N',[1]='E',[2]='M'},Requirements={r=function()end,p=function()end}}}for f,g in pairs(Taiko.Data.ScoreMode)do Taiko.Data.ScoreMode[f]=function(...)return math.floor(g(...)/10)*10 end end;function Taiko.ParseTJA(f)local g=os.clock()local h={}local i={Metadata={BPM=120,WAVE='main.mp3',OFFSET=0,DEMOSTART=0,SCOREMODE=1,SONGVOL=100,SEVOL=100,SIDE=3,LIFE=0,GAME='Taiko',HEADSCROLL=1,MOVIEOFFSET=0,COURSE='ONI',LEVEL=0,BALLOON=nil,SCOREINIT,SCOREDIFF,BALLOONNOR=nil,BALLOONEXP=nil,BALLOONMAS=nil,STYLE=1,EXAM1=nil,EXAM2=nil,EXAM3=nil,GAUGEINCR='NORMAL',TOTAL=nil,HIDDENBRANCH=0,DIVERGENOTES=false,SCOREINIT=0,SCOREDIFF=0},Data={}}local function j(u)local v=Taiko.Data.Languages;for i=1,#v do local w=i.Metadata[u..v[i]]if w then return w end end;return nil end;local function k(u,v,w)local x=tonumber(v)if x then return x else ParseError(u,w,v)end end;local function l(u,v,w,x)if v then return v else ParseError(u,w,x)end end;local function m(u,v,w)local x={['true']=true,['false']=false,yes=true,no=false,['1']=true,['0']=false,[1]=true,[0]=false}local y=x[v]~=nil;if y then return y else ParseError(u,w,v)end end;local function n(u,v)local w=','local x='\\'local y={}local z=''local A=false;for i=1,#v do local B=string.sub(v,i,i)if A then z=z..B;A=false else if B==w then table.insert(y,z)z=''elseif B==x then A=true else z=z..B end end end;table.insert(y,z)return y end;local function o(u,v,w)local x=n(u,v)for i=1,#x do x[i]=k(u,x[i],w,v)end;return x end;local function p(u,v,w)if v and v~=''then return o(u,v,w)else return{}end end;local function q(u,v,w)if v and v~=''then local x=n(u,v,w)l(u,Taiko.Data.Exam.Condition[x[1]],w)x[2]=k(u,x[2],w)x[3]=k(u,x[3],w)l(u,Taiko.Data.Exam.Scope[x[4]],w)return x else return{}end end;local r={}local function s()local u={settings={noteparse={notealias={A=3,B=4},noteexceptions={[',']=true,[' ']=true,['\t']=true}},command={matchexceptions={}}},bpm=0,ms=0,songstarted=false,timingpoint=nil,sign=4 /4,mpm=0,mspermeasure=0,scroll=1,measuredone=true,currentmeasure={},measurepushto=i.Data,barline=true,gogo=false,lastlong=nil,balloonn=1,currentbranch=nil,branch={on=false,requirements={},paths={}},msbeforebranch=nil}function u.createnote(v)if v then local w={ms=nil,data=nil,type=v,txt=nil,gogo=u.gogo,scroll=(u.scroll*i.Metadata.HEADSCROLL),mspermeasure=u.mspermeasure,bpm=u.bpm,nextnote=nil,radius=1,requiredhits=nil,length=nil,endnote=nil,onnotepush=nil}w.type=v;if v==3 or v==4 or v==6 then w.radius=w.radius*1.6 end;if v==5 or v==6 or v==7 or v==9 then if u.lastlong then if v==9 then else ParseError('parser.noteparse','Last long note has not ended')end else u.lastlong=w;if v==7 or v==9 then w.requiredhits=l('parser.noteparse',i.Metadata.BALLOON[u.balloonn],'Invalid number of balloons',u.balloonn)u.balloonn=u.balloonn+1 end end end;if v==8 then local x=u.lastlong;u.lastlong=nil;w.startnote=x;if x then w.onnotepush=function()x.length=w.ms-x.ms;x.endnote=w end else end end;return w else return{ms=nil,data=nil,type=nil,txt=nil,gogo=u.gogo,scroll=(u.scroll*i.Metadata.HEADSCROLL),mspermeasure=u.mspermeasure,bpm=u.bpm,nextnote=nil}end end;function u.endbranch()local v=u.createnote()v.data='event'v.event='branch'v.branch={requirements=u.branch.requirements,paths=u.branch.paths}u.branch.on=false;u.branch.requirements={}u.branch.paths={}table.insert(i.Data,v)u.measurepushto=i.Data end;return u end;r=s()local t=Split(f,'\n')for i=1,#t do LineN=i;local u=Trim(t[i])if StartsWith(u,'//')or u==''then else local v=string.find(u,'//')if v then u=string.sub(u,1,v-1)end;local w=false;if r.songstarted==false and w==false then local x={string.match(u,'(%u+):(.*)')}if x[1]then local y=Trim(x[2])if y~=''then i.Metadata[Trim(x[1])]=y end;w=true end end;if(r.songstarted or StartsWith(u,'#START'))and w==false then local x={string.match(u,'#(%u-)%s(.*)')}if not x[1]then x={string.match(u,'#(%u+)')}end;if x[1]then if x[1]=='START'then if r.songstarted then ParseError(x[1],'Song has already started')else i.OriginalMetadata=Table.Clone(i.Metadata)i.Metadata.TITLE=l(x[1],j('TITLE'),'Title is missing')i.Metadata.SUBTITLE=l(x[1],j('SUBTITLE'),'Subtitle is missing')i.Metadata.BPM=k(x[1],i.Metadata.BPM,'Invalid bpm')i.Metadata.OFFSET=SToMs(k(x[1],i.Metadata.OFFSET,'Invalid offset'))i.Metadata.DEMOSTART=SToMs(k(x[1],i.Metadata.DEMOSTART,'Invalid demostart'))if i.Metadata.DEMOSTART==0 then i.Metadata.DEMOSTART=nil end;for B,C in pairs(Taiko.Data.GenreName)do for i=1,#C do if C[i]==i.Metadata.GENRE then i.Metadata.GENRE=B end end end;i.Metadata.SCOREMODE=k(x[1],i.Metadata.SCOREMODE,'Invalid scoremode')l(x[1],Taiko.Data.ScoreMode[i.Metadata.SCOREMODE],'Invalid scoremode',i.Metadata.SCOREMODE)if i.Metadata.MAKER then i.Metadata.CREATORURLT={}i.Metadata.CREATOR=Trim(string.gsub(i.Metadata.MAKER,'(<.->)',function(B)table.insert(i.Metadata.CREATORURLT,string.sub(B,2,-2))return''end))i.Metadata.CREATORURL=table.concat(i.Metadata.CREATORURLT,', ')i.Metadata.CREATIVE=false else i.Metadata.CREATIVE=false end;i.Metadata.SONGVOL=k(x[1],i.Metadata.SONGVOL,'Invalid songvol')/100;i.Metadata.SEVOL=k(x[1],i.Metadata.SEVOL,'Invalid sevol')/100;local y=tonumber(i.Metadata.SIDE)if y then l(x[1],Taiko.Data.SideName[y],'Invalid side id',i.Metadata.SIDE)i.Metadata.SIDE=y else i.Metadata.SIDE=l(x[1],Taiko.Data.SideId[string.lower(i.Metadata.SIDE)],'Invalid side name',i.Metadata.SIDE)end;i.Metadata.LIFE=k(x[1],i.Metadata.LIFE,'Invalid life')if i.Metadata.LIFE==0 then i.Metadata.LIFE=nil end;i.Metadata.GAME=string.lower(i.Metadata.GAME)if i.Metadata.GAME=='taiko'then elseif i.Metadata.GAME=='jube'then else end;i.Metadata.HEADSCROLL=k(x[1],i.Metadata.HEADSCROLL,'Invalid headscroll')i.Metadata.MOVIEOFFSET=k(x[1],i.Metadata.MOVIEOFFSET,'Invalid movieoffset')local z=tonumber(i.Metadata.COURSE)if z then l(x[1],Taiko.Data.CourseName[z],'Invalid course id',i.Metadata.COURSE)i.Metadata.COURSE=z else i.Metadata.COURSE=l(x[1],Taiko.Data.CourseId[string.lower(i.Metadata.COURSE)],'Invalid course name',i.Metadata.COURSE)end;i.Metadata.LEVEL=ClipN(math.floor(k(x[1],i.Metadata.LEVEL,'Invalid level')),0,10)i.Metadata.BALLOON=p(x[1],i.Metadata.BALLOON,'Invalid balloon')i.Metadata.SCOREINIT=k(x[1],i.Metadata.SCOREINIT,'Invalid scoreinit')i.Metadata.SCOREDIFF=k(x[1],i.Metadata.SCOREDIFF,'Invalid scoreinit')i.Metadata.BALLOONNOR=p(x[1],i.Metadata.BALLOONNOR,'Invalid balloonnor')i.Metadata.BALLOONEXP=p(x[1],i.Metadata.BALLOONEXP,'Invalid balloonexp')i.Metadata.BALLOONMAS=p(x[1],i.Metadata.BALLOONMAS,'Invalid balloonmas')local A=tonumber(i.Metadata.STYLE)if A then l(x[1],Taiko.Data.StyleName[A],'Invalid course id',Taiko.Data.STYLE)i.Metadata.STYLE=A else i.Metadata.STYLE=l(x[1],Taiko.Data.StyleId[string.lower(i.Metadata.STYLE)],'Invalid course name',i.Metadata.STYLE)end;i.Metadata.EXAM1=q(i.Metadata.EXAM1)i.Metadata.EXAM2=q(i.Metadata.EXAM2)i.Metadata.EXAM3=q(i.Metadata.EXAM3)i.Metadata.GAUGEINCR=string.lower(i.Metadata.GAUGEINCR)if i.Metadata.TOTAL then i.Metadata.TOTAL=k(x[1],i.Metadata.TOTAL,'Invalid total')end;i.Metadata.HIDDENBRANCH=m(x[1],i.Metadata.HIDDENBRANCH,'Invalid hiddenbranch')r.bpm=i.Metadata.BPM;r.songstarted=true end elseif x[1]=='END'then if r.songstarted then if#r.currentmeasure~=0 then ParseError(x[1],'Current measure is not empty')end;table.insert(h,i)i={Metadata=Table.Clone(i.OriginalMetadata),Data={}}r=s()r.songstarted=false;r.measurepushto=i.Data else ParseError(x[1],'Song has already ended')end elseif x[1]=='MEASURE'then local y,z=string.match(x[2],'(%d+)/(%d+)')y=k(x[1],y,'Invalid measure')z=k(x[1],z,'Invalid measure')r.sign=(y/z)or r.sign elseif x[1]=='BPMCHANGE'then r.bpm=k(x[1],x[2],'Invalid bpmchange')or r.bpm elseif x[1]=='DELAY'then table.insert(r.currentmeasure,{x[1],SToMs((k(x[1],x[2],'Invalid delay')or 0))})elseif x[1]=='SCROLL'then r.scroll=k(x[1],x[2],'Invalid scroll')or r.scroll;if r.scroll==0 then ParseError(x[1],'Scroll cannot be 0')end elseif x[1]=='GOGOSTART'then r.gogo=true elseif x[1]=='GOGOEND'then r.gogo=false elseif x[1]=='BARLINEOFF'then r.barline=false elseif x[1]=='BARLINEON'then r.barline=true elseif x[1]=='BRANCHSTART'then if r.branch.on then r.endbranch()end;r.msbeforebranch=r.ms;r.branch.on=true;i.Metadata.DIVERGENOTES=true;local y=n(x[1],x[2])local z=l(x[1],Taiko.Data.Branch.Requirements[string.lower(y[1])],'Invalid type',y[1])r.branch.requirements={z}local A=2;while true do if not y[A]then break end;local B=Taiko.Data.Branch.PathName[A-1]if B then r.branch.requirements[B]=y[A]else break end;A=A+1 end elseif Taiko.Data.Branch.PathId[x[1]]then if r.branch.on then r.ms=r.msbeforebranch;r.currentbranch=x[1]r.branch.paths[x[1]]={}r.measurepushto=r.branch.paths[x[1]]else ParseError(x[1],'Branch has not started')end elseif x[1]=='BRANCHEND'then if r.branch.on then r.endbranch()else ParseError(x[1],'Branch has already ended')end elseif x[1]=='SECTION'then elseif x[1]=='LYRIC'then elseif x[1]=='LEVELHOLD'then elseif x[1]=='BMSCROLL'then elseif x[1]=='HBSCROLL'then elseif x[1]=='SENOTECHANGE'then elseif x[1]=='NEXTSONG'then elseif x[1]=='DIRECTION'then elseif x[1]=='SUDDEN'then elseif x[1]=='JPOSSCROLL'then else end;w=true end end;if(r.songstarted)and w==false then r.mpm=r.bpm*r.sign/4;r.mspermeasure=60000 *r.sign*4 /r.bpm;if r.barline and#r.currentmeasure==0 then local x=r.createnote()x.ms=r.ms;x.data='event'x.event='barline'table.insert(r.measurepushto,1,x)end;for i=1,#u do local x=string.sub(u,i,i)if r.settings.noteparse.noteexceptions[x]then else local y=k('parser.noteparse',tonumber(x)or r.settings.noteparse.notealias[x]or x,'Invalid note')if y then local z=r.createnote(y)z.data='note'table.insert(r.currentmeasure,z)end end end;if EndsWith(TrimRight(u),',')then r.mpm=r.bpm*r.sign/4;r.mspermeasure=60000 *r.sign*4 /r.bpm;if#r.currentmeasure==0 then r.ms=r.ms+r.mspermeasure else local x=0;local y=nil;for i=1,#r.currentmeasure do local A=r.currentmeasure[i]if A.data=='note'then y=y or A.mspermeasure;x=x+1 end end;local z=y/x;for i=1,#r.currentmeasure do local A=r.currentmeasure[i]if A[1]=='DELAY'then r.ms=r.ms+A[2]else if A.type~=0 then A.ms=r.ms;local B=i.Data[#i.Data]if B then B.nextnote=A end;table.insert(r.measurepushto,A)if A.onnotepush then A.onnotepush()end;z=A.mspermeasure/x end end;r.ms=r.ms+z end end;r.measuredone=true;r.currentmeasure={}else r.measuredone=false end end end end;print('Parsing Took: '..SToMs(os.clock()-g)..'ms')return h end;function Taiko.Analyze(f)for i=1,#f.Data do end end;function Taiko.GetDifficulty(f,g)local h=Taiko.Data.CourseId[string.lower(g)]or g;for i,j in pairs(f)do if j.Metadata.COURSE==h then return j end end;Error('No difficulty found, '..g)return nil end;function Taiko.ForAll(g,h)local i=1;for i=1,#g do local j=g[i]if j.branch then local k=-1;for l,m in pairs(j.branch.paths)do local o=i;for i2=1,#m do h(m[i2],i2,o)o=o+1 end;k=(k<o)and o or k end;i=k else h(j,i,i)end;i=i+1 end;return g end;function Taiko.GetAllNotes(f)local g={}for h,i in pairs(f)do if i.branch then for j,l in pairs(i.branch.paths)do for i=1,#l do table.insert(g,l[i])end end else table.insert(g,i)end end;return g end;function Taiko.ConnectNotes(f)local g=nil;for i=#f,1,-1 do local h=f[i]h.nextnote=g;g=h end;return f end;function Taiko.ExtractBranch(f,g)return f.branch.paths[g]end;function Taiko.ConnectAll(f)local g=nil;for i=#f,1,-1 do local h=f[i]if h.branch then for j,l in pairs(h.branch.paths)do local m=Taiko.ConnectNotes(l)m[#m].nextnote=g end else h.nextnote=g end;g=h end end;function Taiko.CalculateSpeed(f,g)local h=(g*f.scroll*f.bpm/7500)return h end;function Taiko.CalculateSpeedAll(f,g)for i=1,#f do f[i].speed=Taiko.CalculateSpeed(f[i],g)end;return f end;function Taiko.RenderScale(f)local g={}local h={}local i={}for i=1,#f.Data do local m=f.Data[i]if m.data=='note'then local n=math.floor(m.ms)if math.floor(n)-n==0 then table.insert(g,{n,m.type})table.insert(h,n)else table.insert(i,i)end end end;function gcd2(m,n)if n==0 then return m else return gcd2(n,m%n)end end;function gcdn(m)local n=m[1]for i=2,#m do n=gcd2(n,m[i])end;return n end;local j=gcdn(h)for i=1,#i do local m=g[i[i]]m[1]=math.floor(m[1]/j)*j end;local k=''local l=0;for i=1,#g do g[i][1]=g[i][1]/j;k=k..string.rep(' ',g[i][1]-l)..g[i][2]l=g[i][1]end;return k end;function Taiko.PlaySong(f,g)local h={on=false,fps=60,frames={}}local i=10;local j=1000;local k=4;local l=0;local m=10;local n=0;local o=40;local p=3;local q=1;local r={[1]={color='red'},[2]={color='blue'},[3]={color='red'},[4]={color='blue'},[5]={color='yellow'},[6]={color='yellow'}}o=math.floor(o*k)local s=n+o;p=math.floor(p*k)local t=require('Pixels')local u,v=n,o;local w,x=-m,m;t.Convert.ToDots=function(bb)bb=GetPixelData(bb)local cb,db=bb.Data,bb.Color;local eb={}local fb=string.rep('0',8)local gb=t.Data.Dot[fb]local hb=nil;local ib=nil;local jb=tostring(t.Color('reset'))if bb.Color.All then local kb=tostring(t.Color(bb.Color.All))table.insert(eb,kb)ib=kb end;if not w then return''end;for y=w,x,4 do for x=u,v,2 do local kb=cb[x]local lb=cb[x+1]local mb=( (kb)and( (kb[y]or'0').. (kb[y+1]or'0').. (kb[y+2]or'0').. (kb[y+3]or'0'))or'0000').. ( (lb)and( (lb[y]or'0').. (lb[y+1]or'0').. (lb[y+2]or'0').. (lb[y+3]or'0'))or'0000')if mb~=fb then mb=t.Data.Dot[mb]if not ib then local nb=db[x]local ob=db[x+1]local pb=( (nb)and(nb[y]or nb[y+1]or nb[y+2]or nb[y+3]))or( (ob)and(ob[y]or ob[y+1]or ob[y+2]or ob[y+3]))if pb then pb=tostring(t.Color(pb))else pb=jb end;if hb==pb then else table.insert(eb,pb)hb=pb end end;table.insert(eb,mb)else table.insert(eb,gb)end end;table.insert(eb,t.Data.NewLine)end;table.insert(eb,jb)return table.concat(eb)end;t.Circle=function(bb,cb,db,eb,fb)str=GetPixelData(bb)fb=fb or{}local gb=fb.color;local hb=eb*eb;local ib=eb;for y=0,eb do ib=ib+1;repeat ib=ib-1 until ib*ib+y*y<=hb;for x2=0,ib do str.Data[cb+x2]=str.Data[cb+x2]or{}str.Data[cb-x2]=str.Data[cb-x2]or{}str.Data[cb+x2][db+y]='1'str.Data[cb-x2][db+y]='1'str.Data[cb+x2][db-y]='1'str.Data[cb-x2][db-y]='1'str.Color[cb+x2]=str.Color[cb+x2]or{}str.Color[cb-x2]=str.Color[cb-x2]or{}str.Color[cb+x2][db+y]=gb;str.Color[cb-x2][db+y]=gb;str.Color[cb+x2][db-y]=gb;str.Color[cb-x2][db-y]=gb end end;return str end;local function z(bb,cb)local db=math.floor(cb.p)local eb,fb=l-m,l+m;for y=eb,fb do local gb=t.GetPixel(bb,db,y)if gb=='0'or gb==nil then t.SetPixel(bb,db,y,'1')end end end;local function A(bb,cb,db)db=db or cb.p;t.Circle(bb,math.floor(db),l,k*cb.radius,r[cb.type])end;local function B(bb,cb,db,eb,fb,gb)local hb=gb or{}color=hb.color;local ib=(n-i)if cb<ib then cb=ib end;local jb=(o+i)if db>jb then db=jb end;for y=eb,fb do for x=cb,db do t.SetPixel(bb,x,y,'1')if color then t.SetColor(bb,x,y,color)end end end end;local function C(bb,cb)local db=cb.type;if db==1 or db==2 or db==3 or db==4 then A(bb,cb)elseif db==5 or db==6 then A(bb,cb)local eb=cb.endnote;local fb=(eb.ms-cb.ms)*cb.speed;A(bb,cb)local gb=k*cb.radius;local hb,ib=math.floor(cb.p),math.floor(cb.p+fb)local jb=l-gb;local kb=l+gb;B(bb,hb,ib,jb,kb,r[cb.type])elseif db==8 then A(bb,cb.startnote,cb.p)end end;local D={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(bb,cb)io.write(string.format("\27[%d;%dH",cb,bb))end}f=Taiko.GetDifficulty(f,g)local E=Taiko.GetAllNotes(f.Data)local F=f.Metadata.OFFSET;local function G(bb)return(bb.data=='note')or(bb.data=='event'and bb.event=='barline')end;local function H(bb,cb)return cb- (( (o+i)/math.abs(bb.speed)))end;local function I(bb,cb)return(bb.ms-cb)*bb.speed+p end;local function J(bb,cb)return bb.loadp- (bb.speed* (cb-bb.loadms))end;local K={}for bb,cb in pairs(E)do cb.ms=cb.ms-F;cb.s=MsToS(cb.ms)cb.speed=Taiko.CalculateSpeed(cb,k)cb.loadms=H(cb,cb.ms)cb.loads=MsToS(cb.loadms)cb.loadp=I(cb,cb.loadms)table.insert(K,cb.ms)end;for bb,cb in pairs(f.Data)do if cb.branch then for db,eb in pairs(cb.branch.paths)do table.sort(eb,function(fb,gb)return fb.loadms<gb.loadms end)end end end;table.sort(f.Data,function(bb,cb)if bb.branch and cb.branch then for db,eb in pairs(bb.branch.paths)do for fb,gb in pairs(cb.branch.paths)do return eb[1].loadms<gb[1].loadms end end elseif bb.branch then for db,eb in pairs(bb.branch.paths)do return eb[1].loadms<cb.loadms end elseif cb.branch then for db,eb in pairs(cb.branch.paths)do return bb.loadms<eb[1].loadms end else return bb.loadms<cb.loadms end end)Taiko.ConnectAll(f.Data)Taiko.ForAll(f.Data,function(bb,cb,db)bb.n=db end)local L=math.max(unpack(K))+j;local M={s=1,e=0,n=0}local N=f.Data[1]local O=N.loads;M.e=M.n;local P=10;local Q=string.rep(' ',P)local R={}local function S(bb,cb)table.insert(R,bb)table.insert(R,': ')table.insert(R,cb)table.insert(R,Q)table.insert(R,'\n')end;local function T()print(table.concat(R))R={}end;local U=''local function V(bb)U=U..'\n'..bb end;local function W()print(U)end;D.ClearScreen()local X='M'local Y=0;local Z=0;local ab=os.clock()if not h.on then while true do local bb=t.New()local cb=os.clock()local db=cb-ab;local eb=db*1000;if N then if N.loadms<eb then M.n=M.n+1;M.e=N.n;M[N.n]=N;N=N.nextnote;if N and N.branch then V('branch')N=N.branch.paths[X][1]end end else if eb>L then break end end;t.Circle(bb,math.floor(p),l,k,{color='purple'})for i=M.s,M.e do local gb=M[i]if gb then gb.p=J(gb,eb)if math.abs(gb.p-p)> (o+i+1)then if gb.endnote and gb.endnote.done~=true then else gb.done=true;M[i]=nil;if N and M.n==0 then M.s=N.n elseif gb.n==M.s then if gb.n==M.e then M.n=0 else local hb=M.s;repeat hb=hb+1;M.n=M.n-1 until M[hb]M.s=hb end end end else if gb.data=='event'then if gb.event=='barline'then z(bb,gb)end elseif gb.data=='note'then C(bb,gb)else error('Invalid note.data')end end end end;D.SetCursor(1,1)print(bb)Y=Y+1;local fb=os.clock()-cb;Z=Z+fb;S('S',db)S('Ms',eb)S('Loaded',M.n)S('Frames Rendered',Y)S('Last Frame Render (s)',fb)S('Last Frame Render (ms)',fb*1000)S('Frame Render Total (s)',Z)S('Frame Render Total (ms)',Z*1000)S('Frame Render Total (%)',Z/db*100)S('FPS (Frame)',Y/db)S('Memory Usage (mb)',collectgarbage('count')/1000)S('Finished (%)',eb/ (L)*100)S('Song Name',f.Metadata.TITLE)S('Difficulty (id)',f.Metadata.COURSE)S('Stars',f.Metadata.LEVEL)T()W()end else while true do local db=t.New()local eb=os.clock()local fb=(1 /h.fps)*Y;local gb=fb*1000;if N then if N.loadms<gb then M.n=M.n+1;M.e=N.n;M[N.n]=N;N=N.nextnote;if N and N.branch then V('branch')N=N.branch.paths[X][1]end end else if gb>L then break end end;for i=M.s,M.e do local ib=M[i]if ib then ib.p=J(ib,gb)if(ib.p< (n-i))then if ib.endnote and ib.endnote.done~=true then else ib.done=true;M[i]=nil;if N and M.n==0 then M.s=N.n elseif ib.n==M.s then if ib.n==M.e then M.n=0 else local jb=M.s;repeat jb=jb+1;M.n=M.n-1 until M[jb]M.s=jb end end end end;if ib.p< (o+buffer)then if ib.data=='event'then if ib.event=='barline'then z(db,ib)end elseif ib.data=='note'then C(db,ib)else error('Invalid note.data')end end end end;D.SetCursor(1,1)h.frames[Y]=db;Y=Y+1;local hb=os.clock()-eb;Z=Z+hb;S('S',fb)S('Ms',gb)S('Loaded',M.n)S('Frames Rendered',Y)S('Last Frame Render (s)',hb)S('Last Frame Render (ms)',hb*1000)S('Frame Render Total (s)',Z)S('Frame Render Total (ms)',Z*1000)S('Frame Render Total (%)',Z/fb*100)S('FPS (Frame)',Y/fb)S('Memory Usage (mb)',collectgarbage('count')/1000)S('Finished (%)',gb/ (L)*100)W()end;print('Prerendering Finished!\nPress enter to start')io.read()local bb=os.clock()local cb=(1 /h.fps)while true do local db=os.clock()-bb;local eb=h.frames[math.floor(( (db-db%cb)/cb)+0.5)]if eb==nil then break end;D.SetCursor(1,1)print(eb)end end end;local d='./CompactTJA/taikobuipm.tjac'd='./CompactTJA/ESE/06 Classical.tjac'local e=require('./CompactTJA/compactv4')Taiko.PlaySong(Taiko.ParseTJA(e.InputFile(d)),'Oni')
Split=function(h,i)local j={}for k,l in h:gmatch("([^"..i.."]*)("..i.."?)")do table.insert(j,k)if l==''then return j end end end;Trim=function(h)local i=h:gsub("^%s*(.-)%s*$","%1")return i end;TrimLeft=function(h)local i=h:gsub("^%s*(.-)$","%1")return i end;TrimRight=function(h)local i=h:gsub("^(.-)%s*$","%1")return i end;StartsWith=function(h,i)return h:sub(1,#i)==i end;EndsWith=function(h,i)return h:sub(-#i,-1)==i end;Table={}function Table.Clone(h,i)i=i or{}local j=type(h)local k;if j=='table'then if i[h]then k=i[h]else k={}i[h]=k;for l,m in next,h,nil do k[Table.Clone(l,i)]=Table.Clone(m,i)end;setmetatable(k,Table.Clone(getmetatable(h),i))end else k=h end;return k end;ClipN=function(h,i,j)if h<i then return i elseif h>j then return j else return h end end;function Error(h)error(h)end;LineN=nil;function ParseError(h,i,j)Error('Line: '..LineN..'\n'..h..': '..i.. (j and(', '..j)or''))end;function MsToS(h)return h/1000 end;function SToMs(h)return h*1000 end;Taiko={}Taiko.Data={Languages={'','EN','JA','CN','TW','KO'},GenreName={Pop={'pop','j-pop'},Anime={'anime','アニメ'},Kids={'kids','どうよう'},Variety={'variety','バラエティ'},VOCALOID={'vocaloid','ボーカロイド'},Classic={'classic','クラシック'},['Game Music']={'game music','ゲームミュージック'},['Namco Original']={'namco original','ナムコオリジナル'}},CourseId={easy=0,normal=1,hard=2,oni=3,edit=4,tower=5,dan=6,ura=4},CourseName={[0]='Easy','Normal','Hard','Oni','Edit','Tower','Dan','Ura'},RatingMultiplier={[0]=0,[1]=0.5,[2]=1,[3]=2},ScoreMode={[0]=function(h,i,j,k,l)return h+ ( ( (i<200)and(j or 1000)or( (j or 1000)+ (k or 1000)))*Taiko.Data.RatingMultiplier[l])end,[1]=function(h,i,j,k,l)return h+ (j+math.max(0,k*math.floor((math.min(i,100)-1)/10)))*Taiko.Data.RatingMultiplier[l]end,[2]=function(h,i,j,k,l)return h+ (j+k* ( (i>=100)and 8 or(i>=50)and 4 or(i>=30)and 2 or(i>=10)and 1 or 0))*Taiko.Data.RatingMultiplier[l]end},Autoscore={[0]=function(h)end,[1]=function(h)end,[2]=function(h)end},SideId={normal=1,ex=2,both=3},SideName={'normal','ex','both'},StyleId={single=1,double=2,couple=2},StyleName={'single','double'},Exam={Condition={g=true,jp=true,jg=true,jb=true,s=true,r=true,h=true,c=true},Scope={m=true,l=true}},Branch={PathId={N=0,E=1,M=2},PathName={[0]='N',[1]='E',[2]='M'},Requirements={r=function()end,p=function()end}}}for h,i in pairs(Taiko.Data.ScoreMode)do Taiko.Data.ScoreMode[h]=function(...)return math.floor(i(...)/10)*10 end end;function Taiko.ParseTJA(h)local i=os.clock()local j={}local k={Metadata={BPM=120,WAVE='main.mp3',OFFSET=0,DEMOSTART=0,SCOREMODE=1,SONGVOL=100,SEVOL=100,SIDE=3,LIFE=0,GAME='Taiko',HEADSCROLL=1,MOVIEOFFSET=0,COURSE='ONI',LEVEL=0,BALLOON=nil,SCOREINIT,SCOREDIFF,BALLOONNOR=nil,BALLOONEXP=nil,BALLOONMAS=nil,STYLE=1,EXAM1=nil,EXAM2=nil,EXAM3=nil,GAUGEINCR='NORMAL',TOTAL=nil,HIDDENBRANCH=0,DIVERGENOTES=false,SCOREINIT=0,SCOREDIFF=0},Data={}}local function l(x)local y=Taiko.Data.Languages;for i=1,#y do local z=k.Metadata[x..y[i]]if z then return z end end;return nil end;local function m(x,y,z)local A=tonumber(y)if A then return A else ParseError(x,z,y)end end;local function n(x,y,z,A)if y then return y else ParseError(x,z,A)end end;local function o(x,y,z)local A={['true']=true,['false']=false,yes=true,no=false,['1']=true,['0']=false,[1]=true,[0]=false}local B=A[y]~=nil;if B then return B else ParseError(x,z,y)end end;local function p(x,y)local z=','local A='\\'local B={}local C=''local D=false;for i=1,#y do local E=string.sub(y,i,i)if D then C=C..E;D=false else if E==z then table.insert(B,C)C=''elseif E==A then D=true else C=C..E end end end;table.insert(B,C)return B end;local function q(x,y,z)local A=p(x,y)for i=1,#A do A[i]=m(x,A[i],z,y)end;return A end;local function r(x,y,z)if y and y~=''then return q(x,y,z)else return{}end end;local function s(x,y,z)if y and y~=''then local A=p(x,y,z)n(x,Taiko.Data.Exam.Condition[A[1]],z)A[2]=m(x,A[2],z)A[3]=m(x,A[3],z)n(x,Taiko.Data.Exam.Scope[A[4]],z)return A else return{}end end;local u={}local function v()local x={settings={noteparse={notealias={A=3,B=4},noteexceptions={[',']=true,[' ']=true,['\t']=true}},command={matchexceptions={}}},bpm=0,ms=0,songstarted=false,timingpoint=nil,sign=4 /4,mpm=0,mspermeasure=0,scroll=1,measuredone=true,currentmeasure={},measurepushto=k.Data,barline=true,gogo=false,lastlong=nil,balloonn=1,currentbranch=nil,branch={on=false,requirements={},paths={}},msbeforebranch=nil}function x.createnote(y)if y then local z={ms=nil,data=nil,type=y,txt=nil,gogo=x.gogo,scroll=(x.scroll*k.Metadata.HEADSCROLL),mspermeasure=x.mspermeasure,bpm=x.bpm,nextnote=nil,radius=1,requiredhits=nil,length=nil,endnote=nil,onnotepush=nil}z.type=y;if y==3 or y==4 or y==6 then z.radius=z.radius*1.6 end;if y==5 or y==6 or y==7 or y==9 then if x.lastlong then if y==9 then else ParseError('parser.noteparse','Last long note has not ended')end else x.lastlong=z;if y==7 or y==9 then z.requiredhits=n('parser.noteparse',k.Metadata.BALLOON[x.balloonn],'Invalid number of balloons',x.balloonn)x.balloonn=x.balloonn+1 end end end;if y==8 then local A=x.lastlong;x.lastlong=nil;z.startnote=A;if A then z.onnotepush=function()A.length=z.ms-A.ms;A.endnote=z end else end end;return z else return{ms=nil,data=nil,type=nil,txt=nil,gogo=x.gogo,scroll=(x.scroll*k.Metadata.HEADSCROLL),mspermeasure=x.mspermeasure,bpm=x.bpm,nextnote=nil}end end;function x.endbranch()local y=x.createnote()y.data='event'y.event='branch'y.branch={requirements=x.branch.requirements,paths=x.branch.paths}x.branch.on=false;x.branch.requirements={}x.branch.paths={}table.insert(k.Data,y)x.measurepushto=k.Data end;return x end;u=v()local w=Split(h,'\n')for i=1,#w do LineN=i;local x=Trim(w[i])if StartsWith(x,'//')or x==''then else local y=string.find(x,'//')if y then x=string.sub(x,1,y-1)end;local z=false;if u.songstarted==false and z==false then local A={string.match(x,'(%u+):(.*)')}if A[1]then local B=Trim(A[2])if B~=''then k.Metadata[Trim(A[1])]=B end;z=true end end;if(u.songstarted or StartsWith(x,'#START'))and z==false then local A={string.match(x,'#(%u-)%s(.*)')}if not A[1]then A={string.match(x,'#(%u+)')}end;if A[1]then if A[1]=='START'then if u.songstarted then ParseError(A[1],'Song has already started')else k.OriginalMetadata=Table.Clone(k.Metadata)k.Metadata.TITLE=n(A[1],l('TITLE'),'Title is missing')k.Metadata.SUBTITLE=n(A[1],l('SUBTITLE'),'Subtitle is missing')k.Metadata.BPM=m(A[1],k.Metadata.BPM,'Invalid bpm')k.Metadata.OFFSET=SToMs(m(A[1],k.Metadata.OFFSET,'Invalid offset'))k.Metadata.DEMOSTART=SToMs(m(A[1],k.Metadata.DEMOSTART,'Invalid demostart'))if k.Metadata.DEMOSTART==0 then k.Metadata.DEMOSTART=nil end;for E,F in pairs(Taiko.Data.GenreName)do for i=1,#F do if F[i]==k.Metadata.GENRE then k.Metadata.GENRE=E end end end;k.Metadata.SCOREMODE=m(A[1],k.Metadata.SCOREMODE,'Invalid scoremode')n(A[1],Taiko.Data.ScoreMode[k.Metadata.SCOREMODE],'Invalid scoremode',k.Metadata.SCOREMODE)if k.Metadata.MAKER then k.Metadata.CREATORURLT={}k.Metadata.CREATOR=Trim(string.gsub(k.Metadata.MAKER,'(<.->)',function(E)table.insert(k.Metadata.CREATORURLT,string.sub(E,2,-2))return''end))k.Metadata.CREATORURL=table.concat(k.Metadata.CREATORURLT,', ')k.Metadata.CREATIVE=false else k.Metadata.CREATIVE=false end;k.Metadata.SONGVOL=m(A[1],k.Metadata.SONGVOL,'Invalid songvol')/100;k.Metadata.SEVOL=m(A[1],k.Metadata.SEVOL,'Invalid sevol')/100;local B=tonumber(k.Metadata.SIDE)if B then n(A[1],Taiko.Data.SideName[B],'Invalid side id',k.Metadata.SIDE)k.Metadata.SIDE=B else k.Metadata.SIDE=n(A[1],Taiko.Data.SideId[string.lower(k.Metadata.SIDE)],'Invalid side name',k.Metadata.SIDE)end;k.Metadata.LIFE=m(A[1],k.Metadata.LIFE,'Invalid life')if k.Metadata.LIFE==0 then k.Metadata.LIFE=nil end;k.Metadata.GAME=string.lower(k.Metadata.GAME)if k.Metadata.GAME=='taiko'then elseif k.Metadata.GAME=='jube'then else end;k.Metadata.HEADSCROLL=m(A[1],k.Metadata.HEADSCROLL,'Invalid headscroll')k.Metadata.MOVIEOFFSET=m(A[1],k.Metadata.MOVIEOFFSET,'Invalid movieoffset')local C=tonumber(k.Metadata.COURSE)if C then n(A[1],Taiko.Data.CourseName[C],'Invalid course id',k.Metadata.COURSE)k.Metadata.COURSE=C else k.Metadata.COURSE=n(A[1],Taiko.Data.CourseId[string.lower(k.Metadata.COURSE)],'Invalid course name',k.Metadata.COURSE)end;k.Metadata.LEVEL=ClipN(math.floor(m(A[1],k.Metadata.LEVEL,'Invalid level')),0,10)k.Metadata.BALLOON=r(A[1],k.Metadata.BALLOON,'Invalid balloon')k.Metadata.SCOREINIT=m(A[1],k.Metadata.SCOREINIT,'Invalid scoreinit')k.Metadata.SCOREDIFF=m(A[1],k.Metadata.SCOREDIFF,'Invalid scoreinit')k.Metadata.BALLOONNOR=r(A[1],k.Metadata.BALLOONNOR,'Invalid balloonnor')k.Metadata.BALLOONEXP=r(A[1],k.Metadata.BALLOONEXP,'Invalid balloonexp')k.Metadata.BALLOONMAS=r(A[1],k.Metadata.BALLOONMAS,'Invalid balloonmas')local D=tonumber(k.Metadata.STYLE)if D then n(A[1],Taiko.Data.StyleName[D],'Invalid course id',Taiko.Data.STYLE)k.Metadata.STYLE=D else k.Metadata.STYLE=n(A[1],Taiko.Data.CourseId[string.lower(k.Metadata.STYLE)],'Invalid course name',k.Metadata.STYLE)end;k.Metadata.EXAM1=s(k.Metadata.EXAM1)k.Metadata.EXAM2=s(k.Metadata.EXAM2)k.Metadata.EXAM3=s(k.Metadata.EXAM3)k.Metadata.GAUGEINCR=string.lower(k.Metadata.GAUGEINCR)if k.Metadata.TOTAL then k.Metadata.TOTAL=m(A[1],k.Metadata.TOTAL,'Invalid total')end;k.Metadata.HIDDENBRANCH=o(A[1],k.Metadata.HIDDENBRANCH,'Invalid hiddenbranch')u.bpm=k.Metadata.BPM;u.songstarted=true end elseif A[1]=='END'then if u.songstarted then if#u.currentmeasure~=0 then ParseError(A[1],'Current measure is not empty')end;table.insert(j,k)k={Metadata=Table.Clone(k.OriginalMetadata),Data={}}u=v()u.songstarted=false;u.measurepushto=k.Data else ParseError(A[1],'Song has already ended')end elseif A[1]=='MEASURE'then local B,C=string.match(A[2],'(%d+)/(%d+)')B=m(A[1],B,'Invalid measure')C=m(A[1],C,'Invalid measure')u.sign=(B/C)or u.sign elseif A[1]=='BPMCHANGE'then u.bpm=m(A[1],A[2],'Invalid bpmchange')or u.bpm elseif A[1]=='DELAY'then table.insert(u.currentmeasure,{A[1],SToMs((m(A[1],A[2],'Invalid delay')or 0))})elseif A[1]=='SCROLL'then u.scroll=m(A[1],A[2],'Invalid scroll')or u.scroll;if u.scroll==0 then ParseError(A[1],'Scroll cannot be 0')end elseif A[1]=='GOGOSTART'then u.gogo=true elseif A[1]=='GOGOEND'then u.gogo=false elseif A[1]=='BARLINEOFF'then u.barline=false elseif A[1]=='BARLINEON'then u.barline=true elseif A[1]=='BRANCHSTART'then if u.branch.on then u.endbranch()end;u.msbeforebranch=u.ms;u.branch.on=true;k.Metadata.DIVERGENOTES=true;local B=p(A[1],A[2])local C=n(A[1],Taiko.Data.Branch.Requirements[string.lower(B[1])],'Invalid type',B[1])u.branch.requirements={C}local D=2;while true do if not B[D]then break end;local E=Taiko.Data.Branch.PathName[D-1]if E then u.branch.requirements[E]=B[D]else break end;D=D+1 end elseif Taiko.Data.Branch.PathId[A[1]]then if u.branch.on then u.ms=u.msbeforebranch;u.currentbranch=A[1]u.branch.paths[A[1]]={}u.measurepushto=u.branch.paths[A[1]]else ParseError(A[1],'Branch has not started')end elseif A[1]=='BRANCHEND'then if u.branch.on then u.endbranch()else ParseError(A[1],'Branch has already ended')end elseif A[1]=='SECTION'then elseif A[1]=='LYRIC'then elseif A[1]=='LEVELHOLD'then elseif A[1]=='BMSCROLL'then elseif A[1]=='HBSCROLL'then elseif A[1]=='SENOTECHANGE'then elseif A[1]=='NEXTSONG'then elseif A[1]=='DIRECTION'then elseif A[1]=='SUDDEN'then elseif A[1]=='JPOSSCROLL'then else end;z=true end end;if(u.songstarted)and z==false then u.mpm=u.bpm*u.sign/4;u.mspermeasure=60000 *u.sign*4 /u.bpm;if u.barline and#u.currentmeasure==0 then local A=u.createnote()A.ms=u.ms;A.data='event'A.event='barline'table.insert(u.measurepushto,1,A)end;for i=1,#x do local A=string.sub(x,i,i)if u.settings.noteparse.noteexceptions[A]then else local B=m('parser.noteparse',tonumber(A)or u.settings.noteparse.notealias[A]or A,'Invalid note')if B then local C=u.createnote(B)C.data='note'table.insert(u.currentmeasure,C)end end end;if EndsWith(TrimRight(x),',')then u.mpm=u.bpm*u.sign/4;u.mspermeasure=60000 *u.sign*4 /u.bpm;if#u.currentmeasure==0 then u.ms=u.ms+u.mspermeasure else local A=0;local B=nil;for i=1,#u.currentmeasure do local D=u.currentmeasure[i]if D.data=='note'then B=B or D.mspermeasure;A=A+1 end end;local C=B/A;for i=1,#u.currentmeasure do local D=u.currentmeasure[i]if D[1]=='DELAY'then u.ms=u.ms+D[2]else if D.type~=0 then D.ms=u.ms;local E=k.Data[#k.Data]if E then E.nextnote=D end;table.insert(u.measurepushto,D)if D.onnotepush then D.onnotepush()end;C=D.mspermeasure/A end end;u.ms=u.ms+C end end;u.measuredone=true;u.currentmeasure={}else u.measuredone=false end end end end;print('Parsing Took: '..SToMs(os.clock()-i)..'ms')return j end;function Taiko.Analyze(h)for i=1,#h.Data do end end;function Taiko.GetDifficulty(h,i)local j=Taiko.Data.CourseId[string.lower(i)]or i;for l,m in pairs(h)do if m.Metadata.COURSE==j then return m end end;Error('No difficulty found, '..i)return nil end;function Taiko.ForAll(h,i)local j=1;for i=1,#h do local k=h[i]if k.branch then local l=-1;for m,o in pairs(k.branch.paths)do local p=j;for i2=1,#o do i(o[i2],i2,p)p=p+1 end;l=(l<p)and p or l end;j=l else i(k,i,j)end;j=j+1 end;return h end;function Taiko.GetAllNotes(h)local i={}for j,l in pairs(h)do if l.branch then for m,n in pairs(l.branch.paths)do for i=1,#n do table.insert(i,n[i])end end else table.insert(i,l)end end;return i end;function Taiko.ConnectNotes(h)local i=nil;for i=#h,1,-1 do local j=h[i]j.nextnote=i;i=j end;return h end;function Taiko.ExtractBranch(h,i)return h.branch.paths[i]end;function Taiko.ConnectAll(h)local i=nil;for i=#h,1,-1 do local j=h[i]if j.branch then for l,m in pairs(j.branch.paths)do local n=Taiko.ConnectNotes(m)n[#n].nextnote=i end else j.nextnote=i end;i=j end end;function Taiko.CalculateSpeed(h,i)local j=(i*h.scroll*h.bpm/7500)return j end;function Taiko.CalculateSpeedAll(h,i)for i=1,#h do h[i].speed=Taiko.CalculateSpeed(h[i],i)end;return h end;function Taiko.RenderScale(h)local i={}local j={}local k={}for i=1,#h.Data do local o=h.Data[i]if o.data=='note'then local p=math.floor(o.ms)if math.floor(p)-p==0 then table.insert(i,{p,o.type})table.insert(j,p)else table.insert(k,i)end end end;function gcd2(o,p)if p==0 then return o else return gcd2(p,o%p)end end;function gcdn(o)local p=o[1]for i=2,#o do p=gcd2(p,o[i])end;return p end;local l=gcdn(j)for i=1,#k do local o=i[k[i]]o[1]=math.floor(o[1]/l)*l end;local m=''local n=0;for i=1,#i do i[i][1]=i[i][1]/l;m=m..string.rep(' ',i[i][1]-n)..i[i][2]n=i[i][1]end;return m end;function Taiko.PlaySong(h,i)local j={on=true,fps=60,frames={}}local k=100;local l=10;local m=100;local n=4;local o=0;local p=10;local q=0;local r=40;local s=3;local u=1;local v={[1]={color='red'},[2]={color='blue'},[3]={color='red'},[4]={color='blue'},[5]={color='yellow'},[6]={color='yellow'}}r=math.floor(r*n)local w=q+r;s=math.floor(s*n)local x=require('Pixels')local z,A=q,r;local B,C=-p,p;x.Convert.ToDots=function(cb)cb=GetPixelData(cb)local db,eb=cb.Data,cb.Color;if ReverseY then local function ob(pb)local qb={}for rb,sb in pairs(pb)do for tb,ub in pairs(sb)do qb[rb]=qb[rb]or{}qb[rb][-tb]=ub end end;return qb end;db=ob(db)eb=ob(eb)end;cb={Data=db,Color=eb}local function fb(ob)local pb=nil;for qb,rb in pairs(ob)do if not pb or qb<pb then pb=qb end end;return pb end;local function gb(ob)local pb=nil;for qb,rb in pairs(ob)do if not pb or qb>pb then pb=qb end end;return pb end;local function hb(ob,pb)local qb={}for rb,sb in pairs(ob)do local tb=pb(sb)if tb then qb[tb]=true end end;return pb(qb)end;local ib={}local jb=string.rep('0',8)local kb=x.Data.Dot[jb]local lb=nil;local mb=nil;if cb.Color.All then local ob=tostring(x.Color(cb.Color.All))table.insert(ib,ob)mb=ob end;local nb={}for ob,pb in pairs(db)do for qb,rb in pairs(pb)do nb[qb]=nb[qb]or{}nb[qb][ob]=rb end end;if not B then return''end;for y=B,C,4 do for x=z,A,2 do local ob=''local pb={{0,0},{0,1},{0,2},{0,3},{1,0},{1,1},{1,2},{1,3}}for i=1,8 do local qb,rb=x+pb[i][1],y+pb[i][2]ob=ob.. ( (db[qb]and db[qb][rb]or false)and db[qb][rb]or x.Data.Empty)end;if ob~=jb then ob=x.Data.Dot[ob]if not mb then local qb=x.GetColor(cb,x,y)if not qb then local rb={{0,0},{0,1},{0,2},{0,3},{1,0},{1,1},{1,2},{1,3}}for i=1,8 do qb=x.GetColor(cb,x+rb[i][1],y+rb[i][2])if qb then break end end end;if qb then qb=tostring(x.Color(qb))else qb=tostring(x.Color('reset'))end;if lb==qb then else table.insert(ib,qb)lb=qb end end;table.insert(ib,ob)else table.insert(ib,kb)end end;table.insert(ib,x.Data.NewLine)end;table.insert(ib,tostring(x.Color('reset')))return table.concat(ib)end;local function D(cb,db)local eb=math.floor(db.p)local fb,gb=o-p,o+p;for y=fb,gb do local hb=x.GetPixel(cb,eb,y)if hb=='0'or hb==nil then x.SetPixel(cb,eb,y,'1')end end end;local function E(cb,db)x.Circle(cb,math.floor(db.p),o,n*db.radius,v[db.type])end;local function F(cb,db,eb,fb,gb,hb)local ib=hb or{}color=ib.color;local jb=(q-l)if db<jb then db=jb end;local kb=(r+l)if eb>kb then eb=kb end;for y=fb,gb do for x=db,eb do x.SetPixel(cb,x,y,'1')if color then x.SetColor(cb,x,y,color)end end end end;local function G(cb,db)local eb=db.type;if eb==1 or eb==2 or eb==3 or eb==4 then E(cb,db)elseif eb==5 or eb==6 then E(cb,db)local fb=db.endnote;local gb=(fb.ms-db.ms)*db.speed;E(cb,db)local hb=n*db.radius;local ib,jb=math.floor(db.p),math.floor(db.p+gb)local kb=o-hb;local lb=o+hb;F(cb,ib,jb,kb,lb,v[db.type])elseif eb==8 then if db.renderproxy then db.renderproxy.p=db.p else local fb=db.startnote;db.renderproxy={}for gb,hb in pairs(fb)do if gb~='type'then db.renderproxy[gb]=hb end end end;db.renderproxy.p=db.p;E(cb,db.renderproxy)end end;local H={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(cb,db)io.write(string.format("\27[%d;%dH",db,cb))end}h=Taiko.GetDifficulty(h,i)local I=Taiko.GetAllNotes(h.Data)local J=h.Metadata.OFFSET;local function K(cb)return(cb.data=='note')or(cb.data=='event'and cb.event=='barline')end;local function L(cb,db)return db- ( (r/cb.speed)+k)end;local function M(cb,db)return(cb.ms-db)*cb.speed+s end;local function N(cb,db)return cb.loadp- (cb.speed* (db-cb.loadms))end;local O={}for cb,db in pairs(I)do db.ms=db.ms-J;db.s=MsToS(db.ms)db.speed=Taiko.CalculateSpeed(db,n)db.loadms=L(db,db.ms)db.loads=MsToS(db.loadms)db.loadp=M(db,db.loadms)table.insert(O,db.ms)end;for cb,db in pairs(h.Data)do if db.branch then for eb,fb in pairs(db.branch.paths)do table.sort(fb,function(gb,hb)return gb.loadms<hb.loadms end)end end end;table.sort(h.Data,function(cb,db)if cb.branch and db.branch then for eb,fb in pairs(cb.branch.paths)do for gb,hb in pairs(db.branch.paths)do return fb[1].loadms<hb[1].loadms end end elseif cb.branch then for eb,fb in pairs(cb.branch.paths)do return fb[1].loadms<db.loadms end elseif db.branch then for eb,fb in pairs(db.branch.paths)do return cb.loadms<fb[1].loadms end else return cb.loadms<db.loadms end end)Taiko.ConnectAll(h.Data)Taiko.ForAll(h.Data,function(cb,db,eb)cb.n=eb end)local P=math.max(unpack(O))+m;local Q={s=1,e=0,n=0}local R=h.Data[1]local S=R.loads;Q.e=Q.n;local T=10;local function U(cb,db)print(cb..': '..tostring(db)..string.rep(' ',T))end;local V=''local function W(cb)V=V..'\n'..cb end;local function X()print(V)end;H.ClearScreen()local Y='M'local Z=0;local ab=0;local bb=os.clock()while true do local cb=x.New()local db=os.clock()local eb=db-bb;local fb=eb*1000;if R then if R and R.loadms<fb then Q.n=Q.n+1;Q.e=R.n;Q[R.n]=R;R=R.nextnote;if R.branch then W('branch')R=R.branch.paths[Y][1]end end else if fb>P then break end end;for i=Q.s,Q.e do local hb=Q[i]if hb then hb.p=N(hb,fb)if(hb.p< (q-l))then if hb.endnote and hb.endnote.done~=true then else hb.done=true;Q[i]=nil;if Q.n==0 then Q.s=R.n elseif hb.n==Q.s then if hb.n==Q.e then Q.n=0 else local ib=Q.s;repeat ib=ib+1;Q.n=Q.n-1 until Q[ib]Q.s=ib end end end end;if hb.p< (r+k)then if hb.data=='event'then if hb.event=='barline'then D(cb,hb)end elseif hb.data=='note'then G(cb,hb)else error('Invalid note.data')end end end end;H.SetCursor(1,1)print(cb)Z=Z+1;local gb=os.clock()-db;ab=ab+gb end end;function scandir(h)local j,k,l=0,{},io.popen;local m=l('dir "'..h..'" /b')for n in m:lines()do j=j+1;k[j]=n end;m:close()return k end;local e=[[C:\Users\User\OneDrive\code\Taiko\Versions\taikobuipm]]local f=scandir(e)local g={['Koibumi 2000.tja']=true}for i=1,#f do local h=f[i]if(not g[h])and EndsWith(h,'tja')then print(h)Taiko.ParseTJA(io.open(e..'\\'..h,'r'):read('*all'))end end;file='./tja/donkama.tja'file='./tja/ekiben.tja'file='./tja/saitama.tja'file='./tja/funny2000.tja'file='./tja/waraeru.tja'Taiko.PlaySong(Taiko.ParseTJA(io.open(file,'r'):read('*all')),'Oni')
Split=function(c,d)local e={}for f,g in c:gmatch("([^"..d.."]*)("..d.."?)")do table.insert(e,f)if g==''then return e end end end;Trim=function(b)local c=b:gsub("^%s*(.-)%s*$","%1")return c end;TrimLeft=function(b)local c=b:gsub("^%s*(.-)$","%1")return c end;TrimRight=function(b)local c=b:gsub("^(.-)%s*$","%1")return c end;StartsWith=function(c,d)return c:sub(1,#d)==d end;EndsWith=function(c,d)return c:sub(-#d,-1)==d end;Table={}function Table.Clone(b,c)c=c or{}local d=type(b)local e;if d=='table'then if c[b]then e=c[b]else e={}c[b]=e;for f,g in next,b,nil do e[Table.Clone(f,c)]=Table.Clone(g,c)end;setmetatable(e,Table.Clone(getmetatable(b),c))end else e=b end;return e end;ClipN=function(c,d,e)if c<d then return d elseif c>e then return e else return c end end;function Error(b)error(b)end;LineN=nil;function ParseError(b,c,d)Error('Line: '..LineN..'\n'..b..': '..c.. (d and(', '..d)or''))end;function MsToS(b)return b/1000 end;function SToMs(b)return b*1000 end;Taiko={}Taiko.Data={Languages={'','EN','JA','CN','TW','KO'},GenreName={Pop={'pop','j-pop'},Anime={'anime','アニメ'},Kids={'kids','どうよう'},Variety={'variety','バラエティ'},VOCALOID={'vocaloid','ボーカロイド'},Classic={'classic','クラシック'},['Game Music']={'game music','ゲームミュージック'},['Namco Original']={'namco original','ナムコオリジナル'}},CourseId={easy=0,normal=1,hard=2,oni=3,edit=4,tower=5,dan=6,ura=4},CourseName={[0]='Easy','Normal','Hard','Oni','Edit','Tower','Dan','Ura'},RatingMultiplier={[0]=0,[1]=0.5,[2]=1,[3]=2},ScoreMode={[0]=function(b,c,d,e,f)return b+ ( ( (c<200)and(d or 1000)or( (d or 1000)+ (e or 1000)))*Taiko.Data.RatingMultiplier[f])end,[1]=function(b,c,d,e,f)return b+ (d+math.max(0,e*math.floor((math.min(c,100)-1)/10)))*Taiko.Data.RatingMultiplier[f]end,[2]=function(b,c,d,e,f)return b+ (d+e* ( (c>=100)and 8 or(c>=50)and 4 or(c>=30)and 2 or(c>=10)and 1 or 0))*Taiko.Data.RatingMultiplier[f]end},Autoscore={[0]=function(b)end,[1]=function(b)end,[2]=function(b)end},SideId={normal=1,ex=2,both=3},SideName={'normal','ex','both'},StyleId={single=1,double=2,couple=2},StyleName={'single','double'},Exam={Condition={g=true,jp=true,jg=true,jb=true,s=true,r=true,h=true,c=true},Scope={m=true,l=true}},Branch={PathId={N=0,E=1,M=2},PathName={[0]='N',[1]='E',[2]='M'},Requirements={r=function()end,p=function()end}}}for b,c in pairs(Taiko.Data.ScoreMode)do Taiko.Data.ScoreMode[b]=function(...)return math.floor(c(...)/10)*10 end end;function Taiko.ParseTJA(b)local c=os.clock()local d={}local e={Metadata={BPM=120,WAVE='main.mp3',OFFSET=0,DEMOSTART=0,SCOREMODE=1,SONGVOL=100,SEVOL=100,SIDE=3,LIFE=0,GAME='Taiko',HEADSCROLL=1,MOVIEOFFSET=0,COURSE='ONI',LEVEL=0,BALLOON=nil,SCOREINIT,SCOREDIFF,BALLOONNOR=nil,BALLOONEXP=nil,BALLOONMAS=nil,STYLE=1,EXAM1=nil,EXAM2=nil,EXAM3=nil,GAUGEINCR='NORMAL',TOTAL=nil,HIDDENBRANCH=0,DIVERGENOTES=false,SCOREINIT=0,SCOREDIFF=0},Data={}}local function f(q)local r=Taiko.Data.Languages;for i=1,#r do local s=e.Metadata[q..r[i]]if s then return s end end;return nil end;local function g(q,r,s)local t=tonumber(r)if t then return t else ParseError(q,s,r)end end;local function h(q,r,s,t)if r then return r else ParseError(q,s,t)end end;local function i(q,r,s)local t={['true']=true,['false']=false,yes=true,no=false,['1']=true,['0']=false,[1]=true,[0]=false}local u=t[r]~=nil;if u then return u else ParseError(q,s,r)end end;local function j(q,r)local s=','local u='\\'local v={}local w=''local x=false;for i=1,#r do local y=string.sub(r,i,i)if x then w=w..y;x=false else if y==s then table.insert(v,w)w=''elseif y==u then x=true else w=w..y end end end;table.insert(v,w)return v end;local function k(q,r,s)local u=j(q,r)for i=1,#u do u[i]=g(q,u[i],s,r)end;return u end;local function l(q,r,t)if r and r~=''then return k(q,r,t)else return{}end end;local function m(q,r,t)if r and r~=''then local u=j(q,r,t)h(q,Taiko.Data.Exam.Condition[u[1]],t)u[2]=g(q,u[2],t)u[3]=g(q,u[3],t)h(q,Taiko.Data.Exam.Scope[u[4]],t)return u else return{}end end;local n={}local function o()local q={settings={noteparse={notealias={A=3,B=4},noteexceptions={[',']=true,[' ']=true,['\t']=true}},command={matchexceptions={}}},bpm=0,ms=0,songstarted=false,timingpoint=nil,sign=4 /4,mpm=0,mspermeasure=0,scroll=1,measuredone=true,currentmeasure={},measurepushto=e.Data,barline=true,gogo=false,lastlong=nil,balloonn=1,currentbranch=nil,branch={on=false,requirements={},paths={}},msbeforebranch=nil}function q.createnote(r)if r then local s={ms=nil,data=nil,type=r,txt=nil,gogo=q.gogo,scroll=(q.scroll*e.Metadata.HEADSCROLL),mspermeasure=q.mspermeasure,bpm=q.bpm,nextnote=nil,radius=1,requiredhits=nil,length=nil,endnote=nil,onnotepush=nil}s.type=r;if r==3 or r==4 or r==6 then s.radius=s.radius*1.6 end;if r==5 or r==6 or r==7 or r==9 then if q.lastlong then if r==9 then else ParseError('parser.noteparse','Last long note has not ended')end else q.lastlong=s;if r==7 or r==9 then s.requiredhits=h('parser.noteparse',e.Metadata.BALLOON[q.balloonn],'Invalid number of balloons',q.balloonn)q.balloonn=q.balloonn+1 end end end;if r==8 then local t=q.lastlong;q.lastlong=nil;s.startnote=t;if t then s.onnotepush=function()t.length=s.ms-t.ms;t.endnote=s end else end end;return s else return{ms=nil,data=nil,type=nil,txt=nil,gogo=q.gogo,scroll=(q.scroll*e.Metadata.HEADSCROLL),mspermeasure=q.mspermeasure,bpm=q.bpm,nextnote=nil}end end;function q.endbranch()local r=q.createnote()r.data='event'r.event='branch'r.branch={requirements=q.branch.requirements,paths=q.branch.paths}q.branch.on=false;q.branch.requirements={}q.branch.paths={}table.insert(e.Data,r)q.measurepushto=e.Data end;return q end;n=o()local p=Split(b,'\n')for i=1,#p do LineN=i;local q=Trim(p[i])if StartsWith(q,'//')or q==''then else local r=string.find(q,'//')if r then q=string.sub(q,1,r-1)end;local s=false;if n.songstarted==false and s==false then local t={string.match(q,'(%u+):(.*)')}if t[1]then local u=Trim(t[2])if u~=''then e.Metadata[Trim(t[1])]=u end;s=true end end;if(n.songstarted or StartsWith(q,'#START'))and s==false then local t={string.match(q,'#(%u-)%s(.*)')}if not t[1]then t={string.match(q,'#(%u+)')}end;if t[1]then if t[1]=='START'then if n.songstarted then ParseError(t[1],'Song has already started')else e.OriginalMetadata=Table.Clone(e.Metadata)e.Metadata.TITLE=h(t[1],f('TITLE'),'Title is missing')e.Metadata.SUBTITLE=h(t[1],f('SUBTITLE'),'Subtitle is missing')e.Metadata.BPM=g(t[1],e.Metadata.BPM,'Invalid bpm')e.Metadata.OFFSET=SToMs(g(t[1],e.Metadata.OFFSET,'Invalid offset'))e.Metadata.DEMOSTART=SToMs(g(t[1],e.Metadata.DEMOSTART,'Invalid demostart'))if e.Metadata.DEMOSTART==0 then e.Metadata.DEMOSTART=nil end;for x,y in pairs(Taiko.Data.GenreName)do for i=1,#y do if y[i]==e.Metadata.GENRE then e.Metadata.GENRE=x end end end;e.Metadata.SCOREMODE=g(t[1],e.Metadata.SCOREMODE,'Invalid scoremode')h(t[1],Taiko.Data.ScoreMode[e.Metadata.SCOREMODE],'Invalid scoremode',e.Metadata.SCOREMODE)if e.Metadata.MAKER then e.Metadata.CREATORURLT={}e.Metadata.CREATOR=Trim(string.gsub(e.Metadata.MAKER,'(<.->)',function(x)table.insert(e.Metadata.CREATORURLT,string.sub(x,2,-2))return''end))e.Metadata.CREATORURL=table.concat(e.Metadata.CREATORURLT,', ')e.Metadata.CREATIVE=false else e.Metadata.CREATIVE=false end;e.Metadata.SONGVOL=g(t[1],e.Metadata.SONGVOL,'Invalid songvol')/100;e.Metadata.SEVOL=g(t[1],e.Metadata.SEVOL,'Invalid sevol')/100;local u=tonumber(e.Metadata.SIDE)if u then h(t[1],Taiko.Data.SideName[u],'Invalid side id',e.Metadata.SIDE)e.Metadata.SIDE=u else e.Metadata.SIDE=h(t[1],Taiko.Data.SideId[string.lower(e.Metadata.SIDE)],'Invalid side name',e.Metadata.SIDE)end;e.Metadata.LIFE=g(t[1],e.Metadata.LIFE,'Invalid life')if e.Metadata.LIFE==0 then e.Metadata.LIFE=nil end;e.Metadata.GAME=string.lower(e.Metadata.GAME)if e.Metadata.GAME=='taiko'then elseif e.Metadata.GAME=='jube'then else end;e.Metadata.HEADSCROLL=g(t[1],e.Metadata.HEADSCROLL,'Invalid headscroll')e.Metadata.MOVIEOFFSET=g(t[1],e.Metadata.MOVIEOFFSET,'Invalid movieoffset')local v=tonumber(e.Metadata.COURSE)if v then h(t[1],Taiko.Data.CourseName[v],'Invalid course id',e.Metadata.COURSE)e.Metadata.COURSE=v else e.Metadata.COURSE=h(t[1],Taiko.Data.CourseId[string.lower(e.Metadata.COURSE)],'Invalid course name',e.Metadata.COURSE)end;e.Metadata.LEVEL=ClipN(math.floor(g(t[1],e.Metadata.LEVEL,'Invalid level')),0,10)e.Metadata.BALLOON=l(t[1],e.Metadata.BALLOON,'Invalid balloon')e.Metadata.SCOREINIT=g(t[1],e.Metadata.SCOREINIT,'Invalid scoreinit')e.Metadata.SCOREDIFF=g(t[1],e.Metadata.SCOREDIFF,'Invalid scoreinit')e.Metadata.BALLOONNOR=l(t[1],e.Metadata.BALLOONNOR,'Invalid balloonnor')e.Metadata.BALLOONEXP=l(t[1],e.Metadata.BALLOONEXP,'Invalid balloonexp')e.Metadata.BALLOONMAS=l(t[1],e.Metadata.BALLOONMAS,'Invalid balloonmas')local w=tonumber(e.Metadata.STYLE)if w then h(t[1],Taiko.Data.StyleName[w],'Invalid course id',Taiko.Data.STYLE)e.Metadata.STYLE=w else e.Metadata.STYLE=h(t[1],Taiko.Data.CourseId[string.lower(e.Metadata.STYLE)],'Invalid course name',e.Metadata.STYLE)end;e.Metadata.EXAM1=m(e.Metadata.EXAM1)e.Metadata.EXAM2=m(e.Metadata.EXAM2)e.Metadata.EXAM3=m(e.Metadata.EXAM3)e.Metadata.GAUGEINCR=string.lower(e.Metadata.GAUGEINCR)if e.Metadata.TOTAL then e.Metadata.TOTAL=g(t[1],e.Metadata.TOTAL,'Invalid total')end;e.Metadata.HIDDENBRANCH=i(t[1],e.Metadata.HIDDENBRANCH,'Invalid hiddenbranch')n.bpm=e.Metadata.BPM;n.songstarted=true end elseif t[1]=='END'then if n.songstarted then if#n.currentmeasure~=0 then ParseError(t[1],'Current measure is not empty')end;table.insert(d,e)e={Metadata=Table.Clone(e.OriginalMetadata),Data={}}n=o()n.songstarted=false;n.measurepushto=e.Data else ParseError(t[1],'Song has already ended')end elseif t[1]=='MEASURE'then local u,v=string.match(t[2],'(%d+)/(%d+)')u=g(t[1],u,'Invalid measure')v=g(t[1],v,'Invalid measure')n.sign=(u/v)or n.sign elseif t[1]=='BPMCHANGE'then n.bpm=g(t[1],t[2],'Invalid bpmchange')or n.bpm elseif t[1]=='DELAY'then table.insert(n.currentmeasure,{t[1],SToMs((g(t[1],t[2],'Invalid delay')or 0))})elseif t[1]=='SCROLL'then n.scroll=g(t[1],t[2],'Invalid scroll')or n.scroll;if n.scroll==0 then ParseError(t[1],'Scroll cannot be 0')end elseif t[1]=='GOGOSTART'then n.gogo=true elseif t[1]=='GOGOEND'then n.gogo=false elseif t[1]=='BARLINEOFF'then n.barline=false elseif t[1]=='BARLINEON'then n.barline=true elseif t[1]=='BRANCHSTART'then if n.branch.on then n.endbranch()end;n.msbeforebranch=n.ms;n.branch.on=true;e.Metadata.DIVERGENOTES=true;local u=j(t[1],t[2])local v=h(t[1],Taiko.Data.Branch.Requirements[string.lower(u[1])],'Invalid type',u[1])n.branch.requirements={v}local w=2;while true do if not u[w]then break end;local x=Taiko.Data.Branch.PathName[w-1]if x then n.branch.requirements[x]=u[w]else break end;w=w+1 end elseif Taiko.Data.Branch.PathId[t[1]]then if n.branch.on then n.ms=n.msbeforebranch;n.currentbranch=t[1]n.branch.paths[t[1]]={}n.measurepushto=n.branch.paths[t[1]]else ParseError(t[1],'Branch has not started')end elseif t[1]=='BRANCHEND'then if n.branch.on then n.endbranch()else ParseError(t[1],'Branch has already ended')end elseif t[1]=='SECTION'then elseif t[1]=='LYRIC'then elseif t[1]=='LEVELHOLD'then elseif t[1]=='BMSCROLL'then elseif t[1]=='HBSCROLL'then elseif t[1]=='SENOTECHANGE'then elseif t[1]=='NEXTSONG'then elseif t[1]=='DIRECTION'then elseif t[1]=='SUDDEN'then elseif t[1]=='JPOSSCROLL'then else end;s=true end end;if(n.songstarted)and s==false then n.mpm=n.bpm*n.sign/4;n.mspermeasure=60000 *n.sign*4 /n.bpm;if n.barline and#n.currentmeasure==0 then local t=n.createnote()t.ms=n.ms;t.data='event't.event='barline'table.insert(n.measurepushto,1,t)end;for i=1,#q do local t=string.sub(q,i,i)if n.settings.noteparse.noteexceptions[t]then else local u=g('parser.noteparse',tonumber(t)or n.settings.noteparse.notealias[t]or t,'Invalid note')if u then local v=n.createnote(u)v.data='note'table.insert(n.currentmeasure,v)end end end;if EndsWith(TrimRight(q),',')then n.mpm=n.bpm*n.sign/4;n.mspermeasure=60000 *n.sign*4 /n.bpm;if#n.currentmeasure==0 then n.ms=n.ms+n.mspermeasure else local t=0;local u=nil;for i=1,#n.currentmeasure do local w=n.currentmeasure[i]if w.data=='note'then u=u or w.mspermeasure;t=t+1 end end;local v=u/t;for i=1,#n.currentmeasure do local w=n.currentmeasure[i]if w[1]=='DELAY'then n.ms=n.ms+w[2]else if w.type~=0 then w.ms=n.ms;local x=e.Data[#e.Data]if x then x.nextnote=w end;table.insert(n.measurepushto,w)if w.onnotepush then w.onnotepush()end;v=w.mspermeasure/t end end;n.ms=n.ms+v end end;n.measuredone=true;n.currentmeasure={}else n.measuredone=false end end end end;print('Parsing Took: '..SToMs(os.clock()-c)..'ms')return d end;function Taiko.Analyze(b)for i=1,#b.Data do end end;function Taiko.GetDifficulty(b,c)local d=Taiko.Data.CourseId[string.lower(c)]or c;for e,f in pairs(b)do if f.Metadata.COURSE==d then return f end end;Error('No difficulty found, '..c)return nil end;function Taiko.ForAll(b,c)local d=1;for i=1,#b do local e=b[i]if e.branch then local g=-1;for h,j in pairs(e.branch.paths)do local k=d;for i2=1,#j do c(j[i2],i2,k)k=k+1 end;g=(g<k)and k or g end;d=g else c(e,i,d)end;d=d+1 end;return b end;function Taiko.GetAllNotes(b)local c={}for d,e in pairs(b)do if e.branch then for f,g in pairs(e.branch.paths)do for i=1,#g do table.insert(c,g[i])end end else table.insert(c,e)end end;return c end;function Taiko.ConnectNotes(b)local c=nil;for i=#b,1,-1 do local d=b[i]d.nextnote=c;c=d end;return b end;function Taiko.ExtractBranch(b,c)return b.branch.paths[c]end;function Taiko.ConnectAll(b)local c=nil;for i=#b,1,-1 do local d=b[i]if d.branch then for e,f in pairs(d.branch.paths)do local g=Taiko.ConnectNotes(f)g[#g].nextnote=c end else d.nextnote=c end;c=d end end;function Taiko.CalculateSpeed(b,c)local d=(c*b.scroll*b.bpm/7500)return d end;function Taiko.CalculateSpeedAll(b,c)for i=1,#b do b[i].speed=Taiko.CalculateSpeed(b[i],c)end;return b end;function Taiko.RenderScale(b)local c={}local d={}local e={}for i=1,#b.Data do local j=b.Data[i]if j.data=='note'then local k=math.floor(j.ms)if math.floor(k)-k==0 then table.insert(c,{k,j.type})table.insert(d,k)else table.insert(e,i)end end end;function gcd2(i,j)if j==0 then return i else return gcd2(j,i%j)end end;function gcdn(i)local j=i[1]for i=2,#i do j=gcd2(j,i[i])end;return j end;local f=gcdn(d)for i=1,#e do local j=c[e[i]]j[1]=math.floor(j[1]/f)*f end;local g=''local h=0;for i=1,#c do c[i][1]=c[i][1]/f;g=g..string.rep(' ',c[i][1]-h)..c[i][2]h=c[i][1]end;return g end;function Taiko.PlaySong(b,c)local d={on=false,fps=60,frames={}}local e=10;local f=1000;local g=4;local h=0;local i=10;local j=0;local k=40;local l=3;local m=1;local n={[1]={color='red'},[2]={color='blue'},[3]={color='red'},[4]={color='blue'},[5]={color='yellow'},[6]={color='yellow'}}k=math.floor(k*g)local o=j+k;l=math.floor(l*g)local p=require('Pixels')local q,r=j,k;local s,t=-i,i;p.Convert.ToDots=function(X)X=GetPixelData(X)local Y,Z=X.Data,X.Color;local ab={}local bb=string.rep('0',8)local cb=p.Data.Dot[bb]local db=nil;local eb=nil;local fb=tostring(p.Color('reset'))if X.Color.All then local gb=tostring(p.Color(X.Color.All))table.insert(ab,gb)eb=gb end;if not s then return''end;for y=s,t,4 do for x=q,r,2 do local gb=Y[x]local hb=Y[x+1]local ib=( (gb)and( (gb[y]or'0').. (gb[y+1]or'0').. (gb[y+2]or'0').. (gb[y+3]or'0'))or'0000').. ( (hb)and( (hb[y]or'0').. (hb[y+1]or'0').. (hb[y+2]or'0').. (hb[y+3]or'0'))or'0000')if ib~=bb then ib=p.Data.Dot[ib]if not eb then local jb=Z[x]local kb=Z[x+1]local lb=( (jb)and(jb[y]or jb[y+1]or jb[y+2]or jb[y+3]))or( (kb)and(kb[y]or kb[y+1]or kb[y+2]or kb[y+3]))if lb then lb=tostring(p.Color(lb))else lb=fb end;if db==lb then else table.insert(ab,lb)db=lb end end;table.insert(ab,ib)else table.insert(ab,cb)end end;table.insert(ab,p.Data.NewLine)end;table.insert(ab,fb)return table.concat(ab)end;p.Circle=function(X,Y,Z,ab,bb)str=GetPixelData(X)bb=bb or{}local cb=bb.color;local db=ab*ab;local eb=ab;for y=0,ab do eb=eb+1;repeat eb=eb-1 until eb*eb+y*y<=db;for x2=0,eb do str.Data[Y+x2]=str.Data[Y+x2]or{}str.Data[Y-x2]=str.Data[Y-x2]or{}str.Data[Y+x2][Z+y]='1'str.Data[Y-x2][Z+y]='1'str.Data[Y+x2][Z-y]='1'str.Data[Y-x2][Z-y]='1'str.Color[Y+x2]=str.Color[Y+x2]or{}str.Color[Y-x2]=str.Color[Y-x2]or{}str.Color[Y+x2][Z+y]=cb;str.Color[Y-x2][Z+y]=cb;str.Color[Y+x2][Z-y]=cb;str.Color[Y-x2][Z-y]=cb end end;return str end;local function u(X,Y)local Z=math.floor(Y.p)local ab,bb=h-i,h+i;for y=ab,bb do local cb=p.GetPixel(X,Z,y)if cb=='0'or cb==nil then p.SetPixel(X,Z,y,'1')end end end;local function v(X,Y,Z)Z=Z or Y.p;p.Circle(X,math.floor(Z),h,g*Y.radius,n[Y.type])end;local function w(X,Y,Z,ab,bb,cb)local db=cb or{}color=db.color;local eb=(j-e)if Y<eb then Y=eb end;local fb=(k+e)if Z>fb then Z=fb end;for y=ab,bb do for x=Y,Z do p.SetPixel(X,x,y,'1')if color then p.SetColor(X,x,y,color)end end end end;local function x(X,Y)local Z=Y.type;if Z==1 or Z==2 or Z==3 or Z==4 then v(X,Y)elseif Z==5 or Z==6 then v(X,Y)local ab=Y.endnote;local bb=(ab.ms-Y.ms)*Y.speed;v(X,Y)local cb=g*Y.radius;local db,eb=math.floor(Y.p),math.floor(Y.p+bb)local fb=h-cb;local gb=h+cb;w(X,db,eb,fb,gb,n[Y.type])elseif Z==8 then v(X,Y.startnote,Y.p)end end;local z={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(X,Y)io.write(string.format("\27[%d;%dH",Y,X))end}b=Taiko.GetDifficulty(b,c)local A=Taiko.GetAllNotes(b.Data)local B=b.Metadata.OFFSET;local function C(X)return(X.data=='note')or(X.data=='event'and X.event=='barline')end;local function D(X,Y)return Y- (( (k+e)/math.abs(X.speed)))end;local function E(X,Y)return(X.ms-Y)*X.speed+l end;local function F(X,Y)return X.loadp- (X.speed* (Y-X.loadms))end;local G={}for X,Y in pairs(A)do Y.ms=Y.ms-B;Y.s=MsToS(Y.ms)Y.speed=Taiko.CalculateSpeed(Y,g)Y.loadms=D(Y,Y.ms)Y.loads=MsToS(Y.loadms)Y.loadp=E(Y,Y.loadms)table.insert(G,Y.ms)end;for X,Y in pairs(b.Data)do if Y.branch then for Z,ab in pairs(Y.branch.paths)do table.sort(ab,function(bb,cb)return bb.loadms<cb.loadms end)end end end;table.sort(b.Data,function(X,Y)if X.branch and Y.branch then for Z,ab in pairs(X.branch.paths)do for bb,cb in pairs(Y.branch.paths)do return ab[1].loadms<cb[1].loadms end end elseif X.branch then for Z,ab in pairs(X.branch.paths)do return ab[1].loadms<Y.loadms end elseif Y.branch then for Z,ab in pairs(Y.branch.paths)do return X.loadms<ab[1].loadms end else return X.loadms<Y.loadms end end)Taiko.ConnectAll(b.Data)Taiko.ForAll(b.Data,function(X,Y,Z)X.n=Z end)local H=math.max(unpack(G))+f;local I={s=1,e=0,n=0}local J=b.Data[1]local K=J.loads;I.e=I.n;local L=10;local M=string.rep(' ',L)local N={}local function O(X,Y)table.insert(N,X)table.insert(N,': ')table.insert(N,Y)table.insert(N,M)table.insert(N,'\n')end;local function P()print(table.concat(N))N={}end;local Q=''local function R(X)Q=Q..'\n'..X end;local function S()print(Q)end;z.ClearScreen()local T='M'local U=0;local V=0;local W=os.clock()if not d.on then while true do local X=p.New()local Y=os.clock()local Z=Y-W;local ab=Z*1000;if J then if J.loadms<ab then I.n=I.n+1;I.e=J.n;I[J.n]=J;J=J.nextnote;if J and J.branch then R('branch')J=J.branch.paths[T][1]end end else if ab>H then break end end;p.Circle(X,math.floor(l),h,g,{color='purple'})for i=I.s,I.e do local cb=I[i]if cb then cb.p=F(cb,ab)if math.abs(cb.p-l)> (k+e+1)then if cb.endnote and cb.endnote.done~=true then else cb.done=true;I[i]=nil;if J and I.n==0 then I.s=J.n elseif cb.n==I.s then if cb.n==I.e then I.n=0 else local db=I.s;repeat db=db+1;I.n=I.n-1 until I[db]I.s=db end end end else if cb.data=='event'then if cb.event=='barline'then u(X,cb)end elseif cb.data=='note'then x(X,cb)else error('Invalid note.data')end end end end;z.SetCursor(1,1)print(X)U=U+1;local bb=os.clock()-Y;V=V+bb;O('S',Z)O('Ms',ab)O('Loaded',I.n)O('Frames Rendered',U)O('Last Frame Render (s)',bb)O('Last Frame Render (ms)',bb*1000)O('Frame Render Total (s)',V)O('Frame Render Total (ms)',V*1000)O('Frame Render Total (%)',V/Z*100)O('FPS (Frame)',U/Z)O('Memory Usage (mb)',collectgarbage('count')/1000)O('Finished (%)',ab/ (H)*100)P()S()end else while true do local Z=p.New()local ab=os.clock()local bb=(1 /d.fps)*U;local cb=bb*1000;if J then if J.loadms<cb then I.n=I.n+1;I.e=J.n;I[J.n]=J;J=J.nextnote;if J and J.branch then R('branch')J=J.branch.paths[T][1]end end else if cb>H then break end end;for i=I.s,I.e do local eb=I[i]if eb then eb.p=F(eb,cb)if(eb.p< (j-e))then if eb.endnote and eb.endnote.done~=true then else eb.done=true;I[i]=nil;if J and I.n==0 then I.s=J.n elseif eb.n==I.s then if eb.n==I.e then I.n=0 else local fb=I.s;repeat fb=fb+1;I.n=I.n-1 until I[fb]I.s=fb end end end end;if eb.p< (k+buffer)then if eb.data=='event'then if eb.event=='barline'then u(Z,eb)end elseif eb.data=='note'then x(Z,eb)else error('Invalid note.data')end end end end;z.SetCursor(1,1)d.frames[U]=Z;U=U+1;local db=os.clock()-ab;V=V+db;O('S',bb)O('Ms',cb)O('Loaded',I.n)O('Frames Rendered',U)O('Last Frame Render (s)',db)O('Last Frame Render (ms)',db*1000)O('Frame Render Total (s)',V)O('Frame Render Total (ms)',V*1000)O('Frame Render Total (%)',V/bb*100)O('FPS (Frame)',U/bb)O('Memory Usage (mb)',collectgarbage('count')/1000)O('Finished (%)',cb/ (H)*100)S()end;print('Prerendering Finished!\nPress enter to start')io.read()local X=os.clock()local Y=(1 /d.fps)while true do local Z=os.clock()-X;local ab=d.frames[math.floor(( (Z-Z%Y)/Y)+0.5)]if ab==nil then break end;z.SetCursor(1,1)print(ab)end end end;file='./tja/donkama.tja'file='./tja/ekiben.tja'file='./tja/saitama.tja'file='./tja/funny2000.tja'file='./tja/waraeru.tja'file='./tja/ekiben.tja'Taiko.PlaySong(Taiko.ParseTJA(io.open(file,'r'):read('*all')),'Oni')
local a;Split=function(b,c)local d={}for e,c in b:gmatch("([^"..c.."]*)("..c.."?)")do table.insert(d,e)if c==''then return d end end end;Trim=function(f)local b=f:gsub("^%s*(.-)%s*$","%1")return b end;TrimLeft=function(f)local b=f:gsub("^%s*(.-)$","%1")return b end;TrimRight=function(f)local b=f:gsub("^(.-)%s*$","%1")return b end;StartsWith=function(b,c)return b:sub(1,#c)==c end;EndsWith=function(b,c)return b:sub(-#c,-1)==c end;Table={}function Table.Clone(g,h)h=h or{}local i=type(g)local j;if i=='table'then if h[g]then j=h[g]else j={}h[g]=j;for k,l in next,g,nil do j[Table.Clone(k,h)]=Table.Clone(l,h)end;setmetatable(j,Table.Clone(getmetatable(g),h))end else j=g end;return j end;ClipN=function(m,b,c)if m<b then return b elseif m>c then return c else return m end end;function Error(n)print(n)end;LineN=nil;function ParseError(o,n,p)Error('Line: '..LineN..'\n'..o..': '..n..(p and', '..p or''))end;function MsToS(q)return q/1000 end;function SToMs(f)return f*1000 end;Taiko={}Taiko.Data={Languages={'','EN','JA','CN','TW','KO'},GenreName={Pop={'pop','j-pop'},Anime={'anime','アニメ'},Kids={'kids','どうよう'},Variety={'variety','バラエティ'},VOCALOID={'vocaloid','ボーカロイド'},Classic={'classic','クラシック'},['Game Music']={'game music','ゲームミュージック'},['Namco Original']={'namco original','ナムコオリジナル'}},CourseId={easy=0,normal=1,hard=2,oni=3,edit=4,tower=5,dan=6,ura=4},CourseName={[0]='Easy','Normal','Hard','Oni','Edit','Tower','Dan','Ura'},RatingMultiplier={[0]=0,[1]=0.5,[2]=1,[3]=2},GogoMultiplier=1.2,ScoreMode={[0]=function(r,s,t,u,v,w)return r+(s<200 and(t or 1000)or(t or 1000)+(u or 1000))*Taiko.Data.RatingMultiplier[v]*(w and Taiko.Data.GogoMultiplier or 1)end,[1]=function(r,s,t,u,v,w)return r+(t+math.max(0,u*math.floor((math.min(s,100)-1)/10)))*Taiko.Data.RatingMultiplier[v]*(w and Taiko.Data.GogoMultiplier or 1)end,[2]=function(r,s,t,u,v,w)return r+(t+u*(s>=100 and 8 or s>=50 and 4 or s>=30 and 2 or s>=10 and 1 or 0))*Taiko.Data.RatingMultiplier[v]*(w and Taiko.Data.GogoMultiplier or 1)end},Autoscore={[0]=function(x)end,[1]=function(x)end,[2]=function(x)end},SideId={normal=1,ex=2,both=3},SideName={'normal','ex','both'},StyleId={single=1,double=2,couple=2},StyleName={'single','double'},Exam={Condition={g=true,jp=true,jg=true,jb=true,s=true,r=true,h=true,c=true},Scope={m=true,l=true}},Branch={PathId={N=0,E=1,M=2},PathName={[0]='N',[1]='E',[2]='M'},Requirements={r=function()end,p=function()end}},Timing={GetFunction=function(y)return function(z)if y==1 then return{good=5/2*z,ok=13/2*z,bad=15/2*z}else return{good=3/2*z,ok=9/2*z,bad=13/2*z}end end end},StatusId={bad=0,ok=1,good=2,biggood=3},StatusName={[0]='BAD',[1]='OK',[2]='GOOD',[3]='GOOD'},ModeId={['']=0,P1=1,P2=2},ModeName={[0]='',P1,P2},Combo={[1]=true,[2]=true,[3]=true,[4]=true},BigLeniency=2}for A,B in pairs(Taiko.Data.ScoreMode)do Taiko.Data.ScoreMode[A]=function(...)return math.floor(B(...)/10)*10 end end;function Taiko.ParseTJA(C)local D=os.clock()local E={}local x={Metadata={BPM=120,WAVE='main.mp3',OFFSET=0,DEMOSTART=0,SCOREMODE=1,SONGVOL=100,SEVOL=100,SIDE=3,LIFE=0,GAME='Taiko',HEADSCROLL=1,MOVIEOFFSET=0,COURSE='ONI',LEVEL=0,BALLOON=nil,SCOREINIT,SCOREDIFF,BALLOONNOR=nil,BALLOONEXP=nil,BALLOONMAS=nil,STYLE=1,EXAM1=nil,EXAM2=nil,EXAM3=nil,GAUGEINCR='NORMAL',TOTAL=nil,HIDDENBRANCH=0,DIVERGENOTES=false,SCOREINIT=0,SCOREDIFF=0},Data={}}local function F(G)local b=Taiko.Data.Languages;for H=1,#b do local c=x.Metadata[G..b[H]]if c then return c end end;return nil end;local function I(o,m,J)local b=tonumber(m)if b then return b else ParseError(o,J,m)end end;local function K(o,b,J,p)if b then return b else ParseError(o,J,p)end end;local function L(o,c,J)local M={['true']=true,['false']=false,yes=true,no=false,['1']=true,['0']=false,[1]=true,[0]=false}local b=M[c]~=nil;if b then return b else ParseError(o,J,c)end end;local function N(o,O)local P=','local Q='\\'local R={}local S=''local T=false;for H=1,#O do local f=string.sub(O,H,H)if T then S=S..f;T=false else if f==P then table.insert(R,S)S=''elseif f==Q then T=true else S=S..f end end end;table.insert(R,S)return R end;local function U(o,O,J)local R=N(o,O)for H=1,#R do R[H]=I(o,R[H],J,O)end;return R end;local function V(o,f,J)if f and f~=''then return U(o,f,J)else return{}end end;local function W(o,f,J)if f and f~=''then local R=N(o,f,J)K(o,Taiko.Data.Exam.Condition[R[1]],J)R[2]=I(o,R[2],J)R[3]=I(o,R[3],J)K(o,Taiko.Data.Exam.Scope[R[4]],J)return R else return{}end end;local X={}local function Y()local X={settings={noteparse={notealias={A=3,B=4},noteexceptions={[',']=true,[' ']=true,['\t']=true}},command={matchexceptions={}}},bpm=0,ms=0,songstarted=false,timingpoint=nil,sign=4/4,mpm=0,mspermeasure=0,scroll=1,measuredone=true,currentmeasure={},measurepushto=x.Data,barline=true,gogo=false,lastlong=nil,balloonn=1,currentbranch=nil,branch={on=false,requirements={},paths={}},msbeforebranch=nil}function X.createnote(m)if m then local Z={ms=nil,data=nil,type=m,txt=nil,gogo=X.gogo,scroll=X.scroll*x.Metadata.HEADSCROLL,mspermeasure=X.mspermeasure,bpm=X.bpm,nextnote=nil,radius=1,requiredhits=nil,length=nil,endnote=nil,onnotepush=nil}Z.type=m;if m==3 or m==4 or m==6 then Z.radius=Z.radius*1.6 end;if m==5 or m==6 or m==7 or m==9 then if X.lastlong then if m==9 then else ParseError('parser.noteparse','Last long note has not ended')end else X.lastlong=Z;if m==7 or m==9 then Z.requiredhits=K('parser.noteparse',x.Metadata.BALLOON[X.balloonn],'Invalid number of balloons',X.balloonn)X.balloonn=X.balloonn+1 end end end;if m==8 then local _=X.lastlong;X.lastlong=nil;Z.startnote=_;if _ then Z.onnotepush=function()_.length=Z.ms-_.ms;_.endnote=Z end else end end;return Z else return{ms=nil,data=nil,type=nil,txt=nil,gogo=X.gogo,scroll=X.scroll*x.Metadata.HEADSCROLL,mspermeasure=X.mspermeasure,bpm=X.bpm,nextnote=nil}end end;function X.endbranch()local m=X.createnote()m.data='event'm.event='branch'm.branch={requirements=X.branch.requirements,paths=X.branch.paths}X.branch.on=false;X.branch.requirements={}X.branch.paths={}table.insert(x.Data,m)X.measurepushto=x.Data end;return X end;X=Y()local a0=Split(C,'\n')for H=1,#a0 do LineN=H;local a1=Trim(a0[H])if StartsWith(a1,'//')or a1==''then else local a2=string.find(a1,'//')if a2 then a1=string.sub(a1,1,a2-1)end;local a3=false;if X.songstarted==false and a3==false then local a4={string.match(a1,'(%u+):(.*)')}if a4[1]then local b=Trim(a4[2])if b~=''then x.Metadata[Trim(a4[1])]=b end;a3=true end end;if(X.songstarted or StartsWith(a1,'#START'))and a3==false then local a4={string.match(a1,'#(%u-)%s(.*)')}if not a4[1]then a4={string.match(a1,'#(%u+)')}end;if a4[1]then if a4[1]=='START'then if X.songstarted then ParseError(a4[1],'Song has already started')else x.OriginalMetadata=Table.Clone(x.Metadata)if a4[2]then x.Metadata.MODE=K(a4[1],Taiko.Data.ModeId[a4[2]],'Invalid mode',a4[2])else x.Metadata.MODE=0 end;x.Metadata.TITLE=K(a4[1],F('TITLE'),'Title is missing')x.Metadata.SUBTITLE=K(a4[1],F('SUBTITLE'),'Subtitle is missing')x.Metadata.BPM=I(a4[1],x.Metadata.BPM,'Invalid bpm')x.Metadata.OFFSET=SToMs(I(a4[1],x.Metadata.OFFSET,'Invalid offset'))x.Metadata.DEMOSTART=SToMs(I(a4[1],x.Metadata.DEMOSTART,'Invalid demostart'))if x.Metadata.DEMOSTART==0 then x.Metadata.DEMOSTART=nil end;for A,B in pairs(Taiko.Data.GenreName)do for H=1,#B do if B[H]==x.Metadata.GENRE then x.Metadata.GENRE=A end end end;x.Metadata.SCOREMODE=I(a4[1],x.Metadata.SCOREMODE,'Invalid scoremode')K(a4[1],Taiko.Data.ScoreMode[x.Metadata.SCOREMODE],'Invalid scoremode',x.Metadata.SCOREMODE)if x.Metadata.MAKER then x.Metadata.CREATORURLT={}x.Metadata.CREATOR=Trim(string.gsub(x.Metadata.MAKER,'(<.->)',function(a5)table.insert(x.Metadata.CREATORURLT,string.sub(a5,2,-2))return''end))x.Metadata.CREATORURL=table.concat(x.Metadata.CREATORURLT,', ')x.Metadata.CREATIVE=false else x.Metadata.CREATIVE=false end;x.Metadata.SONGVOL=I(a4[1],x.Metadata.SONGVOL,'Invalid songvol')/100;x.Metadata.SEVOL=I(a4[1],x.Metadata.SEVOL,'Invalid sevol')/100;local b=tonumber(x.Metadata.SIDE)if b then K(a4[1],Taiko.Data.SideName[b],'Invalid side id',x.Metadata.SIDE)x.Metadata.SIDE=b else x.Metadata.SIDE=K(a4[1],Taiko.Data.SideId[string.lower(x.Metadata.SIDE)],'Invalid side name',x.Metadata.SIDE)end;x.Metadata.LIFE=I(a4[1],x.Metadata.LIFE,'Invalid life')if x.Metadata.LIFE==0 then x.Metadata.LIFE=nil end;x.Metadata.GAME=string.lower(x.Metadata.GAME)if x.Metadata.GAME=='taiko'then elseif x.Metadata.GAME=='jube'then else end;x.Metadata.HEADSCROLL=I(a4[1],x.Metadata.HEADSCROLL,'Invalid headscroll')x.Metadata.MOVIEOFFSET=I(a4[1],x.Metadata.MOVIEOFFSET,'Invalid movieoffset')local b=tonumber(x.Metadata.COURSE)if b then K(a4[1],Taiko.Data.CourseName[b],'Invalid course id',x.Metadata.COURSE)x.Metadata.COURSE=b else x.Metadata.COURSE=K(a4[1],Taiko.Data.CourseId[string.lower(x.Metadata.COURSE)],'Invalid course name',x.Metadata.COURSE)end;x.Metadata.TIMING=Taiko.Data.Timing.GetFunction(x.Metadata.COURSE)x.Metadata.LEVEL=ClipN(math.floor(I(a4[1],x.Metadata.LEVEL,'Invalid level')),0,10)x.Metadata.BALLOON=V(a4[1],x.Metadata.BALLOON,'Invalid balloon')x.Metadata.SCOREINIT=I(a4[1],x.Metadata.SCOREINIT,'Invalid scoreinit')x.Metadata.SCOREDIFF=I(a4[1],x.Metadata.SCOREDIFF,'Invalid scoreinit')x.Metadata.BALLOONNOR=V(a4[1],x.Metadata.BALLOONNOR,'Invalid balloonnor')x.Metadata.BALLOONEXP=V(a4[1],x.Metadata.BALLOONEXP,'Invalid balloonexp')x.Metadata.BALLOONMAS=V(a4[1],x.Metadata.BALLOONMAS,'Invalid balloonmas')local b=tonumber(x.Metadata.STYLE)if b then K(a4[1],Taiko.Data.StyleName[b],'Invalid style id',Taiko.Data.STYLE)x.Metadata.STYLE=b else x.Metadata.STYLE=K(a4[1],Taiko.Data.StyleId[string.lower(x.Metadata.STYLE)],'Invalid style name',x.Metadata.STYLE)end;x.Metadata.EXAM1=W(x.Metadata.EXAM1)x.Metadata.EXAM2=W(x.Metadata.EXAM2)x.Metadata.EXAM3=W(x.Metadata.EXAM3)x.Metadata.GAUGEINCR=string.lower(x.Metadata.GAUGEINCR)if x.Metadata.TOTAL then x.Metadata.TOTAL=I(a4[1],x.Metadata.TOTAL,'Invalid total')end;x.Metadata.HIDDENBRANCH=L(a4[1],x.Metadata.HIDDENBRANCH,'Invalid hiddenbranch')X.bpm=x.Metadata.BPM;X.songstarted=true end elseif a4[1]=='END'then if X.songstarted then if#X.currentmeasure~=0 then ParseError(a4[1],'Current measure is not empty')end;table.insert(E,x)x={Metadata=Table.Clone(x.OriginalMetadata),Data={}}X=Y()X.songstarted=false;X.measurepushto=x.Data else ParseError(a4[1],'Song has already ended')end elseif a4[1]=='MEASURE'then local b,c=string.match(a4[2],'(%d+)/(%d+)')b=I(a4[1],b,'Invalid measure')c=I(a4[1],c,'Invalid measure')X.sign=b/c or X.sign elseif a4[1]=='BPMCHANGE'then X.bpm=I(a4[1],a4[2],'Invalid bpmchange')or X.bpm elseif a4[1]=='DELAY'then table.insert(X.currentmeasure,{a4[1],SToMs(I(a4[1],a4[2],'Invalid delay')or 0)})elseif a4[1]=='SCROLL'then X.scroll=I(a4[1],a4[2],'Invalid scroll')or X.scroll;if X.scroll==0 then ParseError(a4[1],'Scroll cannot be 0')end elseif a4[1]=='GOGOSTART'then X.gogo=true elseif a4[1]=='GOGOEND'then X.gogo=false elseif a4[1]=='BARLINEOFF'then X.barline=false elseif a4[1]=='BARLINEON'then X.barline=true elseif a4[1]=='BRANCHSTART'then if X.branch.on then X.endbranch()end;X.msbeforebranch=X.ms;X.branch.on=true;x.Metadata.DIVERGENOTES=true;local R=N(a4[1],a4[2])local a6=K(a4[1],Taiko.Data.Branch.Requirements[string.lower(R[1])],'Invalid type',R[1])X.branch.requirements={a6}local H=2;while true do if not R[H]then break end;local a7=Taiko.Data.Branch.PathName[H-1]if a7 then X.branch.requirements[a7]=R[H]else break end;H=H+1 end elseif Taiko.Data.Branch.PathId[a4[1]]then if X.branch.on then X.ms=X.msbeforebranch;X.currentbranch=a4[1]X.branch.paths[a4[1]]={}X.measurepushto=X.branch.paths[a4[1]]else ParseError(a4[1],'Branch has not started')end elseif a4[1]=='BRANCHEND'then if X.branch.on then X.endbranch()else ParseError(a4[1],'Branch has already ended')end elseif a4[1]=='SECTION'then elseif a4[1]=='LYRIC'then elseif a4[1]=='LEVELHOLD'then elseif a4[1]=='BMSCROLL'then elseif a4[1]=='HBSCROLL'then elseif a4[1]=='SENOTECHANGE'then elseif a4[1]=='NEXTSONG'then elseif a4[1]=='DIRECTION'then elseif a4[1]=='SUDDEN'then elseif a4[1]=='JPOSSCROLL'then else end;a3=true end end;if X.songstarted and a3==false then X.mpm=X.bpm*X.sign/4;X.mspermeasure=60000*X.sign*4/X.bpm;if X.barline and#X.currentmeasure==0 then local Z=X.createnote()Z.ms=X.ms;Z.data='event'Z.event='barline'table.insert(X.measurepushto,1,Z)end;for H=1,#a1 do local f=string.sub(a1,H,H)if X.settings.noteparse.noteexceptions[f]then else local m=I('parser.noteparse',tonumber(f)or X.settings.noteparse.notealias[f]or f,'Invalid note')if m then local Z=X.createnote(m)Z.data='note'table.insert(X.currentmeasure,Z)end end end;if EndsWith(TrimRight(a1),',')then X.mpm=X.bpm*X.sign/4;X.mspermeasure=60000*X.sign*4/X.bpm;if#X.currentmeasure==0 then X.ms=X.ms+X.mspermeasure else local a8=0;local a9=nil;for H=1,#X.currentmeasure do local d=X.currentmeasure[H]if d.data=='note'then a9=a9 or d.mspermeasure;a8=a8+1 end end;a9=a9 or X.mspermeasure;local aa=a9/a8;for H=1,#X.currentmeasure do local d=X.currentmeasure[H]if d[1]=='DELAY'then X.ms=X.ms+d[2]else if d.type~=0 then d.ms=X.ms;local ab=x.Data[#x.Data]if ab then ab.nextnote=d end;table.insert(X.measurepushto,d)if d.onnotepush then d.onnotepush()end;aa=d.mspermeasure/a8 end end;X.ms=X.ms+aa end end;X.measuredone=true;X.currentmeasure={}else X.measuredone=false end end end end;print('Parsing Took: '..SToMs(os.clock()-D)..'ms')return E end;function Taiko.Score(x,r,s,v,w)if v==0 then s=0 else s=s+1 end;local ac=x.Metadata;return Taiko.Data.ScoreMode[ac.SCOREMODE](r,s,ac.SCOREINIT,ac.SCOREDIFF,v,w),s end;function Taiko.Analyze(x)local ad='M'local ae={[1]=2,[2]=2,[3]=3,[4]=3}local af={notes={n=0,validn=0},measures=0,lengthms=0,drumrollms=0,drumrollbigms=0,balloonms=0,balloonhit=0,specialms=0,specialhit=0,maxcombo=0,maxscore=0}local ab=nil;Taiko.ForAll(x.Data,function(Z,H,m)if Z.data=='note'then af.notes.n=af.notes.n+1;af.notes[Z.type]=af.notes[Z.type]and af.notes[Z.type]+1 or 1;if ae[Z.type]then af.maxscore,af.maxcombo=Taiko.Score(x,af.maxscore,af.maxcombo,ae[Z.type],Z.gogo)end;local ag=Z.endnote;if ag then local q=ag.ms-Z.ms;if Z.type==5 then af.drumrollms=af.drumrollms+q elseif Z.type==6 then af.drumrollbigms=af.drumrollbigms+q elseif Z.type==7 then af.balloonms=af.balloonms+q;af.balloonhit=af.balloonhit+Z.requiredhits elseif Z.type==9 then af.specialms=af.specialms+q;af.specialhit=af.specialhit+Z.requiredhits else end end;ab=Z elseif Z.data=='event'and Z.event=='barline'then af.measures=af.measures+1 else end end,ad)af.lengthms=ab.ms-x.Metadata.OFFSET;af.notes.validn=af.maxcombo;return af end;function Taiko.GetDifficulty(x,ah)local b=Taiko.Data.CourseId[string.lower(ah)]or ah;for A,B in pairs(x)do if B.Metadata.COURSE==b then return B end end;Error('No difficulty found, '..ah)return nil end;function Taiko.ForAll(ai,a6,ad)local m=1;for H=1,#ai do local B=ai[H]if B.branch then if ad then local c=B.branch.paths[ad]for aj=1,#c do a6(c[aj],aj,m)m=m+1 end;m=m-1 else local ak=-1;for al,am in pairs(B.branch.paths)do local an=m;for aj=1,#am do a6(am[aj],aj,an)an=an+1 end;ak=ak<an and an or ak end;m=ak end else a6(B,H,m)end;m=m+1 end;return ai end;function Taiko.GetAllNotes(ai)local R={}for A,B in pairs(ai)do if B.branch then for al,am in pairs(B.branch.paths)do for H=1,#am do table.insert(R,am[H])end end else table.insert(R,B)end end;return R end;function Taiko.ConnectNotes(ai)local ao=nil;for H=#ai,1,-1 do local m=ai[H]m.nextnote=ao;ao=m end;return ai end;function Taiko.ExtractBranch(ad,ap)return ad.branch.paths[ap]end;function Taiko.ConnectAll(ai)local ao=nil;for H=#ai,1,-1 do local Z=ai[H]if Z.branch then for A,B in pairs(Z.branch.paths)do local ap=Taiko.ConnectNotes(B)ap[#ap].nextnote=ao end else Z.nextnote=ao end;ao=Z end end;function Taiko.CalculateSpeed(Z,aq)local ar=aq*Z.scroll*Z.bpm/7500;return ar end;function Taiko.CalculateSpeedAll(ai,aq)for H=1,#ai do ai[H].speed=Taiko.CalculateSpeed(ai[H],aq)end;return ai end;function Taiko.RenderScale(x)local R={}local as={}local at={}for H=1,#x.Data do local Z=x.Data[H]if Z.data=='note'then local q=math.floor(Z.ms)if math.floor(q)-q==0 then table.insert(R,{q,Z.type})table.insert(as,q)else table.insert(at,H)end end end;function gcd2(b,c)if c==0 then return b else return gcd2(c,b%c)end end;function gcdn(au)local av=au[1]for H=2,#au do av=gcd2(av,au[H])end;return av end;local aw=gcdn(as)for H=1,#at do local e=R[at[H]]e[1]=math.floor(e[1]/aw)*aw end;local O=''local q=0;for H=1,#R do R[H][1]=R[H][1]/aw;O=O..string.rep(' ',R[H][1]-q)..R[H][2]q=R[H][1]end;return O end;function Taiko.PlaySong(x,ax,ay)local az={on=false,fps=60,frames={}}local aA=nil;local aB=false;local aC=false;local ax=ax or{}ax={Hit=ax.Hit or{['4']=2,['v']=1,['n']=1,['8']=2},Escape=ax.Escape or{['\27']=true,ALT_ESC=true},L=ax.L or{KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_A2=true},R=ax.R or{KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true},Select=ax.Select or{KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true}}local aD=1;local aE=2;local aF='>'local aG='\n\n\n'local aH=10;local aI=1000;local aq=4;local aJ=0;local aK=10;local aL=0;local aM=40;local aN=3;local aO=1;local aP={[1]={color='red'},[2]={color='blue'},[3]={color='red'},[4]={color='blue'},[5]={color='yellow'},[6]={color='yellow'}}local aQ=200;local aR=aQ/4;local aS=4;local aT=20;aM=math.floor(aM*aq)local aU=aL+aM;aN=math.floor(aN*aq)local aV=require('taikocurses')local aW=ay or{window=aV.initscr()}aV.keypad(aW,true)aV.echo(false)aV.raw(true)aV.nl(false)aV.cbreak(true)aV.nodelay(aW,true)local aX={[0]={Data={[1]={'0','1','1','1','1','1','1','1'},[2]={[2]='1',[5]='1',[8]='1'},[3]={[2]='1',[5]='1',[8]='1'},[4]={[2]='1',[5]='1',[8]='1'},[5]={[2]='1',[5]='1',[8]='1'},[6]={[3]='1',[4]='1',[6]='1',[7]='1'},[8]={'0','0','1','1','1','1','1','1'},[9]={[2]='1',[5]='1'},[10]={[2]='1',[5]='1'},[11]={[2]='1',[5]='1'},[12]={[2]='1',[5]='1'},[13]={'0','0','1','1','1','1','1','1'},[15]={'0','1','1','1','1','1','1','1'},[16]={[2]='1',[8]='1'},[17]={[2]='1',[8]='1'},[18]={[2]='1',[8]='1'},[19]={[2]='1',[8]='1'},[20]={'0','0','1','1','1','1','1','0'}},Color={All='blue'},Offset={-1,0}},[1]={Data={[1]={'0','0','1','1','1','1','1','0'},[2]={[2]='1',[8]='1'},[3]={[2]='1',[8]='1'},[4]={[2]='1',[8]='1'},[5]={[2]='1',[8]='1'},[6]={'0','0','1','1','1','1','1','0'},[8]={'0','1','1','1','1','1','1','1'},[9]={[5]='1'},[10]={[4]='1',[6]='1'},[11]={[3]='1',[7]='1'},[12]={[2]='1',[8]='1'}},Color={All='white'},Offset={-1,0}},[2]={Data={[1]={'0','0','1','1','1','1','1','0'},[2]={[2]='1',[8]='1'},[3]={[2]='1',[8]='1'},[4]={[2]='1',[5]='1',[8]='1'},[5]={[2]='1',[5]='1',[8]='1'},[6]={'0','1','0','0','1','1','1','1'},[8]={'0','0','1','1','1','1','1','0'},[9]={[2]='1',[8]='1'},[10]={[2]='1',[8]='1'},[11]={[2]='1',[8]='1'},[12]={[2]='1',[8]='1'},[13]={'0','0','1','1','1','1','1','0'},[15]={'0','0','1','1','1','1','1','0'},[16]={[2]='1',[8]='1'},[17]={[2]='1',[8]='1'},[18]={[2]='1',[8]='1'},[19]={[2]='1',[8]='1'},[20]={'0','0','1','1','1','1','1','0'},[22]={'0','1','1','1','1','1','1','1'},[23]={[2]='1',[8]='1'},[24]={[2]='1',[8]='1'},[25]={[2]='1',[8]='1'},[26]={[2]='1',[8]='1'},[27]={'0','0','1','1','1','1','1','0'}},Color={All='yellow'},Offset={-1,0}}}aX[3]=aX[2]local aY={[0]=nil,[1]={},[2]={}}local aZ;if a then aZ=a else os.execute('chcp 65001')aZ={}local a_=([[
⠀ ⢀ ⠠ ⢠ ⠐ ⢐ ⠰ ⢰ ⠈ ⢈ ⠨ ⢨ ⠘ ⢘ ⠸ ⢸
⡀ ⣀ ⡠ ⣠ ⡐ ⣐ ⡰ ⣰ ⡈ ⣈ ⡨ ⣨ ⡘ ⣘ ⡸ ⣸
⠄ ⢄ ⠤ ⢤ ⠔ ⢔ ⠴ ⢴ ⠌ ⢌ ⠬ ⢬ ⠜ ⢜ ⠼ ⢼
⡄ ⣄ ⡤ ⣤ ⡔ ⣔ ⡴ ⣴ ⡌ ⣌ ⡬ ⣬ ⡜ ⣜ ⡼ ⣼
⠂ ⢂ ⠢ ⢢ ⠒ ⢒ ⠲ ⢲ ⠊ ⢊ ⠪ ⢪ ⠚ ⢚ ⠺ ⢺
⡂ ⣂ ⡢ ⣢ ⡒ ⣒ ⡲ ⣲ ⡊ ⣊ ⡪ ⣪ ⡚ ⣚ ⡺ ⣺
⠆ ⢆ ⠦ ⢦ ⠖ ⢖ ⠶ ⢶ ⠎ ⢎ ⠮ ⢮ ⠞ ⢞ ⠾ ⢾
⡆ ⣆ ⡦ ⣦ ⡖ ⣖ ⡶ ⣶ ⡎ ⣎ ⡮ ⣮ ⡞ ⣞ ⡾ ⣾
⠁ ⢁ ⠡ ⢡ ⠑ ⢑ ⠱ ⢱ ⠉ ⢉ ⠩ ⢩ ⠙ ⢙ ⠹ ⢹
⡁ ⣁ ⡡ ⣡ ⡑ ⣑ ⡱ ⣱ ⡉ ⣉ ⡩ ⣩ ⡙ ⣙ ⡹ ⣹
⠅ ⢅ ⠥ ⢥ ⠕ ⢕ ⠵ ⢵ ⠍ ⢍ ⠭ ⢭ ⠝ ⢝ ⠽ ⢽
⡅ ⣅ ⡥ ⣥ ⡕ ⣕ ⡵ ⣵ ⡍ ⣍ ⡭ ⣭ ⡝ ⣝ ⡽ ⣽
⠃ ⢃ ⠣ ⢣ ⠓ ⢓ ⠳ ⢳ ⠋ ⢋ ⠫ ⢫ ⠛ ⢛ ⠻ ⢻
⡃ ⣃ ⡣ ⣣ ⡓ ⣓ ⡳ ⣳ ⡋ ⣋ ⡫ ⣫ ⡛ ⣛ ⡻ ⣻
⠇ ⢇ ⠧ ⢧ ⠗ ⢗ ⠷ ⢷ ⠏ ⢏ ⠯ ⢯ ⠟ ⢟ ⠿ ⢿
⡇ ⣇ ⡧ ⣧ ⡗ ⣗ ⡷ ⣷ ⡏ ⣏ ⡯ ⣯ ⡟ ⣟ ⡿ ⣿]]):gsub('\n',' ')function GenerateDotData()function ToBinary(b)local R={}while b>0 do local av=math.fmod(b,2)R[#R+1]=string.sub(av,1,1)b=(b-av)/2 end;local f=string.reverse(table.concat(R))return string.rep('0',8-#f)..f end;local function b0(f)return f end;local R=Split(a_,' ')local b1={}local b2=false;local O=''local b3=' 'for H=1,#R do b1[ToBinary(H-1)]=b0(R[H])if b2 then print(ToBinary(H-1)..R[H])local b4=io.read()if b4==''then b4=R[H]elseif b4=='stop'then break end;O=O..b4 ..b3 end end;if b2 then print(O)io.open('Data.lua','a+'):write(O)end;return b1 end;aZ.Data={}aZ.Data.Dot=GenerateDotData()aZ.ColorData={reset=0,clear=0,space=0,bright=1,bold=1,dim=2,faint=1,italic=3,underline=4,blink=5,reverse=7,invisible=8,hidden=8,strikethrough=9,black=30,red=31,green=32,yellow=33,blue=34,purple=35,magenta=35,cyan=36,white=37,onblack=40,onred=41,ongreen=42,onyellow=43,onblue=44,onpurple=45,onmagenta=45,oncyan=46,onwhite=47}aZ.Color={}for A,B in pairs(aZ.ColorData)do aZ.Color[A]='\27['..B..'m'end;local b5,b6=aL,aM;local b7,b8=-aK,aK;b7,b8=-20,20;aZ.Convert={}aZ.Convert.ToDots=function(O)local p,b9=O.Data,O.Color;local af={}local ba=string.rep('0',8)local bb=aZ.Data.Dot[ba]local bc=nil;local bd=nil;local be=aZ.Color['reset']if O.Color.All then local d=aZ.Color[O.Color.All]table.insert(af,d)bd=d end;if not b7 then return''end;for aJ=b7,b8,4 do for bf=b5,b6,2 do local bg=p[bf]local bh=p[bf+1]local bi=(bg and(bg[aJ]or'0')..(bg[aJ+1]or'0')..(bg[aJ+2]or'0')..(bg[aJ+3]or'0')or'0000')..(bh and(bh[aJ]or'0')..(bh[aJ+1]or'0')..(bh[aJ+2]or'0')..(bh[aJ+3]or'0')or'0000')if bi~=ba then bi=aZ.Data.Dot[bi]if not bd then local bg=b9[bf]local bh=b9[bf+1]local color=bg and(bg[aJ]or bg[aJ+1]or bg[aJ+2]or bg[aJ+3])or bh and(bh[aJ]or bh[aJ+1]or bh[aJ+2]or bh[aJ+3])if color then color=aZ.Color[color]else color=be end;if bc==color then else table.insert(af,color)bc=color end end;table.insert(af,bi)else table.insert(af,bb)end end;table.insert(af,'\n')end;table.insert(af,be)return table.concat(af)end;aZ.CircleGen=function(O,bj,bk,av,bl)bl=bl or{}local color=bl.color;local bm=av*av;local bf=av;for aJ=0,av do bf=bf+1;repeat bf=bf-1 until bf*bf+aJ*aJ<=bm;for bn=0,bf do O.Data[bj+bn]=O.Data[bj+bn]or{}O.Data[bj-bn]=O.Data[bj-bn]or{}O.Data[bj+bn][bk+aJ]='1'O.Data[bj-bn][bk+aJ]='1'O.Data[bj+bn][bk-aJ]='1'O.Data[bj-bn][bk-aJ]='1'O.Color[bj+bn]=O.Color[bj+bn]or{}O.Color[bj-bn]=O.Color[bj-bn]or{}O.Color[bj+bn][bk+aJ]=color;O.Color[bj-bn][bk+aJ]=color;O.Color[bj+bn][bk-aJ]=color;O.Color[bj-bn][bk-aJ]=color end end;return O end;local bo={}aZ.Circle=function(O,bj,bk,av,bl)local bp=nil;if bo[av]then else bo[av]=aZ.CircleGen(aZ.New(),0,0,av)end;local d=bl and bl.color;bp=bo[av]for bf,B in pairs(bp.Data)do for aJ,am in pairs(B)do local bf,aJ=bf+bj,aJ+bk;O.Data[bf]=O.Data[bf]or{}O.Data[bf][aJ]=am;O.Color[bf]=O.Color[bf]or{}O.Color[bf][aJ]=d end end;return O end;aZ.New=function()return{Data={},Color={}}end;a=aZ end;local function bq(af,Z)local bf=math.floor(Z.p)local br,bs=aJ-aK,aJ+aK;for aJ=br,bs do local b=af.Data[bf]and af.Data[bf][aJ]if b=='0'or b==nil then af.Data[bf]=af.Data[bf]or{}af.Data[bf][aJ]='1'end end end;local function bt(af,Z,a7)a7=a7 or Z.p;aZ.Circle(af,math.floor(a7),aJ,aq*Z.radius,aP[Z.type])end;local function bu(af,bv,bn,br,bs,bl)local bl=bl or{}color=bl.color;local bw=aL-aH;if bv<bw then bv=bw end;local bx=aM+aH;if bn>bx then bn=bx end;for aJ=br,bs do for bf=bv,bn do af.Data[bf]=af.Data[bf]or{}af.Data[bf][aJ]='1'if color then af.Color[bf]=af.Color[bf]or{}af.Color[bf][aJ]=color end end end end;local function by(af,Z)local m=Z.type;if m==1 or m==2 or m==3 or m==4 then bt(af,Z)elseif m==5 or m==6 then bt(af,Z)local ag=Z.endnote;local bz=(ag.ms-Z.ms)*Z.speed;bt(af,Z)local av=aq*Z.radius;local bv,bn=math.floor(Z.p),math.floor(Z.p+bz)local br=math.floor(aJ-av)local bs=math.floor(aJ+av)bu(af,bv,bn,br,bs,aP[Z.type])elseif m==8 then bt(af,Z.startnote,Z.p)end end;local function bA(af,v,q)local bB=aS/(aR/2)local bC=-bB*math.abs((q-v.startms)/(aQ/aR)-aS/bB)+aS;local R=aX[v.status]local bD=R.Offset;local d=R.Color.All;local bE,bF=0,-math.floor(aq*1.6)-8-math.floor(bC)for bf,B in pairs(R.Data)do for aJ,am in pairs(B)do if am=='1'then local bf,aJ=bf+bD[1]+bE,aJ+bD[2]+bF;af.Data[bf]=af.Data[bf]or{}af.Data[bf][aJ]=am;af.Color[bf]=af.Color[bf]or{}af.Color[bf][aJ]=d end end end end;local function bG(af,v)local R=aY[v.status]local bD=R.Offset;local d=R.Color.All;local bE,bF=0,0;for bf,B in pairs(R.Data)do for aJ,am in pairs(B)do if am=='1'then local bf,aJ=bf+bD[1]+bE,aJ+bD[2]+bF;af.Data[bf]=af.Data[bf]or{}af.Data[bf][aJ]=am;af.Color[bf]=af.Color[bf]or{}af.Color[bf][aJ]=d end end end end;local bH={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(bf,aJ)io.write(string.format("\27[%d;%dH",aJ,bf))end}local bI=Taiko.GetAllNotes(x.Data)local bJ=x.Metadata.OFFSET;local z=1000/60;local bK=x.Metadata.TIMING(z)local function bL(Z)return Z.data=='note'or Z.data=='event'and Z.event=='barline'end;local function bM(Z,q)return q-(aM+aH)/math.abs(Z.speed)end;local function bN(Z,bO)return(Z.ms-bO)*Z.speed+aN end;local function bP(Z,q)return Z.loadp-Z.speed*(q-Z.loadms)end;local bQ={}for A,B in pairs(bI)do B.ms=B.ms-bJ;B.s=MsToS(B.ms)B.speed=Taiko.CalculateSpeed(B,aq)B.loadms=bM(B,B.ms)B.loads=MsToS(B.loadms)B.loadp=bN(B,B.loadms)B.hit=nil;table.insert(bQ,B.ms)end;for A,B in pairs(x.Data)do if B.branch then for al,am in pairs(B.branch.paths)do table.sort(am,function(b,c)return b.loadms<c.loadms end)end end end;table.sort(x.Data,function(b,c)if b.branch and c.branch then for A,B in pairs(b.branch.paths)do for al,am in pairs(c.branch.paths)do return B[1].loadms<am[1].loadms end end elseif b.branch then for A,B in pairs(b.branch.paths)do return B[1].loadms<c.loadms end elseif c.branch then for A,B in pairs(c.branch.paths)do return b.loadms<B[1].loadms end else return b.loadms<c.loadms end end)Taiko.ConnectAll(x.Data)Taiko.ForAll(x.Data,function(Z,H,m)Z.n=m end)local aI=math.max(unpack(bQ))+aI;local bR={s=1,e=0,n=0}local ao=x.Data[1]local bS=ao.loads;bR.e=bR.n;local bT=10;local bU=string.rep(' ',bT)local bV={}local function bW(A,B)table.insert(bV,A)table.insert(bV,': ')table.insert(bV,tostring(B))table.insert(bV,bU)table.insert(bV,'\n')end;local function bX()print(table.concat(bV))bV={}end;local bY=''local function bZ(f)bY=bY..'\n'..f end;local function b_()print(bY)end;bH.ClearScreen()local ad='M'local c0={startms=nil,status=nil}local c1={-1,nil}local c2=0;local c3=0;if aA then local frames=1/aA;local nextframes=nil end;local c4=os.clock()if aA then nextframes=c4+frames end;if not az.on then while true do local af=aZ.New()local c5=os.clock()local f=c5-c4;local q=f*1000;if ao then if ao.loadms<q then bR.n=bR.n+1;bR.e=ao.n;bR[ao.n]=ao;ao=ao.nextnote;if ao and ao.branch then ao=ao.branch.paths[ad][1]end end else if q>aI then break end end;aZ.Circle(af,math.floor(aN),aJ,aq,{color='purple'})local c6={}local c7={}for H=bR.s,bR.e do local Z=bR[H]if Z then if Z.data=='note'then if(Z.type==1 or Z.type==3)and(not c6[1]or math.abs(q-Z.ms)<c6[1])then c6[1]=math.abs(q-Z.ms)c7[1]=Z elseif(Z.type==2 or Z.type==4)and(not c6[2]or math.abs(q-Z.ms)<c6[2])then c6[2]=math.abs(q-Z.ms)c7[2]=Z end end;Z.p=bP(Z,q)if math.abs(Z.p-aN)>aM+aH+1 then if Z.endnote and Z.endnote.done~=true then else Z.done=true;bR[H]=nil;if ao and bR.n==0 then bR.s=ao.n elseif Z.n==bR.s then if Z.n==bR.e then bR.n=0 else local aj=bR.s;repeat aj=aj+1;bR.n=bR.n-1 until bR[aj]bR.s=aj end end end else if Z.data=='event'then if Z.event=='barline'then bq(af,Z)end elseif Z.data=='note'then by(af,Z)else error('Invalid note.data')end end end end;if c0.status then if q>c0.startms+aQ then c0={}else bA(af,c0,q)end end;bH.SetCursor(1,1)if aA then local c8=aZ.Convert.ToDots(af)repeat until os.clock()>=nextframes;nextframes=nextframes+frames;print(c8)else print(aZ.Convert.ToDots(af))end;c2=c2+1;local c9=os.clock()-c5;c3=c3+c9;local b4=aV.getch(aW)local ca=aV.getkeyname(b4)local B=ax.Hit[ca]if aB then local cb=c6[1]local an=c6[2]local cc=c6[1]and c6[2]and(c6[1]<c6[2]and 1 or 2)or(c6[1]and 1 or 2)local m=c6[cc]local Z=c7[cc]if m and q>Z.ms and not Z.hit then if aC then B=cc else Z.hit=true;local b=Z.type;local v=(b==3 or b==4)and 3 or 2;c0={startms=q,status=v}end end end;if B and c6[B]and not c7[B].hit then local m=c6[B]local v;local b=c7[B].type;local cd=(b==3 or b==4)and Taiko.Data.BigLeniency or 1;if m<bK.good then local b=c7[B].type;v=(b==3 or b==4)and 3 or 2 elseif m<bK.ok*cd then v=1 elseif m<bK.bad*cd then v=0 else v=nil end;if v then c7[B].hit=true;c0={startms=q,status=v}end end;if ax.Escape[ca]then local ce=os.clock()bH.ClearScreen()aV.nodelay(aW,false)local cf={'Back','Retry','Back to Select'}while true do bH.SetCursor(1,1)local bD={}for H=1,#cf do bD[H]=(H==aD and aF..string.rep(' ',aE-#aF)or string.rep(' ',aE))..cf[H]end;print(table.concat(bD,aG))local b4=aV.getch(aW)local ca=aV.getkeyname(b4)if ax.L[ca]then aD=aD==1 and 1 or aD-1 elseif ax.R[ca]then aD=aD==3 and 3 or aD+1 elseif ax.Select[ca]then if aD==1 then elseif aD==2 then return'Retry'elseif aD==3 then return nil end;break elseif ax.Escape[ca]then break end end;aV.nodelay(aW,true)c4=c4+os.clock()-ce end;if b4~=-1 then c1={b4,ca}end;bW('Input (ascii)',c1[1])bW('Input (key)',c1[2])bW('S',f)bW('Ms',q)bW('Loaded',bR.n)bW('Frames Rendered',c2)bW('Last Frame Render (s)',c9)bW('Last Frame Render (ms)',c9*1000)bW('Frame Render Total (s)',c3)bW('Frame Render Total (ms)',c3*1000)bW('Frame Render Total (%)',c3/f*100)bW('FPS (Frame)',c2/f)bW('Memory Usage (mb)',collectgarbage('count')/1000)bW('Finished (%)',q/aI*100)bW('Nearest1 (ms)',c6[1])bW('Nearest2 (ms)',c6[2])bW('Song Name',x.Metadata.TITLE)bW('Difficulty (id)',x.Metadata.COURSE)bW('Stars',x.Metadata.LEVEL)bX()b_()end else error('Prerendering has been removed')end;return true end;function Taiko.SongSelect(cg,p)local ch={}local bg,ci=10,10;local cj,ck,cl,cm=-bg,bg,-ci,ci;local cn=true;local aD=1;local co=1;local cp=4;local cq=5;local cr=5;local cs=2;local aF='V'local ct='>'local cu=10;local cv=nil;local cw='>'local cx='>'local cy=2;local cz=true;local cA={[2]={'Normal','Auto'},[3]={'None','2x Speed','3x Speed','4x Speed'}}local cB={4,1,1}local cC={nil}for A,B in pairs(cA)do cC[A]={1,#B,B}end;local cD=require('../CompactTJA/compactv4')local aV=require('taikocurses')local aW={window=aV.initscr()}aV.keypad(aW,true)aV.echo(false)aV.raw(true)aV.nl(false)aV.cbreak(true)aV.nodelay(aW,true)aV.getch(aW)aV.nodelay(aW,false)local cE,a0=aV.cols(),aV.lines()cv=cv or cE-2;local ax={Escape={['\27']=true,ALT_ESC=true},Scroll={L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_A2=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true}},Select={Init={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},Select={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},Escape={['\27']=true,ALT_ESC=true},L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true},U={KEY_UP=true,KEY_A2=true},D={KEY_DOWN=true,KEY_C2=true},Play={Hit={['4']=2,['v']=1,['n']=1,['8']=2},Escape={['\27']=true,ALT_ESC=true},L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_DOWN=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true},Select={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true}}},Search={Init={ALT_F=true,f=true,F=true},Backspace={['\8']=true,KEY_BACKSPACE=true,ALT_BKSP,CTL_BKSP},FirstResult={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},Select={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true},Up={KEY_A2=true,KEY_UP=true},Down={KEY_C2=true,KEY_DOWN=true},Escape={['\27']=true,ALT_ESC=true}}}local bH={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(bf,aJ)io.write(string.format("\27[%d;%dH",aJ,bf))end}local function cF(O)return O..string.rep(' ',cv-#O)end;local function cG()local b4=aV.getch(aW)local ca=aV.getkeyname(b4)return b4,ca end;local function cH(cI)return cI>=32 and cI<=126 end;local function cJ(cK,cL,cM,O)return(cK and cL..string.sub(cM,#cL+1,-1)or cM)..O end;local function cN(m,cO,cP)return m>cP and cO or m<cO and cP or m end;local cQ={[0]='No',[1]='Yes'}local function cR(cS)return cS and cQ[1]or cQ[0]end;local function cT(cU)return cU*100 ..'%'end;local function cV(q)return MsToS(q)..'s'end;local function cW(f)return cV(SToMs(f))end;local function cX(m)return tonumber(m)and tonumber(m)or 0 end;local cY={}bH.ClearScreen()while true do ch={}if cn then ch[cj]={}for H=aD-cq,aD+cq do local cZ=nil;if H<1 then cZ=#cg+H elseif H>#cg then cZ=H-#cg else cZ=H end;local c_=cg[cZ]if c_ then ch[0]=ch[0]or{}ch[0][(H-aD)*cr]=c_ end end;local af={}local d0=string.rep(' ',cs)for aJ=cl,cm do af[#af+1]=cJ(aJ==0,ct,d0,'')af[#af+1]=cF(ch[0][aJ]or'')af[#af+1]='\n'end;bH.SetCursor(1,1)print(table.concat(af))else ch[0]={}ch[0][cl]=aF;for H=aD-cq,aD+cq do local cZ=nil;if H<1 then cZ=#cg+H elseif H>#cg then cZ=H-#cg else cZ=H end;local c_=cg[cZ]if c_ then local bf=(H-aD)*cr;ch[bf]=ch[bf]or{}local aJ=cl+cs;for aj=1,#c_ do ch[bf][aJ]=string.sub(c_,aj,aj)aJ=aJ+1 end end end;local af={}for aJ=cl,cm do for bf=cj,ck do if ch[bf]and ch[bf][aJ]then local b=ch[bf][aJ]if cH(string.byte(b))then af[#af+1]=b else af[#af+1]=' 'end else af[#af+1]=' 'end end;af[#af+1]='\n'end;bH.SetCursor(1,1)print(table.concat(af))end;local b4,ca=cG()if ax.Scroll.L[ca]then aD=aD-1 elseif ax.Scroll.R[ca]then aD=aD+1 elseif ax.Select.Init[ca]then local x;if cz then if cY[aD]then x=cY[aD]else x=Taiko.ParseTJA(p[aD])cY[aD]=x end else x=Taiko.ParseTJA(p[aD])end;local cO,cP;local d1;if co==1 then d1={}for A,B in pairs(x)do d1[#d1+1]={A,B.Metadata.COURSE}end;table.sort(d1,function(b,c)return b[2]<c[2]end)cO=1;cP=#d1;cC[co]={cO,cP,d1}else local b=cC[co]cO,cP,d1=b[1],b[2],b[3]end;cp=ClipN(cp,cO,cP)local cM=string.rep(' ',cy)bH.ClearScreen()bH.SetCursor(1,1)local ai=nil;local d2=co;while true do bH.SetCursor(1,1)local d3=d1[cB[1]][2]ai=Taiko.GetDifficulty(x,d3)local ac=ai.Metadata;local b=Taiko.Analyze(ai)local R={{'',ac.TITLE},{'\t',ac.SUBTITLE},{'',''},{'','Select Options:'},{cJ(co==1,cx,cM,'Difficulty: '),Taiko.Data.CourseName[ac.COURSE]},{cJ(co==2,cx,cM,'Mode: '),cA[2][cB[2]]},{cJ(co==3,cx,cM,'Modifiers: '),cA[3][cB[3]]},{'',''},{'Difficulty: ',Taiko.Data.CourseName[ac.COURSE]},{'Stars: ',ac.LEVEL},{'Diverge Notes: ',cR(ac.DIVERGENOTES)},{'',''},{'','Statistics:'},{'Don (DON) / Ka (KA): ',cX(b.notes[1])..' + ('..cX(b.notes[3])..') / '..cX(b.notes[2])..' + ('..cX(b.notes[4])..') = '..cT((cX(b.notes[1])+cX(b.notes[3]))/b.notes.validn)..' / '..cT((cX(b.notes[2])+cX(b.notes[4]))/b.notes.validn)},{'Max Score (without drumroll): ',b.maxscore},{'Max Combo: ',b.maxcombo},{'Drumroll Time (total): ',cV(b.drumrollms+b.drumrollbigms)},{'Balloon Time: ',cV(b.balloonms)},{'Balloon Hits: ',b.balloonhit},{'Special Time: ',cV(b.specialms)},{'Special Hits: ',b.specialhit},{'',''},{'','Press Enter to Play!'}}for H=1,#R do local e=R[H]print(cF(e[1]..tostring(e[2])))end;local b4,ca=cG()if ax.Select.L[ca]then cp=cp-1 elseif ax.Select.R[ca]then cp=cp+1 elseif ax.Select.U[ca]then co=co-1 elseif ax.Select.D[ca]then co=co+1 elseif ax.Select.Select[ca]then while true do local d4,af=Taiko.PlaySong(Taiko.GetDifficulty(x,d3),ax.Select.Play,aW)if d4 and af then break elseif d4=='Retry'then else break end end;aV.nodelay(aW,false)elseif ax.Select.Escape[ca]then break end;co=ClipN(co,1,3)if co~=d2 then cp=cB[co]d2=co end;local b=cC[co]cO,cP=b[1],b[2]cp=cN(cp,cO,cP)cB[co]=cp end elseif ax.Search.Init[ca]then local O=''local d5={}local cP=1;local d6=nil;local d7=1;bH.ClearScreen()bH.SetCursor(1,1)print('Searching...')while true do bH.SetCursor(#O+1,2)local b4,ca=cG()bH.SetCursor(1,2)if ax.Search.Backspace[ca]then O=string.sub(O,1,-2)elseif ax.Search.FirstResult[ca]then d6=d5[1]break elseif ax.Search.Select[ca]then d6=d5[d7]break elseif ax.Search.Down[ca]then d7=d7+1 elseif ax.Search.Up[ca]then d7=d7-1 elseif ax.Search.Escape[ca]then break else O=O..ca end;print(cF(O))local R=cD.SearchHeaderAll(cg,O)for H=1,cu do if R[H][2]==-math.huge then cP=H-1;break elseif H==cu then cP=H end end;d7=ClipN(d7,1,cP)local d8=false;for H=1,cu do local b=R[H]if d8 then print(cF(''))else if b then if b[2]==-math.huge then d8=true;print(cF(''))else print(cF((H==d7 and cw or H)..'. '..R[H][3]))d5[H]=b end end end end end;aD=d6 and d6[1]or aD or aD elseif ax.Escape[ca]then return end;aD=cN(aD,1,#cg)end end;local d9='./CompactTJA/taikobuipm.tjac'd9='./CompactTJA/ESE/06 Classical.tjac'd9='./CompactTJA/ESE/ESE.tjac'local cD=require('./CompactTJA/compactv4')local R,cg=cD.Decompress(cD.Read(d9))Taiko.SongSelect(cg,R)error()Taiko.PlaySong(Taiko.GetDifficulty(Taiko.ParseTJA(cD.InputFile(d9)),'Ura'))
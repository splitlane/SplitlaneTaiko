Split=function(j,k)local l={}for m,n in j:gmatch("([^"..k.."]*)("..k.."?)")do table.insert(l,m)if n==''then return l end end end;Trim=function(j)local k=j:gsub("^%s*(.-)%s*$","%1")return k end;TrimLeft=function(j)local k=j:gsub("^%s*(.-)$","%1")return k end;TrimRight=function(j)local k=j:gsub("^(.-)%s*$","%1")return k end;StartsWith=function(j,k)return j:sub(1,#k)==k end;EndsWith=function(j,k)return j:sub(-#k,-1)==k end;Table={}function Table.Clone(j,k)k=k or{}local l=type(j)local m;if l=='table'then if k[j]then m=k[j]else m={}k[j]=m;for n,o in next,j,nil do m[Table.Clone(n,k)]=Table.Clone(o,k)end;setmetatable(m,Table.Clone(getmetatable(j),k))end else m=j end;return m end;ClipN=function(j,k,l)if j<k then return k elseif j>l then return l else return j end end;function Error(j)print(j)end;LineN=nil;function ParseError(j,k,l)Error('Line: '..LineN..'\n'..j..': '..k.. (l and(', '..l)or''))end;function MsToS(j)return j/1000 end;function SToMs(j)return j*1000 end;Taiko={}Taiko.Data={Languages={'','EN','JA','CN','TW','KO'},GenreName={Pop={'pop','j-pop'},Anime={'anime','アニメ'},Kids={'kids','どうよう'},Variety={'variety','バラエティ'},VOCALOID={'vocaloid','ボーカロイド'},Classic={'classic','クラシック'},['Game Music']={'game music','ゲームミュージック'},['Namco Original']={'namco original','ナムコオリジナル'}},CourseId={easy=0,normal=1,hard=2,oni=3,edit=4,tower=5,dan=6,ura=4},CourseName={[0]='Easy','Normal','Hard','Oni','Edit','Tower','Dan','Ura'},RatingMultiplier={[0]=0,[1]=0.5,[2]=1,[3]=2},GogoMultiplier=1.2,ScoreMode={[0]=function(j,k,l,m,n,o)return j+ ( ( (k<200)and(l or 1000)or( (l or 1000)+ (m or 1000)))*Taiko.Data.RatingMultiplier[n]* (o and Taiko.Data.GogoMultiplier or 1))end,[1]=function(j,k,l,m,n,o)return j+ ( (l+math.max(0,m*math.floor((math.min(k,100)-1)/10)))*Taiko.Data.RatingMultiplier[n]* (o and Taiko.Data.GogoMultiplier or 1))end,[2]=function(j,k,l,m,n,o)return j+ ( (l+m* ( (k>=100)and 8 or(k>=50)and 4 or(k>=30)and 2 or(k>=10)and 1 or 0))*Taiko.Data.RatingMultiplier[n]* (o and Taiko.Data.GogoMultiplier or 1))end},Autoscore={[0]=function(j)end,[1]=function(j)end,[2]=function(j)end},SideId={normal=1,ex=2,both=3},SideName={'normal','ex','both'},StyleId={single=1,double=2,couple=2},StyleName={'single','double'},Exam={Condition={g=true,jp=true,jg=true,jb=true,s=true,r=true,h=true,c=true},Scope={m=true,l=true}},Branch={PathId={N=0,E=1,M=2},PathName={[0]='N',[1]='E',[2]='M'},Requirements={r=function()end,p=function()end}},Timing={GetFunction=function(j)return function(k)if j==1 then return{good=5 /2 *k,ok=13 /2 *k,bad=15 /2 *k}else return{good=3 /2 *k,ok=9 /2 *k,bad=13 /2 *k}end end end},StatusId={bad=0,ok=1,good=2,biggood=3},StatusName={[0]='BAD',[1]='OK',[2]='GOOD',[3]='GOOD'},ModeId={['']=0,P1=1,P2=2},ModeName={[0]='',P1,P2},Combo={[1]=true,[2]=true,[3]=true,[4]=true},BigLeniency=2}for j,l in pairs(Taiko.Data.ScoreMode)do Taiko.Data.ScoreMode[j]=function(...)return math.floor(l(...)/10)*10 end end;function Taiko.ParseTJA(j)local k=os.clock()local l={}local m={Metadata={BPM=120,WAVE='main.mp3',OFFSET=0,DEMOSTART=0,SCOREMODE=1,SONGVOL=100,SEVOL=100,SIDE=3,LIFE=0,GAME='Taiko',HEADSCROLL=1,MOVIEOFFSET=0,COURSE='ONI',LEVEL=0,BALLOON=nil,SCOREINIT,SCOREDIFF,BALLOONNOR=nil,BALLOONEXP=nil,BALLOONMAS=nil,STYLE=1,EXAM1=nil,EXAM2=nil,EXAM3=nil,GAUGEINCR='NORMAL',TOTAL=nil,HIDDENBRANCH=0,DIVERGENOTES=false,SCOREINIT=0,SCOREDIFF=0},Data={}}local function n(z)local A=Taiko.Data.Languages;for i=1,#A do local B=m.Metadata[z..A[i]]if B then return B end end;return nil end;local function o(z,A,B)local C=tonumber(A)if C then return C else ParseError(z,B,A)end end;local function p(z,A,B,C)if A then return A else ParseError(z,B,C)end end;local function q(z,A,B)local C={['true']=true,['false']=false,yes=true,no=false,['1']=true,['0']=false,[1]=true,[0]=false}local D=C[A]~=nil;if D then return D else ParseError(z,B,A)end end;local function r(z,A)local B=','local C='\\'local D={}local E=''local F=false;for i=1,#A do local G=string.sub(A,i,i)if F then E=E..G;F=false else if G==B then table.insert(D,E)E=''elseif G==C then F=true else E=E..G end end end;table.insert(D,E)return D end;local function s(z,A,B)local C=r(z,A)for i=1,#C do C[i]=o(z,C[i],B,A)end;return C end;local function u(z,A,B)if A and A~=''then return s(z,A,B)else return{}end end;local function v(z,A,B)if A and A~=''then local C=r(z,A,B)p(z,Taiko.Data.Exam.Condition[C[1]],B)C[2]=o(z,C[2],B)C[3]=o(z,C[3],B)p(z,Taiko.Data.Exam.Scope[C[4]],B)return C else return{}end end;local w={}local function x()local z={settings={noteparse={notealias={A=3,B=4},noteexceptions={[',']=true,[' ']=true,['\t']=true}},command={matchexceptions={}}},bpm=0,ms=0,songstarted=false,timingpoint=nil,sign=4 /4,mpm=0,mspermeasure=0,scroll=1,measuredone=true,currentmeasure={},measurepushto=m.Data,barline=true,gogo=false,lastlong=nil,balloonn=1,currentbranch=nil,branch={on=false,requirements={},paths={}},msbeforebranch=nil}function z.createnote(A)if A then local B={ms=nil,data=nil,type=A,txt=nil,gogo=z.gogo,scroll=(z.scroll*m.Metadata.HEADSCROLL),mspermeasure=z.mspermeasure,bpm=z.bpm,nextnote=nil,radius=1,requiredhits=nil,length=nil,endnote=nil,onnotepush=nil}B.type=A;if A==3 or A==4 or A==6 then B.radius=B.radius*1.6 end;if A==5 or A==6 or A==7 or A==9 then if z.lastlong then if A==9 then else ParseError('parser.noteparse','Last long note has not ended')end else z.lastlong=B;if A==7 or A==9 then B.requiredhits=p('parser.noteparse',m.Metadata.BALLOON[z.balloonn],'Invalid number of balloons',z.balloonn)z.balloonn=z.balloonn+1 end end end;if A==8 then local C=z.lastlong;z.lastlong=nil;B.startnote=C;if C then B.onnotepush=function()C.length=B.ms-C.ms;C.endnote=B end else end end;return B else return{ms=nil,data=nil,type=nil,txt=nil,gogo=z.gogo,scroll=(z.scroll*m.Metadata.HEADSCROLL),mspermeasure=z.mspermeasure,bpm=z.bpm,nextnote=nil}end end;function z.endbranch()local A=z.createnote()A.data='event'A.event='branch'A.branch={requirements=z.branch.requirements,paths=z.branch.paths}z.branch.on=false;z.branch.requirements={}z.branch.paths={}table.insert(m.Data,A)z.measurepushto=m.Data end;return z end;w=x()local y=Split(j,'\n')for i=1,#y do LineN=i;local z=Trim(y[i])if StartsWith(z,'//')or z==''then else local A=string.find(z,'//')if A then z=string.sub(z,1,A-1)end;local B=false;if w.songstarted==false and B==false then local C={string.match(z,'(%u+):(.*)')}if C[1]then local D=Trim(C[2])if D~=''then m.Metadata[Trim(C[1])]=D end;B=true end end;if(w.songstarted or StartsWith(z,'#START'))and B==false then local C={string.match(z,'#(%u-)%s(.*)')}if not C[1]then C={string.match(z,'#(%u+)')}end;if C[1]then if C[1]=='START'then if w.songstarted then ParseError(C[1],'Song has already started')else m.OriginalMetadata=Table.Clone(m.Metadata)if C[2]then m.Metadata.MODE=p(C[1],Taiko.Data.ModeId[C[2]],'Invalid mode',C[2])else m.Metadata.MODE=0 end;m.Metadata.TITLE=p(C[1],n('TITLE'),'Title is missing')m.Metadata.SUBTITLE=p(C[1],n('SUBTITLE'),'Subtitle is missing')m.Metadata.BPM=o(C[1],m.Metadata.BPM,'Invalid bpm')m.Metadata.OFFSET=SToMs(o(C[1],m.Metadata.OFFSET,'Invalid offset'))m.Metadata.DEMOSTART=SToMs(o(C[1],m.Metadata.DEMOSTART,'Invalid demostart'))if m.Metadata.DEMOSTART==0 then m.Metadata.DEMOSTART=nil end;for G,H in pairs(Taiko.Data.GenreName)do for i=1,#H do if H[i]==m.Metadata.GENRE then m.Metadata.GENRE=G end end end;m.Metadata.SCOREMODE=o(C[1],m.Metadata.SCOREMODE,'Invalid scoremode')p(C[1],Taiko.Data.ScoreMode[m.Metadata.SCOREMODE],'Invalid scoremode',m.Metadata.SCOREMODE)if m.Metadata.MAKER then m.Metadata.CREATORURLT={}m.Metadata.CREATOR=Trim(string.gsub(m.Metadata.MAKER,'(<.->)',function(G)table.insert(m.Metadata.CREATORURLT,string.sub(G,2,-2))return''end))m.Metadata.CREATORURL=table.concat(m.Metadata.CREATORURLT,', ')m.Metadata.CREATIVE=false else m.Metadata.CREATIVE=false end;m.Metadata.SONGVOL=o(C[1],m.Metadata.SONGVOL,'Invalid songvol')/100;m.Metadata.SEVOL=o(C[1],m.Metadata.SEVOL,'Invalid sevol')/100;local D=tonumber(m.Metadata.SIDE)if D then p(C[1],Taiko.Data.SideName[D],'Invalid side id',m.Metadata.SIDE)m.Metadata.SIDE=D else m.Metadata.SIDE=p(C[1],Taiko.Data.SideId[string.lower(m.Metadata.SIDE)],'Invalid side name',m.Metadata.SIDE)end;m.Metadata.LIFE=o(C[1],m.Metadata.LIFE,'Invalid life')if m.Metadata.LIFE==0 then m.Metadata.LIFE=nil end;m.Metadata.GAME=string.lower(m.Metadata.GAME)if m.Metadata.GAME=='taiko'then elseif m.Metadata.GAME=='jube'then else end;m.Metadata.HEADSCROLL=o(C[1],m.Metadata.HEADSCROLL,'Invalid headscroll')m.Metadata.MOVIEOFFSET=o(C[1],m.Metadata.MOVIEOFFSET,'Invalid movieoffset')local E=tonumber(m.Metadata.COURSE)if E then p(C[1],Taiko.Data.CourseName[E],'Invalid course id',m.Metadata.COURSE)m.Metadata.COURSE=E else m.Metadata.COURSE=p(C[1],Taiko.Data.CourseId[string.lower(m.Metadata.COURSE)],'Invalid course name',m.Metadata.COURSE)end;m.Metadata.TIMING=Taiko.Data.Timing.GetFunction(m.Metadata.COURSE)m.Metadata.LEVEL=ClipN(math.floor(o(C[1],m.Metadata.LEVEL,'Invalid level')),0,10)m.Metadata.BALLOON=u(C[1],m.Metadata.BALLOON,'Invalid balloon')m.Metadata.SCOREINIT=o(C[1],m.Metadata.SCOREINIT,'Invalid scoreinit')m.Metadata.SCOREDIFF=o(C[1],m.Metadata.SCOREDIFF,'Invalid scoreinit')m.Metadata.BALLOONNOR=u(C[1],m.Metadata.BALLOONNOR,'Invalid balloonnor')m.Metadata.BALLOONEXP=u(C[1],m.Metadata.BALLOONEXP,'Invalid balloonexp')m.Metadata.BALLOONMAS=u(C[1],m.Metadata.BALLOONMAS,'Invalid balloonmas')local F=tonumber(m.Metadata.STYLE)if F then p(C[1],Taiko.Data.StyleName[F],'Invalid style id',Taiko.Data.STYLE)m.Metadata.STYLE=F else m.Metadata.STYLE=p(C[1],Taiko.Data.StyleId[string.lower(m.Metadata.STYLE)],'Invalid style name',m.Metadata.STYLE)end;m.Metadata.EXAM1=v(m.Metadata.EXAM1)m.Metadata.EXAM2=v(m.Metadata.EXAM2)m.Metadata.EXAM3=v(m.Metadata.EXAM3)m.Metadata.GAUGEINCR=string.lower(m.Metadata.GAUGEINCR)if m.Metadata.TOTAL then m.Metadata.TOTAL=o(C[1],m.Metadata.TOTAL,'Invalid total')end;m.Metadata.HIDDENBRANCH=q(C[1],m.Metadata.HIDDENBRANCH,'Invalid hiddenbranch')w.bpm=m.Metadata.BPM;w.songstarted=true end elseif C[1]=='END'then if w.songstarted then if#w.currentmeasure~=0 then ParseError(C[1],'Current measure is not empty')end;table.insert(l,m)m={Metadata=Table.Clone(m.OriginalMetadata),Data={}}w=x()w.songstarted=false;w.measurepushto=m.Data else ParseError(C[1],'Song has already ended')end elseif C[1]=='MEASURE'then local D,E=string.match(C[2],'(%d+)/(%d+)')D=o(C[1],D,'Invalid measure')E=o(C[1],E,'Invalid measure')w.sign=(D/E)or w.sign elseif C[1]=='BPMCHANGE'then w.bpm=o(C[1],C[2],'Invalid bpmchange')or w.bpm elseif C[1]=='DELAY'then table.insert(w.currentmeasure,{C[1],SToMs((o(C[1],C[2],'Invalid delay')or 0))})elseif C[1]=='SCROLL'then w.scroll=o(C[1],C[2],'Invalid scroll')or w.scroll;if w.scroll==0 then ParseError(C[1],'Scroll cannot be 0')end elseif C[1]=='GOGOSTART'then w.gogo=true elseif C[1]=='GOGOEND'then w.gogo=false elseif C[1]=='BARLINEOFF'then w.barline=false elseif C[1]=='BARLINEON'then w.barline=true elseif C[1]=='BRANCHSTART'then if w.branch.on then w.endbranch()end;w.msbeforebranch=w.ms;w.branch.on=true;m.Metadata.DIVERGENOTES=true;local D=r(C[1],C[2])local E=p(C[1],Taiko.Data.Branch.Requirements[string.lower(D[1])],'Invalid type',D[1])w.branch.requirements={E}local F=2;while true do if not D[F]then break end;local G=Taiko.Data.Branch.PathName[F-1]if G then w.branch.requirements[G]=D[F]else break end;F=F+1 end elseif Taiko.Data.Branch.PathId[C[1]]then if w.branch.on then w.ms=w.msbeforebranch;w.currentbranch=C[1]w.branch.paths[C[1]]={}w.measurepushto=w.branch.paths[C[1]]else ParseError(C[1],'Branch has not started')end elseif C[1]=='BRANCHEND'then if w.branch.on then w.endbranch()else ParseError(C[1],'Branch has already ended')end elseif C[1]=='SECTION'then elseif C[1]=='LYRIC'then elseif C[1]=='LEVELHOLD'then elseif C[1]=='BMSCROLL'then elseif C[1]=='HBSCROLL'then elseif C[1]=='SENOTECHANGE'then elseif C[1]=='NEXTSONG'then elseif C[1]=='DIRECTION'then elseif C[1]=='SUDDEN'then elseif C[1]=='JPOSSCROLL'then else end;B=true end end;if(w.songstarted)and B==false then w.mpm=w.bpm*w.sign/4;w.mspermeasure=60000 *w.sign*4 /w.bpm;if w.barline and#w.currentmeasure==0 then local C=w.createnote()C.ms=w.ms;C.data='event'C.event='barline'table.insert(w.measurepushto,1,C)end;for i=1,#z do local C=string.sub(z,i,i)if w.settings.noteparse.noteexceptions[C]then else local D=o('parser.noteparse',tonumber(C)or w.settings.noteparse.notealias[C]or C,'Invalid note')if D then local E=w.createnote(D)E.data='note'table.insert(w.currentmeasure,E)end end end;if EndsWith(TrimRight(z),',')then w.mpm=w.bpm*w.sign/4;w.mspermeasure=60000 *w.sign*4 /w.bpm;if#w.currentmeasure==0 then w.ms=w.ms+w.mspermeasure else local C=0;local D=nil;for i=1,#w.currentmeasure do local F=w.currentmeasure[i]if F.data=='note'then D=D or F.mspermeasure;C=C+1 end end;D=D or w.mspermeasure;local E=D/C;for i=1,#w.currentmeasure do local F=w.currentmeasure[i]if F[1]=='DELAY'then w.ms=w.ms+F[2]else if F.type~=0 then F.ms=w.ms;local G=m.Data[#m.Data]if G then G.nextnote=F end;table.insert(w.measurepushto,F)if F.onnotepush then F.onnotepush()end;E=F.mspermeasure/C end end;w.ms=w.ms+E end end;w.measuredone=true;w.currentmeasure={}else w.measuredone=false end end end end;print('Parsing Took: '..SToMs(os.clock()-k)..'ms')return l end;function Taiko.Score(j,k,l,m,n)if m==0 then l=0 else l=l+1 end;local o=j.Metadata;return Taiko.Data.ScoreMode[o.SCOREMODE](k,l,o.SCOREINIT,o.SCOREDIFF,m,n),l end;function Taiko.Analyze(j)local k='M'local l={[1]=2,[2]=2,[3]=3,[4]=3}local m={notes={n=0,validn=0},measures=0,lengthms=0,drumrollms=0,drumrollbigms=0,balloonms=0,balloonhit=0,specialms=0,specialhit=0,maxcombo=0,maxscore=0}local n=nil;Taiko.ForAll(j.Data,function(o,p,q)if o.data=='note'then m.notes.n=m.notes.n+1;m.notes[o.type]=m.notes[o.type]and m.notes[o.type]+1 or 1;if l[o.type]then m.maxscore,m.maxcombo=Taiko.Score(j,m.maxscore,m.maxcombo,l[o.type],o.gogo)end;local r=o.endnote;if r then local s=r.ms-o.ms;if o.type==5 then m.drumrollms=m.drumrollms+s elseif o.type==6 then m.drumrollbigms=m.drumrollbigms+s elseif o.type==7 then m.balloonms=m.balloonms+s;m.balloonhit=m.balloonhit+o.requiredhits elseif o.type==9 then m.specialms=m.specialms+s;m.specialhit=m.specialhit+o.requiredhits else end end;n=o elseif o.data=='event'and o.event=='barline'then m.measures=m.measures+1 else end end,k)m.lengthms=n.ms-j.Metadata.OFFSET;m.notes.validn=m.maxcombo;return m end;function Taiko.GetDifficulty(j,k)local l=Taiko.Data.CourseId[string.lower(k)]or k;for m,n in pairs(j)do if n.Metadata.COURSE==l then return n end end;Error('No difficulty found, '..k)return nil end;function Taiko.ForAll(j,k,l)local m=1;for i=1,#j do local o=j[i]if o.branch then if l then local p=o.branch.paths[l]for i2=1,#p do k(p[i2],i2,m)m=m+1 end;m=m-1 else local p=-1;for q,r in pairs(o.branch.paths)do local s=m;for i2=1,#r do k(r[i2],i2,s)s=s+1 end;p=(p<s)and s or p end;m=p end else k(o,i,m)end;m=m+1 end;return j end;function Taiko.GetAllNotes(j)local k={}for l,m in pairs(j)do if m.branch then for n,o in pairs(m.branch.paths)do for i=1,#o do table.insert(k,o[i])end end else table.insert(k,m)end end;return k end;function Taiko.ConnectNotes(j)local k=nil;for i=#j,1,-1 do local l=j[i]l.nextnote=k;k=l end;return j end;function Taiko.ExtractBranch(j,k)return j.branch.paths[k]end;function Taiko.ConnectAll(j)local k=nil;for i=#j,1,-1 do local l=j[i]if l.branch then for m,n in pairs(l.branch.paths)do local o=Taiko.ConnectNotes(n)o[#o].nextnote=k end else l.nextnote=k end;k=l end end;function Taiko.CalculateSpeed(j,k)local l=(k*j.scroll*j.bpm/7500)return l end;function Taiko.CalculateSpeedAll(j,k)for i=1,#j do j[i].speed=Taiko.CalculateSpeed(j[i],k)end;return j end;function Taiko.RenderScale(j)local k={}local l={}local m={}for i=1,#j.Data do local q=j.Data[i]if q.data=='note'then local r=math.floor(q.ms)if math.floor(r)-r==0 then table.insert(k,{r,q.type})table.insert(l,r)else table.insert(m,i)end end end;function gcd2(q,r)if r==0 then return q else return gcd2(r,q%r)end end;function gcdn(q)local s=q[1]for i=2,#q do s=gcd2(s,q[i])end;return s end;local n=gcdn(l)for i=1,#m do local q=k[m[i]]q[1]=math.floor(q[1]/n)*n end;local o=''local p=0;for i=1,#k do k[i][1]=k[i][1]/n;o=o..string.rep(' ',k[i][1]-p)..k[i][2]p=k[i][1]end;return o end;function Taiko.PlaySong(j,k,l,m)local n={on=false,fps=60,frames={}}local o=nil;local p=false;local q=false;local r=l or{}r={Hit=r.Hit or{['4']=2,['v']=1,['n']=1,['8']=2},Escape=r.Escape or{['\27']=true,ALT_ESC=true},L=r.L or{KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_A2=true},R=r.R or{KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true},Select=r.Select or{KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true}}local s=1;local u=2;local v='>'local w='\n\n\n'local x=10;local z=1000;local A=4;local B=0;local C=10;local D=0;local E=40;local F=3;local G=1;local H={[1]={color='red'},[2]={color='blue'},[3]={color='red'},[4]={color='blue'},[5]={color='yellow'},[6]={color='yellow'}}local I=200;local J=I/4;local K=4;local L=20;E=math.floor(E*A)local M=D+E;F=math.floor(F*A)local N=require('taikocurses')local O=m or{window=N.initscr()}N.keypad(O,true)N.echo(false)N.raw(true)N.nl(false)N.cbreak(true)N.nodelay(O,true)local P=require('Pixels')local Q={[0]={Data={[1]={'0','1','1','1','1','1','1','1'},[2]={[2]='1',[5]='1',[8]='1'},[3]={[2]='1',[5]='1',[8]='1'},[4]={[2]='1',[5]='1',[8]='1'},[5]={[2]='1',[5]='1',[8]='1'},[6]={[3]='1',[4]='1',[6]='1',[7]='1'},[8]={'0','0','1','1','1','1','1','1'},[9]={[2]='1',[5]='1'},[10]={[2]='1',[5]='1'},[11]={[2]='1',[5]='1'},[12]={[2]='1',[5]='1'},[13]={'0','0','1','1','1','1','1','1'},[15]={'0','1','1','1','1','1','1','1'},[16]={[2]='1',[8]='1'},[17]={[2]='1',[8]='1'},[18]={[2]='1',[8]='1'},[19]={[2]='1',[8]='1'},[20]={'0','0','1','1','1','1','1','0'}},Color={All='blue'},Offset={-1,0}},[1]={Data={[1]={'0','0','1','1','1','1','1','0'},[2]={[2]='1',[8]='1'},[3]={[2]='1',[8]='1'},[4]={[2]='1',[8]='1'},[5]={[2]='1',[8]='1'},[6]={'0','0','1','1','1','1','1','0'},[8]={'0','1','1','1','1','1','1','1'},[9]={[5]='1'},[10]={[4]='1',[6]='1'},[11]={[3]='1',[7]='1'},[12]={[2]='1',[8]='1'}},Color={All='white'},Offset={-1,0}},[2]={Data={[1]={'0','0','1','1','1','1','1','0'},[2]={[2]='1',[8]='1'},[3]={[2]='1',[8]='1'},[4]={[2]='1',[5]='1',[8]='1'},[5]={[2]='1',[5]='1',[8]='1'},[6]={'0','1','0','0','1','1','1','1'},[8]={'0','0','1','1','1','1','1','0'},[9]={[2]='1',[8]='1'},[10]={[2]='1',[8]='1'},[11]={[2]='1',[8]='1'},[12]={[2]='1',[8]='1'},[13]={'0','0','1','1','1','1','1','0'},[15]={'0','0','1','1','1','1','1','0'},[16]={[2]='1',[8]='1'},[17]={[2]='1',[8]='1'},[18]={[2]='1',[8]='1'},[19]={[2]='1',[8]='1'},[20]={'0','0','1','1','1','1','1','0'},[22]={'0','1','1','1','1','1','1','1'},[23]={[2]='1',[8]='1'},[24]={[2]='1',[8]='1'},[25]={[2]='1',[8]='1'},[26]={[2]='1',[8]='1'},[27]={'0','0','1','1','1','1','1','0'}},Color={All='yellow'},Offset={-1,0}}}Q[3]=Q[2]local R={[0]=nil,[1]={},[2]={}}P.ColorData=P.Color.Data;for Fb,Gb in pairs(P.ColorData)do P.Color[Fb]='\27['..Gb..'m'end;local S,T=D,E;local U,V=-C,C;U,V=-20,20;P.Convert.ToDots=function(Fb)Fb=GetPixelData(Fb)local Gb,Hb=Fb.Data,Fb.Color;local Ib={}local Jb=string.rep('0',8)local Kb=P.Data.Dot[Jb]local Lb=nil;local Mb=nil;local Nb=P.Color['reset']if Fb.Color.All then local Ob=P.Color[Fb.Color.All]table.insert(Ib,Ob)Mb=Ob end;if not U then return''end;for y=U,V,4 do for x=S,T,2 do local Ob=Gb[x]local Pb=Gb[x+1]local Qb=( (Ob)and( (Ob[y]or'0').. (Ob[y+1]or'0').. (Ob[y+2]or'0').. (Ob[y+3]or'0'))or'0000').. ( (Pb)and( (Pb[y]or'0').. (Pb[y+1]or'0').. (Pb[y+2]or'0').. (Pb[y+3]or'0'))or'0000')if Qb~=Jb then Qb=P.Data.Dot[Qb]if not Mb then local Rb=Hb[x]local Sb=Hb[x+1]local Tb=( (Rb)and(Rb[y]or Rb[y+1]or Rb[y+2]or Rb[y+3]))or( (Sb)and(Sb[y]or Sb[y+1]or Sb[y+2]or Sb[y+3]))if Tb then Tb=P.Color[Tb]else Tb=Nb end;if Lb==Tb then else table.insert(Ib,Tb)Lb=Tb end end;table.insert(Ib,Qb)else table.insert(Ib,Kb)end end;table.insert(Ib,'\n')end;table.insert(Ib,Nb)return table.concat(Ib)end;P.CircleGen=function(Fb,Gb,Hb,Ib,Jb)str=GetPixelData(Fb)Jb=Jb or{}local Kb=Jb.color;local Lb=Ib*Ib;local Mb=Ib;for y=0,Ib do Mb=Mb+1;repeat Mb=Mb-1 until Mb*Mb+y*y<=Lb;for x2=0,Mb do str.Data[Gb+x2]=str.Data[Gb+x2]or{}str.Data[Gb-x2]=str.Data[Gb-x2]or{}str.Data[Gb+x2][Hb+y]='1'str.Data[Gb-x2][Hb+y]='1'str.Data[Gb+x2][Hb-y]='1'str.Data[Gb-x2][Hb-y]='1'str.Color[Gb+x2]=str.Color[Gb+x2]or{}str.Color[Gb-x2]=str.Color[Gb-x2]or{}str.Color[Gb+x2][Hb+y]=Kb;str.Color[Gb-x2][Hb+y]=Kb;str.Color[Gb+x2][Hb-y]=Kb;str.Color[Gb-x2][Hb-y]=Kb end end;return str end;local W={}P.Circle=function(Fb,Gb,Hb,Ib,Jb)local Kb=GetPixelData(Fb)local Lb=nil;if W[Ib]then else W[Ib]=P.CircleGen(P.New(),0,0,Ib)end;local Mb=Jb and Jb.color;Lb=W[Ib]for Nb,Ob in pairs(Lb.Data)do for Pb,Qb in pairs(Ob)do local Rb,Sb=Nb+Gb,Pb+Hb;Kb.Data[Rb]=Kb.Data[Rb]or{}Kb.Data[Rb][Sb]=Qb;Kb.Color[Rb]=Kb.Color[Rb]or{}Kb.Color[Rb][Sb]=Mb end end;return Kb end;P.New=function()return{Data={},Color={}}end;local function X(Fb,Gb)local Hb=math.floor(Gb.p)local Ib,Jb=B-C,B+C;for y=Ib,Jb do local Kb=Fb.Data[Hb]and Fb.Data[Hb][y]if Kb=='0'or Kb==nil then Fb.Data[Hb]=Fb.Data[Hb]or{}Fb.Data[Hb][y]='1'end end end;local function Y(Fb,Gb,Hb)Hb=Hb or Gb.p;P.Circle(Fb,math.floor(Hb),B,A*Gb.radius,H[Gb.type])end;local function Z(Fb,Gb,Hb,Ib,Jb,Kb)local Lb=Kb or{}color=Lb.color;local Mb=(D-x)if Gb<Mb then Gb=Mb end;local Nb=(E+x)if Hb>Nb then Hb=Nb end;for y=Ib,Jb do for x=Gb,Hb do Fb.Data[x]=Fb.Data[x]or{}Fb.Data[x][y]='1'if color then Fb.Color[x]=Fb.Color[x]or{}Fb.Color[x][y]=color end end end end;local function ab(Fb,Gb)local Hb=Gb.type;if Hb==1 or Hb==2 or Hb==3 or Hb==4 then Y(Fb,Gb)elseif Hb==5 or Hb==6 then Y(Fb,Gb)local Ib=Gb.endnote;local Jb=(Ib.ms-Gb.ms)*Gb.speed;Y(Fb,Gb)local Kb=A*Gb.radius;local Lb,Mb=math.floor(Gb.p),math.floor(Gb.p+Jb)local Nb=math.floor(B-Kb)local Ob=math.floor(B+Kb)Z(Fb,Lb,Mb,Nb,Ob,H[Gb.type])elseif Hb==8 then Y(Fb,Gb.startnote,Gb.p)end end;local function bb(Fb,Gb,Hb)local Ib=K/ (J/2)local Jb=-Ib*math.abs(( (Hb-Gb.startms)/ (I/J))- (K/Ib))+K;local Kb=Q[Gb.status]local Lb=Kb.Offset;local Mb=Kb.Color.All;local Nb,Ob=0,-math.floor(A*1.6)-8 -math.floor(Jb)for Pb,Qb in pairs(Kb.Data)do for Rb,Sb in pairs(Qb)do if Sb=='1'then local Tb,Ub=Pb+Lb[1]+Nb,Rb+Lb[2]+Ob;Fb.Data[Tb]=Fb.Data[Tb]or{}Fb.Data[Tb][Ub]=Sb;Fb.Color[Tb]=Fb.Color[Tb]or{}Fb.Color[Tb][Ub]=Mb end end end end;local function cb(Fb,Gb)local Hb=R[Gb.status]local Ib=Hb.Offset;local Jb=Hb.Color.All;local Kb,Lb=0,0;for Mb,Nb in pairs(Hb.Data)do for Ob,Pb in pairs(Nb)do if Pb=='1'then local Qb,Rb=Mb+Ib[1]+Kb,Ob+Ib[2]+Lb;Fb.Data[Qb]=Fb.Data[Qb]or{}Fb.Data[Qb][Rb]=Pb;Fb.Color[Qb]=Fb.Color[Qb]or{}Fb.Color[Qb][Rb]=Jb end end end end;local db={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(Fb,Gb)io.write(string.format("\27[%d;%dH",Gb,Fb))end}j=Taiko.GetDifficulty(j,k)local eb=Taiko.GetAllNotes(j.Data)local fb=j.Metadata.OFFSET;local gb=1000 /60;local hb=j.Metadata.TIMING(gb)local function ib(Fb)return(Fb.data=='note')or(Fb.data=='event'and Fb.event=='barline')end;local function jb(Fb,Gb)return Gb- (( (E+x)/math.abs(Fb.speed)))end;local function kb(Fb,Gb)return(Fb.ms-Gb)*Fb.speed+F end;local function lb(Fb,Gb)return Fb.loadp- (Fb.speed* (Gb-Fb.loadms))end;local mb={}for Fb,Gb in pairs(eb)do Gb.ms=Gb.ms-fb;Gb.s=MsToS(Gb.ms)Gb.speed=Taiko.CalculateSpeed(Gb,A)Gb.loadms=jb(Gb,Gb.ms)Gb.loads=MsToS(Gb.loadms)Gb.loadp=kb(Gb,Gb.loadms)table.insert(mb,Gb.ms)end;for Fb,Gb in pairs(j.Data)do if Gb.branch then for Hb,Ib in pairs(Gb.branch.paths)do table.sort(Ib,function(Jb,Kb)return Jb.loadms<Kb.loadms end)end end end;table.sort(j.Data,function(Fb,Gb)if Fb.branch and Gb.branch then for Hb,Ib in pairs(Fb.branch.paths)do for Jb,Kb in pairs(Gb.branch.paths)do return Ib[1].loadms<Kb[1].loadms end end elseif Fb.branch then for Hb,Ib in pairs(Fb.branch.paths)do return Ib[1].loadms<Gb.loadms end elseif Gb.branch then for Hb,Ib in pairs(Gb.branch.paths)do return Fb.loadms<Ib[1].loadms end else return Fb.loadms<Gb.loadms end end)Taiko.ConnectAll(j.Data)Taiko.ForAll(j.Data,function(Fb,Gb,Hb)Fb.n=Hb end)local nb=math.max(unpack(mb))+z;local ob={s=1,e=0,n=0}local pb=j.Data[1]local qb=pb.loads;ob.e=ob.n;local rb=10;local sb=string.rep(' ',rb)local tb={}local function ub(Fb,Gb)table.insert(tb,Fb)table.insert(tb,': ')table.insert(tb,tostring(Gb))table.insert(tb,sb)table.insert(tb,'\n')end;local function vb()print(table.concat(tb))tb={}end;local wb=''local function xb(Fb)wb=wb..'\n'..Fb end;local function yb()print(wb)end;db.ClearScreen()local zb='M'local Ab={startms=nil,status=nil}local Bb={-1,nil}local Cb=0;local Db=0;if o then local Fb=1 /o;local Gb=nil end;local Eb=os.clock()if o then nextframes=Eb+frames end;if not n.on then while true do local Fb=P.New()local Gb=os.clock()local Hb=Gb-Eb;local Ib=Hb*1000;if pb then if pb.loadms<Ib then ob.n=ob.n+1;ob.e=pb.n;ob[pb.n]=pb;pb=pb.nextnote;if pb and pb.branch then pb=pb.branch.paths[zb][1]end end else if Ib>nb then break end end;P.Circle(Fb,math.floor(F),B,A,{color='purple'})local Jb={}local Kb={}for i=ob.s,ob.e do local Pb=ob[i]if Pb then if Pb.data=='note'then if(Pb.type==1 or Pb.type==3)and(not Jb[1]or math.abs(Ib-Pb.ms)<Jb[1])then Jb[1]=math.abs(Ib-Pb.ms)Kb[1]=Pb elseif(Pb.type==2 or Pb.type==4)and(not Jb[2]or math.abs(Ib-Pb.ms)<Jb[2])then Jb[2]=math.abs(Ib-Pb.ms)Kb[2]=Pb end end;Pb.p=lb(Pb,Ib)if math.abs(Pb.p-F)> (E+x+1)then if Pb.endnote and Pb.endnote.done~=true then else Pb.done=true;ob[i]=nil;if pb and ob.n==0 then ob.s=pb.n elseif Pb.n==ob.s then if Pb.n==ob.e then ob.n=0 else local Qb=ob.s;repeat Qb=Qb+1;ob.n=ob.n-1 until ob[Qb]ob.s=Qb end end end else if Pb.data=='event'then if Pb.event=='barline'then X(Fb,Pb)end elseif Pb.data=='note'then ab(Fb,Pb)else error('Invalid note.data')end end end end;if Ab.status then if Ib>Ab.startms+I then Ab={}else bb(Fb,Ab,Ib)end end;db.SetCursor(1,1)if o then local Pb=P.Convert.ToDots(Fb)repeat until os.clock()>=nextframes;nextframes=nextframes+frames;print(Pb)else print(P.Convert.ToDots(Fb))end;Cb=Cb+1;local Lb=os.clock()-Gb;Db=Db+Lb;local Mb=N.getch(O)local Nb=N.getkeyname(Mb)local Ob=r.Hit[Nb]if p then local Pb=Jb[1]local Qb=Jb[2]local Rb=(Jb[1]and Jb[2])and( (Jb[1]<Jb[2])and 1 or 2)or(Jb[1]and 1 or 2)local Sb=Jb[Rb]local Tb=Kb[Rb]if Sb and Ib>Tb.ms and(not Tb.hit)then if q then Ob=Rb else Tb.hit=true;local Ub=Tb.type;local Vb=( (Ub==3 or Ub==4)and 3)or 2;Ab={startms=Ib,status=Vb}end end end;if Ob and Jb[Ob]and(not Kb[Ob].hit)then local Pb=Jb[Ob]local Qb;local Rb=Kb[Ob].type;local Sb=( (Rb==3 or Rb==4)and Taiko.Data.BigLeniency)or 1;if Pb< (hb.good)then local Tb=Kb[Ob].type;Qb=( (Tb==3 or Tb==4)and 3)or 2 elseif Pb< (hb.ok*Sb)then Qb=1 elseif Pb< (hb.bad*Sb)then Qb=0 else Qb=nil end;if Qb then Kb[Ob].hit=true;Ab={startms=Ib,status=Qb}end end;if r.Escape[Nb]then local Pb=os.clock()db.ClearScreen()N.nodelay(O,false)local Qb={'Back','Retry','Back to Select'}while true do db.SetCursor(1,1)local Rb={}for i=1,#Qb do Rb[i]=( (i==s)and(v..string.rep(' ',u-#v))or string.rep(' ',u))..Qb[i]end;print(table.concat(Rb,w))local Sb=N.getch(O)local Tb=N.getkeyname(Sb)if r.L[Tb]then s=s==1 and 1 or s-1 elseif r.R[Tb]then s=s==3 and 3 or s+1 elseif r.Select[Tb]then if s==1 then elseif s==2 then return'Retry'elseif s==3 then return nil end;break elseif r.Escape[Tb]then break end end;N.nodelay(O,true)Eb=Eb+ (os.clock()-Pb)end;if Mb~=-1 then Bb={Mb,Nb}end;ub('Input (ascii)',Bb[1])ub('Input (key)',Bb[2])ub('S',Hb)ub('Ms',Ib)ub('Loaded',ob.n)ub('Frames Rendered',Cb)ub('Last Frame Render (s)',Lb)ub('Last Frame Render (ms)',Lb*1000)ub('Frame Render Total (s)',Db)ub('Frame Render Total (ms)',Db*1000)ub('Frame Render Total (%)',Db/Hb*100)ub('FPS (Frame)',Cb/Hb)ub('Memory Usage (mb)',collectgarbage('count')/1000)ub('Finished (%)',Ib/ (nb)*100)ub('Nearest1 (ms)',Jb[1])ub('Nearest2 (ms)',Jb[2])ub('Song Name',j.Metadata.TITLE)ub('Difficulty (id)',j.Metadata.COURSE)ub('Stars',j.Metadata.LEVEL)vb()yb()end else error('Prerendering has been removed')end;return true end;function Taiko.SongSelect(j,k)local l={}local m,n=10,10;local o,p,q,r=-m,m,-n,n;local s=true;local u=1;local v=1;local w=4;local x=5;local y=5;local z=2;local A='V'local B='>'local C=10;local D=nil;local E='>'local F='>'local G=2;local H=true;local I={[2]={'Normal','Auto'},[3]={'None','2x Speed','3x Speed','4x Speed'}}local J={4,1,1}local K={nil}for fb,gb in pairs(I)do K[fb]={1,#gb,gb}end;local L=require('./CompactTJA/compactv4')local M=require('taikocurses')local N={window=M.initscr()}M.keypad(N,true)M.echo(false)M.raw(true)M.nl(false)M.cbreak(true)M.nodelay(N,true)M.getch(N)M.nodelay(N,false)local O,P=M.cols(),M.lines()D=D or O-2;local Q={Escape={['\27']=true,ALT_ESC=true},Scroll={L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_A2=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true}},Select={Init={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},Select={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},Escape={['\27']=true,ALT_ESC=true},L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true},U={KEY_UP=true,KEY_A2=true},D={KEY_DOWN=true,KEY_C2=true},Play={Hit={['4']=2,['v']=1,['n']=1,['8']=2},Escape={['\27']=true,ALT_ESC=true},L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_DOWN=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true},Select={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true}}},Search={Init={ALT_F=true,f=true,F=true},Backspace={['\8']=true,KEY_BACKSPACE=true,ALT_BKSP,CTL_BKSP},FirstResult={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},Select={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true},Up={KEY_A2=true,KEY_UP=true},Down={KEY_C2=true,KEY_DOWN=true},Escape={['\27']=true,ALT_ESC=true}}}local R=require('Pixels')local S={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(fb,gb)io.write(string.format("\27[%d;%dH",gb,fb))end}local function T(fb)return fb..string.rep(' ',D-#fb)end;local function U()local fb=M.getch(N)local gb=M.getkeyname(fb)return fb,gb end;local function V(fb)return fb>=32 and fb<=126 end;local function W(fb,gb,hb,ib)return(fb and(gb..string.sub(hb,#gb+1,-1))or hb)..ib end;local function X(fb,gb,hb)return fb>hb and gb or fb<gb and hb or fb end;local Y={[0]='No',[1]='Yes'}local function Z(fb)return fb and Y[1]or Y[0]end;local function ab(fb)return fb*100 ..'%'end;local function bb(fb)return MsToS(fb)..'s'end;local function cb(fb)return bb(SToMs(fb))end;local function db(fb)return tonumber(fb)and tonumber(fb)or 0 end;local eb={}S.ClearScreen()while true do l={}if s then l[o]={}for i=u-x,u+x do local jb=nil;if i<1 then jb=#j+i elseif i>#j then jb=i-#j else jb=i end;local kb=j[jb]if kb then l[0]=l[0]or{}l[0][(i-u)*y]=kb end end;local hb={}local ib=string.rep(' ',z)for y=q,r do hb[#hb+1]=W(y==0,B,ib,'')hb[#hb+1]=T(l[0][y]or'')hb[#hb+1]='\n'end;S.SetCursor(1,1)print(table.concat(hb))else l[0]={}l[0][q]=A;for i=u-x,u+x do local ib=nil;if i<1 then ib=#j+i elseif i>#j then ib=i-#j else ib=i end;local jb=j[ib]if jb then local kb=(i-u)*y;l[kb]=l[kb]or{}local lb=q+z;for i2=1,#jb do l[kb][lb]=string.sub(jb,i2,i2)lb=lb+1 end end end;local hb={}for y=q,r do for x=o,p do if l[x]and l[x][y]then local ib=l[x][y]if V(string.byte(ib))then hb[#hb+1]=ib else hb[#hb+1]=' 'end else hb[#hb+1]=' 'end end;hb[#hb+1]='\n'end;S.SetCursor(1,1)print(table.concat(hb))end;local fb,gb=U()if Q.Scroll.L[gb]then u=u-1 elseif Q.Scroll.R[gb]then u=u+1 elseif Q.Select.Init[gb]then local hb;if H then if eb[u]then hb=eb[u]else hb=Taiko.ParseTJA(k[u])eb[u]=hb end else hb=Taiko.ParseTJA(k[u])end;local ib,jb;local kb;if v==1 then kb={}for ob,pb in pairs(hb)do kb[#kb+1]={ob,pb.Metadata.COURSE}end;table.sort(kb,function(ob,pb)return ob[2]<pb[2]end)ib=1;jb=#kb;K[v]={ib,jb,kb}else local ob=K[v]ib,jb,kb=ob[1],ob[2],ob[3]end;w=ClipN(w,ib,jb)local lb=string.rep(' ',G)S.ClearScreen()S.SetCursor(1,1)local mb=nil;local nb=v;while true do S.SetCursor(1,1)local ob=kb[J[1]][2]mb=Taiko.GetDifficulty(hb,ob)local pb=mb.Metadata;local qb=Taiko.Analyze(mb)local rb={{'',pb.TITLE},{'\t',pb.SUBTITLE},{'',''},{'','Select Options:'},{W(v==1,F,lb,'Difficulty: '),Taiko.Data.CourseName[pb.COURSE]},{W(v==2,F,lb,'Mode: '),I[2][J[2]]},{W(v==3,F,lb,'Modifiers: '),I[3][J[3]]},{'',''},{'Difficulty: ',Taiko.Data.CourseName[pb.COURSE]},{'Stars: ',pb.LEVEL},{'Diverge Notes: ',Z(pb.DIVERGENOTES)},{'',''},{'','Statistics:'},{'Don (DON) / Ka (KA): ',db(qb.notes[1])..' + ('..db(qb.notes[3])..') / '..db(qb.notes[2])..' + ('..db(qb.notes[4])..') = '..ab((db(qb.notes[1])+db(qb.notes[3]))/qb.notes.validn)..' / '..ab((db(qb.notes[2])+db(qb.notes[4]))/qb.notes.validn)},{'Max Score (without drumroll): ',qb.maxscore},{'Max Combo: ',qb.maxcombo},{'Drumroll Time (total): ',bb(qb.drumrollms+qb.drumrollbigms)},{'Balloon Time: ',bb(qb.balloonms)},{'Balloon Hits: ',qb.balloonhit},{'Special Time: ',bb(qb.specialms)},{'Special Hits: ',qb.specialhit},{'',''},{'','Press Enter to Play!'}}for i=1,#rb do local vb=rb[i]print(T(vb[1]..tostring(vb[2])))end;local sb,tb=U()if Q.Select.L[tb]then w=w-1 elseif Q.Select.R[tb]then w=w+1 elseif Q.Select.U[tb]then v=v-1 elseif Q.Select.D[tb]then v=v+1 elseif Q.Select.Select[tb]then while true do local vb,wb=Taiko.PlaySong(hb,ob,Q.Select.Play,N)if vb and wb then break elseif vb=='Retry'then else break end end;M.nodelay(N,false)elseif Q.Select.Escape[tb]then break end;v=ClipN(v,1,3)if v~=nb then w=J[v]nb=v end;local ub=K[v]ib,jb=ub[1],ub[2]w=X(w,ib,jb)J[v]=w end elseif Q.Search.Init[gb]then local hb=''local ib={}local jb=1;local kb=nil;local lb=1;S.ClearScreen()S.SetCursor(1,1)print('Searching...')while true do S.SetCursor(#hb+1,2)local mb,nb=U()S.SetCursor(1,2)if Q.Search.Backspace[nb]then hb=string.sub(hb,1,-2)elseif Q.Search.FirstResult[nb]then kb=ib[1]break elseif Q.Search.Select[nb]then kb=ib[lb]break elseif Q.Search.Down[nb]then lb=lb+1 elseif Q.Search.Up[nb]then lb=lb-1 elseif Q.Search.Escape[nb]then break else hb=hb..nb end;print(T(hb))local ob=L.SearchHeaderAll(j,hb)for i=1,C do if ob[i][2]==-math.huge then jb=i-1;break elseif i==C then jb=i end end;lb=ClipN(lb,1,jb)local pb=false;for i=1,C do local qb=ob[i]if pb then print(T(''))else if qb then if qb[2]==-math.huge then pb=true;print(T(''))else print(T((i==lb and E or i)..'. '..ob[i][3]))ib[i]=qb end end end end end;u=(kb and kb[1]or u)or u elseif Q.Escape[gb]then return end;u=X(u,1,#j)end end;local f='./CompactTJA/taikobuipm.tjac'f='./CompactTJA/ESE/06 Classical.tjac'f='./CompactTJA/ESE/ESE.tjac'local g=require('./CompactTJA/compactv4')local h,i=g.Decompress(g.Read(f))Taiko.SongSelect(i,h)error()Taiko.PlaySong(Taiko.ParseTJA(g.InputFile(f)),'Ura')
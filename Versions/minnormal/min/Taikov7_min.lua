Split=function(c,d)local e={}for f,g in c:gmatch("([^"..d.."]*)("..d.."?)")do table.insert(e,f)if g==''then return e end end end;Trim=function(b)local c=b:gsub("^%s*(.-)%s*$","%1")return c end;TrimLeft=function(b)local c=b:gsub("^%s*(.-)$","%1")return c end;TrimRight=function(b)local c=b:gsub("^(.-)%s*$","%1")return c end;StartsWith=function(c,d)return c:sub(1,#d)==d end;EndsWith=function(c,d)return c:sub(-#d,-1)==d end;Table={}function Table.Clone(b,c)c=c or{}local d=type(b)local e;if d=='table'then if c[b]then e=c[b]else e={}c[b]=e;for f,g in next,b,nil do e[Table.Clone(f,c)]=Table.Clone(g,c)end;setmetatable(e,Table.Clone(getmetatable(b),c))end else e=b end;return e end;ClipN=function(c,d,e)if c<d then return d elseif c>e then return e else return c end end;function Error(b)error(b)end;LineN=nil;function ParseError(b,c,d)Error('Line: '..LineN..'\n'..b..': '..c.. (d and(', '..d)or''))end;function MsToS(b)return b/1000 end;function SToMs(b)return b*1000 end;Taiko={}Taiko.Data={Languages={'','EN','JA','CN','TW','KO'},GenreName={Pop={'pop','j-pop'},Anime={'anime','アニメ'},Kids={'kids','どうよう'},Variety={'variety','バラエティ'},VOCALOID={'vocaloid','ボーカロイド'},Classic={'classic','クラシック'},['Game Music']={'game music','ゲームミュージック'},['Namco Original']={'namco original','ナムコオリジナル'}},CourseId={easy=0,normal=1,hard=2,oni=3,edit=4,tower=5,dan=6,ura=4},CourseName={[0]='Easy','Normal','Hard','Oni','Edit','Tower','Dan','Ura'},RatingMultiplier={[0]=0,[1]=0.5,[2]=1,[3]=2},ScoreMode={[0]=function(b,c,d,e,f)return b+ ( ( (c<200)and(d or 1000)or( (d or 1000)+ (e or 1000)))*Taiko.Data.RatingMultiplier[f])end,[1]=function(b,c,d,e,f)return b+ (d+math.max(0,e*math.floor((math.min(c,100)-1)/10)))*Taiko.Data.RatingMultiplier[f]end,[2]=function(b,c,d,e,f)return b+ (d+e* ( (c>=100)and 8 or(c>=50)and 4 or(c>=30)and 2 or(c>=10)and 1 or 0))*Taiko.Data.RatingMultiplier[f]end},Autoscore={[0]=function(b)end,[1]=function(b)end,[2]=function(b)end},SideId={normal=1,ex=2,both=3},SideName={'normal','ex','both'},StyleId={single=1,double=2,couple=2},StyleName={'single','double'},Exam={Condition={g=true,jp=true,jg=true,jb=true,s=true,r=true,h=true,c=true},Scope={m=true,l=true}},Branch={PathId={N=0,E=1,M=2},PathName={[0]='N',[1]='E',[2]='M'},Requirements={r=function()end,p=function()end}}}for b,c in pairs(Taiko.Data.ScoreMode)do Taiko.Data.ScoreMode[b]=function(...)return math.floor(c(...)/10)*10 end end;function Taiko.ParseTJA(b)local c=os.clock()local d={}local e={Metadata={BPM=120,WAVE='main.mp3',OFFSET=0,DEMOSTART=0,SCOREMODE=1,SONGVOL=100,SEVOL=100,SIDE=3,LIFE=0,GAME='Taiko',HEADSCROLL=1,MOVIEOFFSET=0,COURSE='ONI',LEVEL=0,BALLOON=nil,SCOREINIT,SCOREDIFF,BALLOONNOR=nil,BALLOONEXP=nil,BALLOONMAS=nil,STYLE=1,EXAM1=nil,EXAM2=nil,EXAM3=nil,GAUGEINCR='NORMAL',TOTAL=nil,HIDDENBRANCH=0,DIVERGENOTES=false,SCOREINIT=0,SCOREDIFF=0},Data={}}local function f(q)local r=Taiko.Data.Languages;for i=1,#r do local s=e.Metadata[q..r[i]]if s then return s end end;return nil end;local function g(q,r,s)local t=tonumber(r)if t then return t else ParseError(q,s,r)end end;local function h(q,r,s,t)if r then return r else ParseError(q,s,t)end end;local function i(q,r,s)local t={['true']=true,['false']=false,yes=true,no=false,['1']=true,['0']=false,[1]=true,[0]=false}local u=t[r]~=nil;if u then return u else ParseError(q,s,r)end end;local function j(q,r)local s=','local u='\\'local v={}local w=''local x=false;for i=1,#r do local y=string.sub(r,i,i)if x then w=w..y;x=false else if y==s then table.insert(v,w)w=''elseif y==u then x=true else w=w..y end end end;table.insert(v,w)return v end;local function k(q,r,s)local u=j(q,r)for i=1,#u do u[i]=g(q,u[i],s,r)end;return u end;local function l(q,r,t)if r and r~=''then return k(q,r,t)else return{}end end;local function m(q,r,t)if r and r~=''then local u=j(q,r,t)h(q,Taiko.Data.Exam.Condition[u[1]],t)u[2]=g(q,u[2],t)u[3]=g(q,u[3],t)h(q,Taiko.Data.Exam.Scope[u[4]],t)return u else return{}end end;local n={}local function o()local q={settings={noteparse={notealias={A=3,B=4},noteexceptions={[',']=true,[' ']=true,['\t']=true}},command={matchexceptions={}}},bpm=0,ms=0,songstarted=false,timingpoint=nil,sign=4 /4,mpm=0,mspermeasure=0,scroll=1,measuredone=true,currentmeasure={},measurepushto=e.Data,barline=true,gogo=false,lastlong=nil,balloonn=1,currentbranch=nil,branch={on=false,requirements={},paths={}},msbeforebranch=nil}function q.createnote(r)if r then local s={ms=nil,data=nil,type=r,txt=nil,gogo=q.gogo,scroll=(q.scroll*e.Metadata.HEADSCROLL),mspermeasure=q.mspermeasure,bpm=q.bpm,nextnote=nil,radius=1,requiredhits=nil,length=nil,endnote=nil,onnotepush=nil}s.type=r;if r==3 or r==4 or r==6 then s.radius=s.radius*1.6 end;if r==5 or r==6 or r==7 or r==9 then if q.lastlong then if r==9 then else ParseError('parser.noteparse','Last long note has not ended')end else q.lastlong=s;if r==7 or r==9 then s.requiredhits=h('parser.noteparse',e.Metadata.BALLOON[q.balloonn],'Invalid number of balloons',q.balloonn)q.balloonn=q.balloonn+1 end end end;if r==8 then local t=q.lastlong;q.lastlong=nil;s.startnote=t;if t then s.onnotepush=function()t.length=s.ms-t.ms;t.endnote=s end else end end;return s else return{ms=nil,data=nil,type=nil,txt=nil,gogo=q.gogo,scroll=(q.scroll*e.Metadata.HEADSCROLL),mspermeasure=q.mspermeasure,bpm=q.bpm,nextnote=nil}end end;function q.endbranch()local r=q.createnote()r.data='event'r.event='branch'r.branch={requirements=q.branch.requirements,paths=q.branch.paths}q.branch.on=false;q.branch.requirements={}q.branch.paths={}table.insert(e.Data,r)q.measurepushto=e.Data end;return q end;n=o()local p=Split(b,'\n')for i=1,#p do LineN=i;local q=Trim(p[i])if StartsWith(q,'//')or q==''then else local r=string.find(q,'//')if r then q=string.sub(q,1,r-1)end;local s=false;if n.songstarted==false and s==false then local t={string.match(q,'(%u+):(.*)')}if t[1]then local u=Trim(t[2])if u~=''then e.Metadata[Trim(t[1])]=u end;s=true end end;if(n.songstarted or StartsWith(q,'#START'))and s==false then local t={string.match(q,'#(%u-)%s(.*)')}if not t[1]then t={string.match(q,'#(%u+)')}end;if t[1]then if t[1]=='START'then if n.songstarted then ParseError(t[1],'Song has already started')else e.OriginalMetadata=Table.Clone(e.Metadata)e.Metadata.TITLE=h(t[1],f('TITLE'),'Title is missing')e.Metadata.SUBTITLE=h(t[1],f('SUBTITLE'),'Subtitle is missing')e.Metadata.BPM=g(t[1],e.Metadata.BPM,'Invalid bpm')e.Metadata.OFFSET=SToMs(g(t[1],e.Metadata.OFFSET,'Invalid offset'))e.Metadata.DEMOSTART=SToMs(g(t[1],e.Metadata.DEMOSTART,'Invalid demostart'))if e.Metadata.DEMOSTART==0 then e.Metadata.DEMOSTART=nil end;for x,y in pairs(Taiko.Data.GenreName)do for i=1,#y do if y[i]==e.Metadata.GENRE then e.Metadata.GENRE=x end end end;e.Metadata.SCOREMODE=g(t[1],e.Metadata.SCOREMODE,'Invalid scoremode')h(t[1],Taiko.Data.ScoreMode[e.Metadata.SCOREMODE],'Invalid scoremode',e.Metadata.SCOREMODE)if e.Metadata.MAKER then e.Metadata.CREATORURLT={}e.Metadata.CREATOR=Trim(string.gsub(e.Metadata.MAKER,'(<.->)',function(x)table.insert(e.Metadata.CREATORURLT,string.sub(x,2,-2))return''end))e.Metadata.CREATORURL=table.concat(e.Metadata.CREATORURLT,', ')e.Metadata.CREATIVE=false else e.Metadata.CREATIVE=false end;e.Metadata.SONGVOL=g(t[1],e.Metadata.SONGVOL,'Invalid songvol')/100;e.Metadata.SEVOL=g(t[1],e.Metadata.SEVOL,'Invalid sevol')/100;local u=tonumber(e.Metadata.SIDE)if u then h(t[1],Taiko.Data.SideName[u],'Invalid side id',e.Metadata.SIDE)e.Metadata.SIDE=u else e.Metadata.SIDE=h(t[1],Taiko.Data.SideId[string.lower(e.Metadata.SIDE)],'Invalid side name',e.Metadata.SIDE)end;e.Metadata.LIFE=g(t[1],e.Metadata.LIFE,'Invalid life')if e.Metadata.LIFE==0 then e.Metadata.LIFE=nil end;e.Metadata.GAME=string.lower(e.Metadata.GAME)if e.Metadata.GAME=='taiko'then elseif e.Metadata.GAME=='jube'then else end;e.Metadata.HEADSCROLL=g(t[1],e.Metadata.HEADSCROLL,'Invalid headscroll')e.Metadata.MOVIEOFFSET=g(t[1],e.Metadata.MOVIEOFFSET,'Invalid movieoffset')local v=tonumber(e.Metadata.COURSE)if v then h(t[1],Taiko.Data.CourseName[v],'Invalid course id',e.Metadata.COURSE)e.Metadata.COURSE=v else e.Metadata.COURSE=h(t[1],Taiko.Data.CourseId[string.lower(e.Metadata.COURSE)],'Invalid course name',e.Metadata.COURSE)end;e.Metadata.LEVEL=ClipN(math.floor(g(t[1],e.Metadata.LEVEL,'Invalid level')),0,10)e.Metadata.BALLOON=l(t[1],e.Metadata.BALLOON,'Invalid balloon')e.Metadata.SCOREINIT=g(t[1],e.Metadata.SCOREINIT,'Invalid scoreinit')e.Metadata.SCOREDIFF=g(t[1],e.Metadata.SCOREDIFF,'Invalid scoreinit')e.Metadata.BALLOONNOR=l(t[1],e.Metadata.BALLOONNOR,'Invalid balloonnor')e.Metadata.BALLOONEXP=l(t[1],e.Metadata.BALLOONEXP,'Invalid balloonexp')e.Metadata.BALLOONMAS=l(t[1],e.Metadata.BALLOONMAS,'Invalid balloonmas')local w=tonumber(e.Metadata.STYLE)if w then h(t[1],Taiko.Data.StyleName[w],'Invalid course id',Taiko.Data.STYLE)e.Metadata.STYLE=w else e.Metadata.STYLE=h(t[1],Taiko.Data.CourseId[string.lower(e.Metadata.STYLE)],'Invalid course name',e.Metadata.STYLE)end;e.Metadata.EXAM1=m(e.Metadata.EXAM1)e.Metadata.EXAM2=m(e.Metadata.EXAM2)e.Metadata.EXAM3=m(e.Metadata.EXAM3)e.Metadata.GAUGEINCR=string.lower(e.Metadata.GAUGEINCR)if e.Metadata.TOTAL then e.Metadata.TOTAL=g(t[1],e.Metadata.TOTAL,'Invalid total')end;e.Metadata.HIDDENBRANCH=i(t[1],e.Metadata.HIDDENBRANCH,'Invalid hiddenbranch')n.bpm=e.Metadata.BPM;n.songstarted=true end elseif t[1]=='END'then if n.songstarted then if#n.currentmeasure~=0 then ParseError(t[1],'Current measure is not empty')end;table.insert(d,e)e={Metadata=Table.Clone(e.OriginalMetadata),Data={}}n=o()n.songstarted=false;n.measurepushto=e.Data else ParseError(t[1],'Song has already ended')end elseif t[1]=='MEASURE'then local u,v=string.match(t[2],'(%d+)/(%d+)')u=g(t[1],u,'Invalid measure')v=g(t[1],v,'Invalid measure')n.sign=(u/v)or n.sign elseif t[1]=='BPMCHANGE'then n.bpm=g(t[1],t[2],'Invalid bpmchange')or n.bpm elseif t[1]=='DELAY'then table.insert(n.currentmeasure,{t[1],SToMs((g(t[1],t[2],'Invalid delay')or 0))})elseif t[1]=='SCROLL'then n.scroll=g(t[1],t[2],'Invalid scroll')or n.scroll;if n.scroll==0 then ParseError(t[1],'Scroll cannot be 0')end elseif t[1]=='GOGOSTART'then n.gogo=true elseif t[1]=='GOGOEND'then n.gogo=false elseif t[1]=='BARLINEOFF'then n.barline=false elseif t[1]=='BARLINEON'then n.barline=true elseif t[1]=='BRANCHSTART'then if n.branch.on then n.endbranch()end;n.msbeforebranch=n.ms;n.branch.on=true;e.Metadata.DIVERGENOTES=true;local u=j(t[1],t[2])local v=h(t[1],Taiko.Data.Branch.Requirements[string.lower(u[1])],'Invalid type',u[1])n.branch.requirements={v}local w=2;while true do if not u[w]then break end;local x=Taiko.Data.Branch.PathName[w-1]if x then n.branch.requirements[x]=u[w]else break end;w=w+1 end elseif Taiko.Data.Branch.PathId[t[1]]then if n.branch.on then n.ms=n.msbeforebranch;n.currentbranch=t[1]n.branch.paths[t[1]]={}n.measurepushto=n.branch.paths[t[1]]else ParseError(t[1],'Branch has not started')end elseif t[1]=='BRANCHEND'then if n.branch.on then n.endbranch()else ParseError(t[1],'Branch has already ended')end elseif t[1]=='SECTION'then elseif t[1]=='LYRIC'then elseif t[1]=='LEVELHOLD'then elseif t[1]=='BMSCROLL'then elseif t[1]=='HBSCROLL'then elseif t[1]=='SENOTECHANGE'then elseif t[1]=='NEXTSONG'then elseif t[1]=='DIRECTION'then elseif t[1]=='SUDDEN'then elseif t[1]=='JPOSSCROLL'then else end;s=true end end;if(n.songstarted)and s==false then n.mpm=n.bpm*n.sign/4;n.mspermeasure=60000 *n.sign*4 /n.bpm;if n.barline and#n.currentmeasure==0 then local t=n.createnote()t.ms=n.ms;t.data='event't.event='barline'table.insert(n.measurepushto,1,t)end;for i=1,#q do local t=string.sub(q,i,i)if n.settings.noteparse.noteexceptions[t]then else local u=g('parser.noteparse',tonumber(t)or n.settings.noteparse.notealias[t]or t,'Invalid note')if u then local v=n.createnote(u)v.data='note'table.insert(n.currentmeasure,v)end end end;if EndsWith(TrimRight(q),',')then n.mpm=n.bpm*n.sign/4;n.mspermeasure=60000 *n.sign*4 /n.bpm;if#n.currentmeasure==0 then n.ms=n.ms+n.mspermeasure else local t=0;local u=nil;for i=1,#n.currentmeasure do local w=n.currentmeasure[i]if w.data=='note'then u=u or w.mspermeasure;t=t+1 end end;local v=u/t;for i=1,#n.currentmeasure do local w=n.currentmeasure[i]if w[1]=='DELAY'then n.ms=n.ms+w[2]else if w.type~=0 then w.ms=n.ms;local x=e.Data[#e.Data]if x then x.nextnote=w end;table.insert(n.measurepushto,w)if w.onnotepush then w.onnotepush()end;v=w.mspermeasure/t end end;n.ms=n.ms+v end end;n.measuredone=true;n.currentmeasure={}else n.measuredone=false end end end end;print('Parsing Took: '..SToMs(os.clock()-c)..'ms')return d end;function Taiko.Analyze(b)for i=1,#b.Data do end end;function Taiko.GetDifficulty(b,c)local d=Taiko.Data.CourseId[string.lower(c)]or c;for e,f in pairs(b)do if f.Metadata.COURSE==d then return f end end;Error('No difficulty found, '..c)return nil end;function Taiko.ForAll(b,c)local d=1;for i=1,#b do local e=b[i]if e.branch then local g=-1;for h,j in pairs(e.branch.paths)do local k=d;for i2=1,#j do c(j[i2],i2,k)k=k+1 end;g=(g<k)and k or g end;d=g else c(e,i,d)end;d=d+1 end;return b end;function Taiko.GetAllNotes(b)local c={}for d,e in pairs(b)do if e.branch then for f,g in pairs(e.branch.paths)do for i=1,#g do table.insert(c,g[i])end end else table.insert(c,e)end end;return c end;function Taiko.ConnectNotes(b)local c=nil;for i=#b,1,-1 do local d=b[i]d.nextnote=c;c=d end;return b end;function Taiko.ExtractBranch(b,c)return b.branch.paths[c]end;function Taiko.ConnectAll(b)local c=nil;for i=#b,1,-1 do local d=b[i]if d.branch then for e,f in pairs(d.branch.paths)do local g=Taiko.ConnectNotes(f)g[#g].nextnote=c end else d.nextnote=c end;c=d end end;function Taiko.CalculateSpeed(b,c)local d=(c*b.scroll*b.bpm/7500)return d end;function Taiko.CalculateSpeedAll(b,c)for i=1,#b do b[i].speed=Taiko.CalculateSpeed(b[i],c)end;return b end;function Taiko.RenderScale(b)local c={}local d={}local e={}for i=1,#b.Data do local j=b.Data[i]if j.data=='note'then local k=math.floor(j.ms)if math.floor(k)-k==0 then table.insert(c,{k,j.type})table.insert(d,k)else table.insert(e,i)end end end;function gcd2(i,j)if j==0 then return i else return gcd2(j,i%j)end end;function gcdn(i)local j=i[1]for i=2,#i do j=gcd2(j,i[i])end;return j end;local f=gcdn(d)for i=1,#e do local j=c[e[i]]j[1]=math.floor(j[1]/f)*f end;local g=''local h=0;for i=1,#c do c[i][1]=c[i][1]/f;g=g..string.rep(' ',c[i][1]-h)..c[i][2]h=c[i][1]end;return g end;function Taiko.PlaySong(b,c)local d={on=false,fps=60,frames={}}local e=10;local f=1000;local g=4;local h=0;local i=10;local j=0;local k=40;local l=3;local m=1;local n={[1]={color='red'},[2]={color='blue'},[3]={color='red'},[4]={color='blue'},[5]={color='yellow'},[6]={color='yellow'}}k=math.floor(k*g)local o=j+k;l=math.floor(l*g)local p=require('Pixels')local q,r=j,k;local s,t=-i,i;p.Convert.ToDots=function(U)U=GetPixelData(U)local V,W=U.Data,U.Color;if ReverseY then local function gb(hb)local ib={}for jb,kb in pairs(hb)do for lb,mb in pairs(kb)do ib[jb]=ib[jb]or{}ib[jb][-lb]=mb end end;return ib end;V=gb(V)W=gb(W)end;U={Data=V,Color=W}local function X(gb)local hb=nil;for ib,jb in pairs(gb)do if not hb or ib<hb then hb=ib end end;return hb end;local function Y(gb)local hb=nil;for ib,jb in pairs(gb)do if not hb or ib>hb then hb=ib end end;return hb end;local function Z(gb,hb)local ib={}for jb,kb in pairs(gb)do local lb=hb(kb)if lb then ib[lb]=true end end;return hb(ib)end;local ab={}local bb=string.rep('0',8)local cb=p.Data.Dot[bb]local db=nil;local eb=nil;if U.Color.All then local gb=tostring(p.Color(U.Color.All))table.insert(ab,gb)eb=gb end;local fb={}for gb,hb in pairs(V)do for ib,jb in pairs(hb)do fb[ib]=fb[ib]or{}fb[ib][gb]=jb end end;if not s then return''end;for y=s,t,4 do for x=q,r,2 do local gb=''local hb={{0,0},{0,1},{0,2},{0,3},{1,0},{1,1},{1,2},{1,3}}for i=1,8 do local ib,jb=x+hb[i][1],y+hb[i][2]gb=gb.. ( (V[ib]and V[ib][jb]or false)and V[ib][jb]or p.Data.Empty)end;if gb~=bb then gb=p.Data.Dot[gb]if not eb then local ib=p.GetColor(U,x,y)if not ib then local jb={{0,0},{0,1},{0,2},{0,3},{1,0},{1,1},{1,2},{1,3}}for i=1,8 do ib=p.GetColor(U,x+jb[i][1],y+jb[i][2])if ib then break end end end;if ib then ib=tostring(p.Color(ib))else ib=tostring(p.Color('reset'))end;if db==ib then else table.insert(ab,ib)db=ib end end;table.insert(ab,gb)else table.insert(ab,cb)end end;table.insert(ab,p.Data.NewLine)end;table.insert(ab,tostring(p.Color('reset')))return table.concat(ab)end;local function u(U,V)local W=math.floor(V.p)local X,Y=h-i,h+i;for y=X,Y do local Z=p.GetPixel(U,W,y)if Z=='0'or Z==nil then p.SetPixel(U,W,y,'1')end end end;local function v(U,V,W)W=W or V.p;p.Circle(U,math.floor(W),h,g*V.radius,n[V.type])end;local function w(U,V,W,X,Y,Z)local ab=Z or{}color=ab.color;local bb=(j-e)if V<bb then V=bb end;local cb=(k+e)if W>cb then W=cb end;for y=X,Y do for x=V,W do p.SetPixel(U,x,y,'1')if color then p.SetColor(U,x,y,color)end end end end;local function x(U,V)local W=V.type;if W==1 or W==2 or W==3 or W==4 then v(U,V)elseif W==5 or W==6 then v(U,V)local X=V.endnote;local Y=(X.ms-V.ms)*V.speed;v(U,V)local Z=g*V.radius;local ab,bb=math.floor(V.p),math.floor(V.p+Y)local cb=h-Z;local db=h+Z;w(U,ab,bb,cb,db,n[V.type])elseif W==8 then v(U,V.startnote,V.p)end end;local z={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(U,V)io.write(string.format("\27[%d;%dH",V,U))end}b=Taiko.GetDifficulty(b,c)local A=Taiko.GetAllNotes(b.Data)local B=b.Metadata.OFFSET;local function C(U)return(U.data=='note')or(U.data=='event'and U.event=='barline')end;local function D(U,V)return V- (( (k+e)/math.abs(U.speed)))end;local function E(U,V)return(U.ms-V)*U.speed+l end;local function F(U,V)return U.loadp- (U.speed* (V-U.loadms))end;local G={}for U,V in pairs(A)do V.ms=V.ms-B;V.s=MsToS(V.ms)V.speed=Taiko.CalculateSpeed(V,g)V.loadms=D(V,V.ms)V.loads=MsToS(V.loadms)V.loadp=E(V,V.loadms)table.insert(G,V.ms)end;for U,V in pairs(b.Data)do if V.branch then for W,X in pairs(V.branch.paths)do table.sort(X,function(Y,Z)return Y.loadms<Z.loadms end)end end end;table.sort(b.Data,function(U,V)if U.branch and V.branch then for W,X in pairs(U.branch.paths)do for Y,Z in pairs(V.branch.paths)do return X[1].loadms<Z[1].loadms end end elseif U.branch then for W,X in pairs(U.branch.paths)do return X[1].loadms<V.loadms end elseif V.branch then for W,X in pairs(V.branch.paths)do return U.loadms<X[1].loadms end else return U.loadms<V.loadms end end)Taiko.ConnectAll(b.Data)Taiko.ForAll(b.Data,function(U,V,W)U.n=W end)local H=math.max(unpack(G))+f;local I={s=1,e=0,n=0}local J=b.Data[1]local K=J.loads;I.e=I.n;local L=10;local function M(U,V)print(U..': '..tostring(V)..string.rep(' ',L))end;local N=''local function O(U)N=N..'\n'..U end;local function P()print(N)end;z.ClearScreen()local Q='M'local R=0;local S=0;local T=os.clock()if not d.on then while true do local U=p.New()local V=os.clock()local W=V-T;local X=W*1000;if J then if J.loadms<X then I.n=I.n+1;I.e=J.n;I[J.n]=J;J=J.nextnote;if J and J.branch then O('branch')J=J.branch.paths[Q][1]end end else if X>H then break end end;p.Circle(U,math.floor(l),h,g,{color='purple'})for i=I.s,I.e do local Z=I[i]if Z then Z.p=F(Z,X)if math.abs(Z.p-l)> (k+e+1)then if Z.endnote and Z.endnote.done~=true then else Z.done=true;I[i]=nil;if J and I.n==0 then I.s=J.n elseif Z.n==I.s then if Z.n==I.e then I.n=0 else local ab=I.s;repeat ab=ab+1;I.n=I.n-1 until I[ab]I.s=ab end end end else if Z.data=='event'then if Z.event=='barline'then u(U,Z)end elseif Z.data=='note'then x(U,Z)else error('Invalid note.data')end end end end;z.SetCursor(1,1)print(U)R=R+1;local Y=os.clock()-V;S=S+Y;M('S',W)M('Ms',X)M('Loaded',I.n)M('Frames Rendered',R)M('Last Frame Render (s)',Y)M('Last Frame Render (ms)',Y*1000)M('Frame Render Total (s)',S)M('Frame Render Total (ms)',S*1000)M('Frame Render Total (%)',S/W*100)M('FPS (Frame)',R/W)M('Memory Usage (mb)',collectgarbage('count')/1000)M('Finished (%)',X/ (H)*100)P()end else while true do local W=p.New()local X=os.clock()local Y=(1 /d.fps)*R;local Z=Y*1000;if J then if J.loadms<Z then I.n=I.n+1;I.e=J.n;I[J.n]=J;J=J.nextnote;if J and J.branch then O('branch')J=J.branch.paths[Q][1]end end else if Z>H then break end end;for i=I.s,I.e do local bb=I[i]if bb then bb.p=F(bb,Z)if(bb.p< (j-e))then if bb.endnote and bb.endnote.done~=true then else bb.done=true;I[i]=nil;if J and I.n==0 then I.s=J.n elseif bb.n==I.s then if bb.n==I.e then I.n=0 else local cb=I.s;repeat cb=cb+1;I.n=I.n-1 until I[cb]I.s=cb end end end end;if bb.p< (k+buffer)then if bb.data=='event'then if bb.event=='barline'then u(W,bb)end elseif bb.data=='note'then x(W,bb)else error('Invalid note.data')end end end end;z.SetCursor(1,1)d.frames[R]=W;R=R+1;local ab=os.clock()-X;S=S+ab;M('S',Y)M('Ms',Z)M('Loaded',I.n)M('Frames Rendered',R)M('Last Frame Render (s)',ab)M('Last Frame Render (ms)',ab*1000)M('Frame Render Total (s)',S)M('Frame Render Total (ms)',S*1000)M('Frame Render Total (%)',S/Y*100)M('FPS (Frame)',R/Y)M('Memory Usage (mb)',collectgarbage('count')/1000)M('Finished (%)',Z/ (H)*100)P()end;print('Prerendering Finished!\nPress enter to start')io.read()local U=os.clock()local V=(1 /d.fps)while true do local W=os.clock()-U;local X=d.frames[math.floor(( (W-W%V)/V)+0.5)]if X==nil then break end;z.SetCursor(1,1)print(X)end end end;file='./tja/donkama.tja'file='./tja/ekiben.tja'file='./tja/saitama.tja'file='./tja/funny2000.tja'file='./tja/waraeru.tja'file='./tja/ekiben.tja'Taiko.PlaySong(Taiko.ParseTJA(io.open(file,'r'):read('*all')),'Oni')
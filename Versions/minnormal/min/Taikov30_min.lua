#!.\raylua_s.exe 
local e=require('CompactTJA/compact')Split=function(h,j)local k={}for l,m in h:gmatch("([^"..j.."]*)("..j.."?)")do table.insert(k,l)if m==''then return k end end end;Trim=function(h)local j=h:gsub("^%s*(.-)%s*$","%1")return j end;TrimLeft=function(h)local j=h:gsub("^%s*(.-)$","%1")return j end;TrimRight=function(h)local j=h:gsub("^(.-)%s*$","%1")return j end;StartsWith=function(h,j)return h:sub(1,#j)==j end;EndsWith=function(h,j)return h:sub(-#j,-1)==j end;Table={}function Table.Clone(h,j)j=j or{}local k=type(h)local l;if k=='table'then if j[h]then l=j[h]else l={}j[h]=l;for m,n in next,h,nil do l[Table.Clone(m,j)]=Table.Clone(n,j)end;setmetatable(l,Table.Clone(getmetatable(h),j))end else l=h end;return l end;ClipN=function(h,j,k)if h<j then return j elseif h>k then return k else return h end end;function Error(h)error(h)end;LineN=nil;function ParseError(h,j,k)Error('Line: '..LineN..'\n'..h..': '..j.. (k and(', '..k)or''))end;function MsToS(h)return h/1000 end;function SToMs(h)return h*1000 end;Taiko={}Taiko.Data={Languages={'','EN','JA','CN','TW','KO'},GenreName={Pop={'pop','j-pop'},Anime={'anime','アニメ'},Kids={'kids','どうよう'},Variety={'variety','バラエティ'},VOCALOID={'vocaloid','ボーカロイド'},Classic={'classic','クラシック'},['Game Music']={'game music','ゲームミュージック'},['Namco Original']={'namco original','ナムコオリジナル'}},CourseId={easy=0,normal=1,hard=2,oni=3,edit=4,tower=5,dan=6,ura=4},CourseName={[0]='Easy','Normal','Hard','Oni','Edit','Tower','Dan','Ura'},RatingMultiplier={[0]=0,[1]=0.5,[2]=1,[3]=2},GogoMultiplier=1.2,ScoreMode={Note={[0]=function(h,j,k,l,m,n)return h+ ( ( (j<200)and(k or 1000)or( (k or 1000)+ (l or 1000)))*Taiko.Data.RatingMultiplier[m]* (n and Taiko.Data.GogoMultiplier or 1))end,[1]=function(h,j,k,l,m,n)return h+ ( (k+math.max(0,l*math.floor((math.min(j,100)-1)/10)))*Taiko.Data.RatingMultiplier[m]* (n and Taiko.Data.GogoMultiplier or 1))end,[2]=function(h,j,k,l,m,n)return math.floor(h+ ( (k+l* ( (j>=100)and 8 or(j>=50)and 4 or(j>=30)and 2 or(j>=10)and 1 or 0))*Taiko.Data.RatingMultiplier[m]* (n and Taiko.Data.GogoMultiplier or 1))/10)*10 end},Drumroll={[0]=function(h,j,k)return h+ ( (j==5 and 300 or j==6 and 600)* (k and Taiko.Data.GogoMultiplier or 1))end,[1]=function(h,j,k)return h+ ( (j==5 and 300 or j==6 and 600)* (k and Taiko.Data.GogoMultiplier or 1))end,[2]=function(h,j,k)return h+ ( (j==5 and 100 or j==6 and 200)* (k and Taiko.Data.GogoMultiplier or 1))end},Balloon={[0]=function(h,j,k)return h+ ( (j==7 and 300)* (k and Taiko.Data.GogoMultiplier or 1))end,[1]=function(h,j,k)return h+ ( (j==7 and 300)* (k and Taiko.Data.GogoMultiplier or 1))end,[2]=function(h,j,k)return h+ ( (j==7 and 300)* (k and Taiko.Data.GogoMultiplier or 1))end},BalloonPop={[0]=function(h,j,k)return h+ ( (j==7 and 5000)* (k and Taiko.Data.GogoMultiplier or 1))end,[1]=function(h,j,k)return h+ ( (j==7 and 5000)* (k and Taiko.Data.GogoMultiplier or 1))end,[2]=function(h,j,k)return h+ ( (j==7 and 5000)* (k and Taiko.Data.GogoMultiplier or 1))end}},Autoscore={[0]=function(h)end,[1]=function(h)end,[2]=function(h)end},SideId={normal=1,ex=2,both=3},SideName={'normal','ex','both'},StyleId={single=1,double=2,couple=2},StyleName={'single','double'},Exam={Condition={g=true,jp=true,jg=true,jb=true,s=true,r=true,h=true,c=true},Scope={m=true,l=true}},Branch={PathId={N=0,E=1,M=2},PathName={[0]='N',[1]='E',[2]='M'},Requirements={r=function()end,p=function()end}},Timing={GetFunction=function(h)return function(j)if h==1 then return{good=5 /2 *j,ok=13 /2 *j,bad=15 /2 *j}else return{good=3 /2 *j,ok=9 /2 *j,bad=13 /2 *j}end end end},StatusId={bad=0,ok=1,good=2,biggood=3},StatusName={[0]='BAD',[1]='OK',[2]='GOOD',[3]='GOOD'},ModeId={['']=0,P1=1,P2=2},ModeName={[0]='',P1,P2},Combo={[1]=true,[2]=true,[3]=true,[4]=true},BigLeniency=2,Notes={ReverseNotes={[0]=0,[1]=2,[2]=1,[3]=4,[4]=3,[5]=5,[6]=6,[7]=7,[8]=8,[9]=9}},BigNoteMul=1.5,Strings={Notes={}}}function Taiko.ParseTJA(h)local j=os.clock()local k=true;local l=true;local m=true;local n={}local o={Metadata={SUBTITLE='',BPM=120,WAVE='main.mp3',OFFSET=0,DEMOSTART=0,SCOREMODE=1,SONGVOL=100,SEVOL=100,SIDE=3,LIFE=0,GAME='Taiko',HEADSCROLL=1,MOVIEOFFSET=0,COURSE='ONI',LEVEL=0,BALLOON=nil,SCOREINIT,SCOREDIFF,BALLOONNOR=nil,BALLOONEXP=nil,BALLOONMAS=nil,STYLE=1,EXAM1=nil,EXAM2=nil,EXAM3=nil,GAUGEINCR='NORMAL',TOTAL=nil,HIDDENBRANCH=0,DIVERGENOTES=false,SCOREINIT=0,SCOREDIFF=0,STOPSONG=false},Data={}}local function p(L)local M=Taiko.Data.Languages;for i=1,#M do local N=o.Metadata[L..M[i]]if N then return N end end;return nil end;local function q(L,M,N)local O=tonumber(M)if O then return O else ParseError(L,N,M)end end;local function r(L,M,N,O)if M then return M else ParseError(L,N,O)end end;local function s(L,M,N)local O={['true']=true,['false']=false,yes=true,no=false,['1']=true,['0']=false,[1]=true,[0]=false}local P=O[M]~=nil;if P then return P else ParseError(L,N,M)end end;local function t(L,M)local N=','local O='\\'local P={}local Q=''local R=false;for i=1,#M do local S=string.sub(M,i,i)if R then Q=Q..S;R=false else if S==N then table.insert(P,Q)Q=''elseif S==O then R=true else Q=Q..S end end end;table.insert(P,Q)return P end;local function u(L,M,N)local O=t(L,M)for i=1,#O do O[i]=q(L,O[i],N,M)end;return O end;local function v(L,M,N)if M and M~=''then return u(L,M,N)else return{}end end;local function w(L,M,N)if M and M~=''then local O=t(L,M,N)r(L,Taiko.Data.Exam.Condition[O[1]],N)O[2]=q(L,O[2],N)O[3]=q(L,O[3],N)r(L,Taiko.Data.Exam.Scope[O[4]],N)return O else return{}end end;local x=error;local function y(L)return string.find(L,'/')end;local function z(L)return string.match(L,'(%d+)/(%d+)')end;local function A(L)local M=nil;local N=false;local O=''for i=1,#L do local P=string.sub(L,i,i)if P=='+'or P=='-'then if M then x('There are multiple signs')else M=P end elseif P=='.'then if N then x('There are multiple decimal points')else O=O..P;N=true end elseif tonumber(P)then O=O..P end end;if O==''then x('No number was found')end;return tonumber((M or'+')..O)end;local function B(L)local M=tonumber(L)if M then return M end;local N=string.gsub(L,'[^%d%.%-%+]','')if N==''then return 0 end;return tonumber(N)or A(L)or A(N)end;local function C(L)return string.find(L,'i')end;local function D(L)local M={0,0}local N=false;local O=''for i=1,#L do local P=string.sub(L,i,i)if P=='+'or P=='-'then M[1]=M[1]+B(O)O=P elseif P=='i'then M[2]=M[2]+B(O)O=''else O=O..P end end;if O~=''then M[1]=M[1]+B(O)end;return M end;local function E(L)local M=Split(L,'%+')local N={}for i=1,#M do local Q=Split(M[i],'%-')for i=1,#Q do if i==1 then N[#N+1]=Q[i]else N[#N+1]='-'..Q[i]end end end;M=N;local O={0,0}local P={false,false}for i=1,#M do if M[i]~=''then local Q=false;if string.find(M[i],'i')then Q=true;M[i]=string.gsub(M[i],'i','')end;if y(M[i])then local R=false;if string.find(M[i],'%-')then R=true end;local S,T=z(M[i])M[i]=(S/T)P[Q and 2 or 1]=true;if R then M[i]=-M[i]end else M[i]=tonumber(M[i])end;if Q then O[2]=O[2]+M[i]else O[1]=O[1]+M[i]end end end;return O,P end;local function F(L)return string.find(L,',')end;local function G(L,M)return{L*math.cos(M),L*math.sin(M)}end;local function H(L)return Split(L,' ')end;local I={}local function J()local L={settings={noteparse={notes={[0]=true,[1]=true,[2]=true,[3]=true,[4]=true,[5]=true,[6]=true,[7]=true,[8]=true,[9]=true,['A']=true,['B']=true}},command={matchexceptions={}},directionweight={R=0,U=90,L=180,D=270,['0']=0,['1']=90,['2']=270,['3']=45,['4']=315,['5']=180,['6']=135,['7']=225}},bpm=0,ms=0,songstarted=false,timingpoint=nil,sign=4 /4,mpm=0,mspermeasure=0,scroll=1,scrollx=-1,scrolly=0,measuredone=true,currentmeasure={},measurepushto=o.Data,barline=true,insertbarline=true,gogo=false,lastlong=nil,balloonn=1,currentbranch=nil,branch={on=false,requirements={},paths={}},msbeforebranch=nil,section=false,disablescroll=false,stopsong=false,delay=0,suddenappear=nil,suddenmove=nil,notechain={},jposscroll={lengthms=nil,p=nil,lanep=nil}}function L.createnote(M)if M then local N={ms=nil,data=nil,type=M,txt=nil,gogo=L.gogo,scroll=(L.scroll*o.Metadata.HEADSCROLL),scrollx=(L.scrollx*o.Metadata.HEADSCROLL),scrolly=(L.scrolly*o.Metadata.HEADSCROLL),mspermeasure=L.mspermeasure,bpm=L.bpm,nextnote=nil,radius=1,requiredhits=nil,length=nil,endnote=nil,section=nil,text=nil,delay=L.delay,appearancems=L.suddenappear,movems=L.suddenmove,dummy=L.dummy,onnotepush=nil,line=LineN}if M==3 or M==4 or M==6 then N.radius=N.radius*Taiko.Data.BigNoteMul end;if M==5 or M==6 or M==7 or M==9 then if L.lastlong then if M==9 then else ParseError('parser.noteparse','Last long note has not ended')end else L.lastlong=N;if M==7 or M==9 then N.requiredhits=r('parser.noteparse',o.Metadata.BALLOON[L.balloonn],'Invalid number of balloons',L.balloonn)L.balloonn=L.balloonn+1 end end end;if M==8 then local O=L.lastlong;L.lastlong=nil;N.startnote=O;if O then N.onnotepush=function()O.length=N.ms-O.ms;O.endnote=N end else end end;if L.section then N.section=true;L.section=false end;return N else return{ms=nil,data=nil,type=nil,txt=nil,gogo=L.gogo,scroll=(L.scroll*o.Metadata.HEADSCROLL),scrollx=(L.scrollx*o.Metadata.HEADSCROLL),scrolly=(L.scrolly*o.Metadata.HEADSCROLL),mspermeasure=L.mspermeasure,bpm=L.bpm,nextnote=nil,delay=L.delay,appearancems=L.suddenappear,movems=L.suddenmove,line=LineN}end end;function L.createbarline()local M=L.createnote()M.ms=L.ms;M.data='event'M.event='barline'return M end;function L.endbranch()local M=L.createnote()M.data='event'M.event='branch'M.branch={requirements=L.branch.requirements,paths=L.branch.paths}L.branch.on=false;L.branch.requirements={}L.branch.paths={}table.insert(o.Data,M)L.measurepushto=o.Data end;return L end;I=J()local K=Split(h,'\n')for i=1,#K do LineN=i;local L=Trim(K[i])if StartsWith(L,'//')or L==''then else local M=string.find(L,'//')if M then L=string.sub(L,1,M-1)end;local N=false;if I.songstarted==false and N==false then local O={string.match(L,'(%u+):(.*)')}if O[1]then local P=Trim(O[2])if P~=''then o.Metadata[Trim(O[1])]=P end;N=true end end;if(I.songstarted or StartsWith(L,'#START')or StartsWith(L,'#BMSCROLL')or StartsWith(L,'#HBSCROLL'))and N==false then local O={string.match(L,'#(%u-)%s(.*)')}if not O[1]then O={string.match(L,'#(%u+)')}end;if O[1]then if O[1]=='START'then if I.songstarted then ParseError(O[1],'Song has already started')else o.OriginalMetadata=Table.Clone(o.Metadata)if O[2]then o.Metadata.MODE=r(O[1],Taiko.Data.ModeId[O[2]],'Invalid mode',O[2])else o.Metadata.MODE=0 end;o.Metadata.TITLE=r(O[1],p('TITLE'),'Title is missing')o.Metadata.SUBTITLE=r(O[1],p('SUBTITLE'),'Subtitle is missing')o.Metadata.BPM=q(O[1],o.Metadata.BPM,'Invalid bpm')o.Metadata.OFFSET=SToMs(q(O[1],o.Metadata.OFFSET,'Invalid offset'))o.Metadata.DEMOSTART=SToMs(q(O[1],o.Metadata.DEMOSTART,'Invalid demostart'))if o.Metadata.DEMOSTART==0 then o.Metadata.DEMOSTART=nil end;for S,T in pairs(Taiko.Data.GenreName)do for i=1,#T do if T[i]==o.Metadata.GENRE then o.Metadata.GENRE=S end end end;o.Metadata.SCOREMODE=q(O[1],o.Metadata.SCOREMODE,'Invalid scoremode')r(O[1],Taiko.Data.ScoreMode.Note[o.Metadata.SCOREMODE],'Invalid scoremode',o.Metadata.SCOREMODE)if o.Metadata.MAKER then o.Metadata.CREATORURLT={}o.Metadata.CREATOR=Trim(string.gsub(o.Metadata.MAKER,'(<.->)',function(S)table.insert(o.Metadata.CREATORURLT,string.sub(S,2,-2))return''end))o.Metadata.CREATORURL=table.concat(o.Metadata.CREATORURLT,', ')o.Metadata.CREATIVE=false else o.Metadata.CREATIVE=false end;o.Metadata.SONGVOL=q(O[1],o.Metadata.SONGVOL,'Invalid songvol')/100;o.Metadata.SEVOL=q(O[1],o.Metadata.SEVOL,'Invalid sevol')/100;local P=tonumber(o.Metadata.SIDE)if P then r(O[1],Taiko.Data.SideName[P],'Invalid side id',o.Metadata.SIDE)o.Metadata.SIDE=P else o.Metadata.SIDE=r(O[1],Taiko.Data.SideId[string.lower(o.Metadata.SIDE)],'Invalid side name',o.Metadata.SIDE)end;o.Metadata.LIFE=q(O[1],o.Metadata.LIFE,'Invalid life')if o.Metadata.LIFE==0 then o.Metadata.LIFE=nil end;o.Metadata.GAME=string.lower(o.Metadata.GAME)if o.Metadata.GAME=='taiko'then elseif o.Metadata.GAME=='jube'then else end;o.Metadata.HEADSCROLL=q(O[1],o.Metadata.HEADSCROLL,'Invalid headscroll')o.Metadata.MOVIEOFFSET=q(O[1],o.Metadata.MOVIEOFFSET,'Invalid movieoffset')local Q=tonumber(o.Metadata.COURSE)if Q then r(O[1],Taiko.Data.CourseName[Q],'Invalid course id',o.Metadata.COURSE)o.Metadata.COURSE=Q else o.Metadata.COURSE=r(O[1],Taiko.Data.CourseId[string.lower(o.Metadata.COURSE)],'Invalid course name',o.Metadata.COURSE)end;o.Metadata.TIMING=Taiko.Data.Timing.GetFunction(o.Metadata.COURSE)o.Metadata.LEVEL=ClipN(math.floor(q(O[1],o.Metadata.LEVEL,'Invalid level')),0,10)o.Metadata.BALLOON=v(O[1],o.Metadata.BALLOON,'Invalid balloon')o.Metadata.SCOREINIT=q(O[1],o.Metadata.SCOREINIT,'Invalid scoreinit')o.Metadata.SCOREDIFF=q(O[1],o.Metadata.SCOREDIFF,'Invalid scoreinit')o.Metadata.BALLOONNOR=v(O[1],o.Metadata.BALLOONNOR,'Invalid balloonnor')o.Metadata.BALLOONEXP=v(O[1],o.Metadata.BALLOONEXP,'Invalid balloonexp')o.Metadata.BALLOONMAS=v(O[1],o.Metadata.BALLOONMAS,'Invalid balloonmas')local R=tonumber(o.Metadata.STYLE)if R then r(O[1],Taiko.Data.StyleName[R],'Invalid style id',Taiko.Data.STYLE)o.Metadata.STYLE=R else o.Metadata.STYLE=r(O[1],Taiko.Data.StyleId[string.lower(o.Metadata.STYLE)],'Invalid style name',o.Metadata.STYLE)end;o.Metadata.EXAM1=w(o.Metadata.EXAM1)o.Metadata.EXAM2=w(o.Metadata.EXAM2)o.Metadata.EXAM3=w(o.Metadata.EXAM3)o.Metadata.GAUGEINCR=string.lower(o.Metadata.GAUGEINCR)if o.Metadata.TOTAL then o.Metadata.TOTAL=q(O[1],o.Metadata.TOTAL,'Invalid total')end;o.Metadata.HIDDENBRANCH=s(O[1],o.Metadata.HIDDENBRANCH,'Invalid hiddenbranch')I.bpm=o.Metadata.BPM;I.songstarted=true end elseif O[1]=='END'then if I.songstarted then if#I.currentmeasure~=0 then ParseError(O[1],'Current measure is not empty')end;table.insert(n,o)o={Metadata=Table.Clone(o.OriginalMetadata),Data={}}I=J()I.songstarted=false;I.measurepushto=o.Data else ParseError(O[1],'Song has already ended')end elseif O[1]=='MEASURE'then local P,Q=z(O[2])P=q(O[1],P,'Invalid measure')Q=q(O[1],Q,'Invalid measure')I.sign=(P/Q)or I.sign elseif O[1]=='BPMCHANGE'then I.bpm=q(O[1],O[2],'Invalid bpmchange')or I.bpm elseif O[1]=='DELAY'then local P=SToMs((q(O[1],O[2],'Invalid delay')or 0))I.delay=I.delay+P;table.insert(I.currentmeasure,{'DELAY',P})elseif O[1]=='SCROLL'then if I.disablescroll then else if l and C(O[2])then local P=D(O[2])I.scrollx=-P[1]I.scrolly=-P[2]elseif l and F(O[2])then local P=u(O[1],O[2],'Invalid polar scroll')if#P==3 then local Q=G(P[1],math.rad(P[3]/P[2]*360))I.scrollx=-Q[1]I.scrolly=-Q[2]else ParseError(O[1],'Invalid polar scroll')end else I.scrollx=- (q(O[1],O[2],'Invalid scroll')or-I.scrollx)I.scrolly=0 end;I.scroll=-I.scrollx;if I.scroll==0 and I.scrollx==0 and I.scrolly==0 then ParseError(O[1],'Scroll cannot be 0')end end elseif O[1]=='GOGOSTART'then I.gogo=true elseif O[1]=='GOGOEND'then I.gogo=false elseif O[1]=='BARLINEOFF'then I.barline=false elseif O[1]=='BARLINEON'then I.barline=true elseif O[1]=='BRANCHSTART'then if I.branch.on then I.endbranch()end;I.msbeforebranch=I.ms;I.branch.on=true;o.Metadata.DIVERGENOTES=true;local P=t(O[1],O[2])local Q=r(O[1],Taiko.Data.Branch.Requirements[string.lower(P[1])],'Invalid type',P[1])I.branch.requirements={Q}local R=2;while true do if not P[R]then break end;local S=Taiko.Data.Branch.PathName[R-1]if S then I.branch.requirements[S]=P[R]else break end;R=R+1 end elseif Taiko.Data.Branch.PathId[O[1]]then if I.branch.on then I.ms=I.msbeforebranch;I.currentbranch=O[1]I.branch.paths[O[1]]={}I.measurepushto=I.branch.paths[O[1]]else ParseError(O[1],'Branch has not started')end elseif O[1]=='BRANCHEND'then if I.branch.on then I.endbranch()else ParseError(O[1],'Branch has already ended')end elseif O[1]=='SECTION'then I.section=true elseif O[1]=='LYRIC'then elseif O[1]=='LEVELHOLD'then elseif O[1]=='BMSCROLL'then I.disablescroll=true;o.Metadata.STOPSONG=true elseif O[1]=='HBSCROLL'then o.Metadata.STOPSONG=true elseif O[1]=='SENOTECHANGE'then elseif O[1]=='NEXTSONG'then elseif O[1]=='DIRECTION'then local P=O[2]local Q=I.settings.directionweight;local R=0;local S=0;for i=1,#P do local W=string.sub(P,i,i)if Q[W]then R=R+Q[W]S=S+1 end end;if S==0 then ParseError(O[1],'Invalid direction')end;local T=R/S;local U=math.sqrt(I.scrollx^2 +I.scrolly^2)local V=G(U,math.rad(T))I.scrollx=-V[1]I.scrolly=-V[2]elseif O[1]=='SUDDEN'then local P=H(O[2])I.suddenappear=SToMs(q(P[1])or(I.suddenappear and MsToS(I.suddenappear)or 0))I.suddenmove=SToMs(q(P[2])or(I.suddenmove and MsToS(I.suddenmove)or 0))elseif O[1]=='JPOSSCROLL'then local P=false;local Q=H(O[2])local function R(S,T,U,V)if(l and y(T))or(V)then I.jposscroll.lanep=I.jposscroll.lanep or{0,0}if y(T)then local W,X=z(T)W=q(O[1],W,'Invalid jposscroll')X=q(O[1],X,'Invalid jposscroll')I.jposscroll.lanep[S]=(W/X)else I.jposscroll.lanep[S]=T end;if U then I.jposscroll.lanep[1]=I.jposscroll.lanep[1]* (r(O[1],U=='1'and 1 or U=='0'and-1,'Invalid jposscroll',U)or 1)end elseif l and T=='default'then I.jposscroll.p='default'else I.jposscroll.p=I.jposscroll.p or{0,0}I.jposscroll.p[1]=q(O[1],T,'Invalid jposscroll')if U then I.jposscroll.p[1]=I.jposscroll.p[1]* (r(O[1],U=='1'and 1 or U=='0'and-1,'Invalid jposscroll',U)or 1)end end end;if m then if C(Q[2])then local S,T=E(Q[2])R(1,S[1],nil,T[1])R(2,S[2],nil,T[2])P=true elseif F(Q[2])then local S=t(O[1],Q[2])if#S==3 then local T=false;if y(S[2])then T=true;local V,W=z(S[2])V=q(O[1],V,'Invalid polar jposscroll')W=q(O[1],W,'Invalid polar jposscroll')S[2]=(V/W)else S[2]=q(O[1],S[2],'Invalid polar jposscroll')end;S[1]=q(O[1],S[1],'Invalid polar jposscroll')S[3]=q(O[1],S[3],'Invalid polar jposscroll')local U=G(S[1],math.rad(S[3]/S[2]*360))R(1,U[1],nil,T)R(2,U[2],nil,T)P=true else ParseError(O[1],'Invalid polar jposscroll')end end else end;if P==false then R(1,Q[2],Q[3])end;I.jposscroll.lengthms=SToMs(q(O[1],Q[1],'Invalid jposscroll')or 0)table.insert(I.currentmeasure,{'JPOSSCROLL',I.jposscroll})I.jposscroll={}elseif l then if O[1]=='GAMEMODE'then elseif O[1]=='SPLITLANE'then elseif O[1]=='MERGELANE'then elseif O[1]=='BARLINE'then table.insert(I.measurepushto,I.createbarline())elseif O[1]=='DUMMYSTART'then I.dummy=true elseif O[1]=='DUMMYEND'then I.dummy=false elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]==''then elseif O[1]=='RESETCOMMAND'then end else end;N=true end end;if(I.songstarted)and N==false then I.mpm=I.bpm*I.sign/4;I.mspermeasure=60000 *I.sign*4 /I.bpm;if I.barline and I.insertbarline then table.insert(I.measurepushto,I.createbarline())I.insertbarline=false end;for i=1,#L do local O=string.sub(L,i,i)local P=tonumber(O)or O;if I.settings.noteparse.notes[P]then local Q=I.createnote(P)Q.data='note'table.insert(I.currentmeasure,Q)end end;if EndsWith(TrimRight(L),',')then I.mpm=I.bpm*I.sign/4;I.mspermeasure=60000 *I.sign*4 /I.bpm;if#I.currentmeasure==0 then I.ms=I.ms+I.mspermeasure elseif#I.currentmeasure==1 and I.currentmeasure[1].data=='event'and I.currentmeasure[1].event=='barline'then o.Data[#o.Data+1]=I.currentmeasure[1]I.ms=I.ms+I.mspermeasure else local O=0;local P=nil;for i=1,#I.currentmeasure do local S=I.currentmeasure[i]if S.data=='note'then P=P or S.mspermeasure;O=O+1 end end;P=P or I.mspermeasure;local Q=P/O;local R=false;for i=1,#I.currentmeasure do local S=I.currentmeasure[i]if S[1]=='DELAY'then I.ms=I.ms+S[2]elseif S[1]=='JPOSSCROLL'then R=S[2]else if not k or S.type~=0 then S.ms=I.ms;S.appearancems=S.appearancems and(S.ms- (S.appearancems))S.movems=S.movems and(S.ms- (S.movems))local T=I.measurepushto[#I.measurepushto]or o.Data[#o.Data]if T then T.nextnote=S end;table.insert(I.measurepushto,S)if S.onnotepush then S.onnotepush()end;Q=S.mspermeasure/O end;if R then S.jposscroll=R;R=false end;if S.data=='note'then I.ms=I.ms+Q end end end end;I.measuredone=true;I.currentmeasure={}if nextjposscroll then I.currentmeasure[#I.currentmeasure+1]=nextjposscroll end;I.insertbarline=true else I.measuredone=false end end end end;print('Parsing Took: '..SToMs(os.clock()-j)..'ms')return n end;function Taiko.SerializeTJA(h)local function j(u)return math.floor(u+0.5)end;local k=5;local l=10 ^k;local function m(u)return math.floor(u*l+0.5)/l end;local function n(u)if math.floor(u)~=u then return string.format('%f',u)else return tostring(u)end end;local function o(u,v)if u<v then return o(v,u)end;if math.abs(v)<0.001 then return u else return o(v,u-math.floor(u/v)*v)end end;local function p(u)local v=o(u,1)return j(u/v),j(1 /v)end;local function q(u)local v,w=string.match(u,'(%d+)/(%d+)')return v,w end;local function r(u)for i=1,#u do u[i]=tostring(u[i])end;return table.concat(u,',')end;local function s(u)local v={}local w={OFFSET=true,DEMOSTART=true}for F,G in pairs(u.Metadata)do local H;if type(G)=='number'then if w[F]then H=tostring(MsToS(tonumber(G)))else H=tostring(G)end elseif type(G)=='table'then H=r(G)elseif type(G)=='string'then H=tostring(G)else H=nil end;if H then v[#v+1]=F;v[#v+1]=':'v[#v+1]=H;v[#v+1]='\n'end end;v[#v+1]='\n\n'local x=false;local y=false;local z=u.Metadata.HEADSCROLL;for i=1,#u.Data do local F=u.Data[i]F.ms=F.ms-F.delay;if F.data=='event'and F.event=='barline'then x=true end;if F.delay and F.delay~=0 then y=true end;if F.scroll and F.scroll~=z then z=false end end;if y then if z then v[#v+1]='#BMSCROLL\n'else v[#v+1]='#HBSCROLL\n'end end;v[#v+1]='#START\n'if x then v[#v+1]='#BARLINEON\n'else v[#v+1]='#BARLINEOFF\n'end;local A={startms=nil}local B=nil;local C=0;local D={scroll=0,bpm=u.Metadata.BPM,measure=nil,gogo=false,delay=0}local E={scroll={'#SCROLL ',nil,function(F)local G=F.scroll/u.Metadata.HEADSCROLL;if G~=D.scroll then D.scroll=G;return tostring(G)end end},bpm={'#BPMCHANGE ',tostring(u.Metadata.BPM),function(F)local G=F.bpm;if G~=D.bpm then D.bpm=G;return tostring(G)end end},measure={'#MEASURE ',false,function(F)local G,H=p(F.bpm*F.mspermeasure/240000)local I=G..'/'..H;if I~=D.measure then D.measure=I;return I end end},gogo={'#GOGO',false,function(F)local G=F.gogo;if G~=D.gogo then D.gogo=G;if G then return'START'else return'END'end end end},delay={'#DELAY ',nil,function(F)if F.delay~=D.delay then local G=F.delay-D.delay;D.delay=F.delay;return n(MsToS(G))end end}}for i=1,#u.Data do local F=u.Data[i]local G=F.ms;if F.data=='note'then A[#A+1]=F elseif F.data=='event'and F.event=='barline'then A.startms=F.ms;A[#A+1]=F end;local H=u.Data[i+1]if(H and H.data=='event'and H.event=='barline')or(i==#u.Data)then if#A==0 then error('No barline')else local I={}for i=2,#A do local M=A[i-1]local N=A[i]I[#I+1]=math.abs(N.ms-M.ms)end;I[#I+1]=math.abs((A.startms+A[1].mspermeasure)-A[#A].ms)local J=I[1]for i=2,#I do J=o(J,I[i])end;if J==nil then error('gcd invalid, probably delay')J=A[1]and(A[1].ms-C)end;local K=A.startms;local L=K+A[1].mspermeasure;for i2=1,#A do local M=A[i2]for N,O in pairs(E)do if M[N]==O[2]then else local P=O[3](M)if P then O[2]=P;if v[#v]~='\n'then v[#v+1]='\n'end;v[#v+1]=O[1]v[#v+1]=P;v[#v+1]='\n'end end end;if i2 ~=1 then v[#v+1]=tostring(M.type)end;if i2 ==1 and#A~=1 then v[#v+1]=string.rep('0',( (A[i2 +1]and A[i2 +1].ms or L)-M.ms)/J)else v[#v+1]=string.rep('0',( (A[i2 +1]and A[i2 +1].ms or L)-M.ms)/J-1)end end;v[#v+1]=','v[#v+1]='\n'A={}end end end;if v[#v]~='\n'then v[#v+1]='\n'end;v[#v+1]='\n#END'return table.concat(v)end;local t={'// Automatically Serialized by Taiko.SerializeTJA'}for u,w in pairs(h)do t[#t+1]=s(w)return table.concat(t,'\n\n')end;t=table.concat(t,'\n\n')return t end;function Taiko.Score(h,j,k,l,m)if l==0 then k=0 else k=k+1 end;local n=h.Metadata;return Taiko.Data.ScoreMode.Note[n.SCOREMODE](j,k,n.SCOREINIT,n.SCOREDIFF,l,m),k end;function Taiko.Analyze(h)local j='M'local k={[1]=2,[2]=2,[3]=3,[4]=3}local l={notes={n=0,validn=0},measures=0,lengthms=0,drumrollms=0,drumrollbigms=0,balloonms=0,balloonhit=0,specialms=0,specialhit=0,maxcombo=0,maxscore=0}local m=nil;Taiko.ForAll(h.Data,function(o,p,q)if o.data=='note'then l.notes.n=l.notes.n+1;l.notes[o.type]=l.notes[o.type]and l.notes[o.type]+1 or 1;if k[o.type]then l.maxscore,l.maxcombo=Taiko.Score(h,l.maxscore,l.maxcombo,k[o.type],o.gogo)end;local r=o.endnote;if r then local s=r.ms-o.ms;if o.type==5 then l.drumrollms=l.drumrollms+s elseif o.type==6 then l.drumrollbigms=l.drumrollbigms+s elseif o.type==7 then l.balloonms=l.balloonms+s;l.balloonhit=l.balloonhit+o.requiredhits elseif o.type==9 then l.specialms=l.specialms+s;l.specialhit=l.specialhit+o.requiredhits else end end;m=o elseif o.data=='event'and o.event=='barline'then l.measures=l.measures+1 else end end,j)l.lengthms=m.ms-h.Metadata.OFFSET;l.notes.validn=l.maxcombo;return l end;function Taiko.GetDifficulty(h,j)local k=Taiko.Data.CourseId[string.lower(j)]or j;for l,m in pairs(h)do if m.Metadata.COURSE==k then return m end end;Error('No difficulty found, '..j)return nil end;function Taiko.ForAll(h,j,k)local l=1;for i=1,#h do local m=h[i]if m.branch then if k then local o=m.branch.paths[k]for i2=1,#o do j(o[i2],i2,l)l=l+1 end;l=l-1 else local o=-1;for p,q in pairs(m.branch.paths)do local r=l;for i2=1,#q do j(q[i2],i2,r)r=r+1 end;o=(o<r)and r or o end;l=o end else j(m,i,l)end;l=l+1 end;return h end;function Taiko.GetAllNotes(h)local j={}for l,m in pairs(h)do if m.branch then for n,o in pairs(m.branch.paths)do for i=1,#o do table.insert(j,o[i])end end else table.insert(j,m)end end;return j end;function Taiko.ConnectNotes(h)local j=nil;for i=#h,1,-1 do local k=h[i]k.nextnote=j;j=k end;return h end;function Taiko.ExtractBranch(h,j)return h.branch.paths[j]end;function Taiko.ConnectAll(h)local j=nil;for i=#h,1,-1 do local k=h[i]if k.branch then for l,m in pairs(k.branch.paths)do local n=Taiko.ConnectNotes(m)n[#n].nextnote=j end else k.nextnote=j end;j=k end end;function Taiko.CalculateSpeed(h,j)local k=(j*h.scrollx*h.bpm/7500)local l=(j*h.scrolly*h.bpm/7500)return{k,l}end;function Taiko.CalculateSpeedAll(h,j)for i=1,#h do h[i].speed=Taiko.CalculateSpeed(h[i],j)end;return h end;function Taiko.RenderScale(h)local j={}local k={}local l={}for i=1,#h.Data do local p=h.Data[i]if p.data=='note'then local q=math.floor(p.ms)if math.floor(q)-q==0 then table.insert(j,{q,p.type})table.insert(k,q)else table.insert(l,i)end end end;function gcd2(p,q)if q==0 then return p else return gcd2(q,p%q)end end;function gcdn(p)local q=p[1]for i=2,#p do q=gcd2(q,p[i])end;return q end;local m=gcdn(k)for i=1,#l do local p=j[l[i]]p[1]=math.floor(p[1]/m)*m end;local n=''local o=0;for i=1,#j do j[i][1]=j[i][1]/m;n=n..string.rep(' ',j[i][1]-o)..j[i][2]o=j[i][1]end;return n end;function Taiko.PlaySong(h,j,k,l)local m=true;local n=nil;local o=k or{}local p={auto={[1]=false,[2]=true},notespeedmul={[1]=1,[2]=2,[3]=3,[4]=4,[5]=0.25,[6]=0.5,[7]=0.75},songspeedmul={[1]=1,[2]=2,[3]=3,[4]=4,[5]=0.25,[6]=0.5,[7]=0.75}}local q=p.auto[o[2]]or false;local r={[1]=1,[2]=2,[3]=1,[4]=2}local s=p.notespeedmul[o[3]]or 1;local t=p.songspeedmul[o[4]]or 1;local u=h.Metadata.STOPSONG;local v=true;local w=Controls2 or{}w={Hit=w.Hit or{[rl.KEY_FOUR]=2,[rl.KEY_V]=1,[rl.KEY_N]=1,[rl.KEY_EIGHT]=2},Escape=w.Escape or{[rl.KEY_ESCAPE]=true},L=w.L or{[rl.KEY_LEFT]=true,[rl.KEY_UP]=true},R=w.R or{[rl.KEY_RIGHT]=true,[rl.KEY_DOWN]=true},Select=w.Select or{[rl.KEY_ENTER]=true}}local x=l or{}x={Hit=x.Hit or{['4']=2,['v']=1,['n']=1,['8']=2},Escape=x.Escape or{['\27']=true,ALT_ESC=true},L=x.L or{KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_A2=true},R=x.R or{KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true},Select=x.Select or{KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true}}local z=1;local A=2;local B='>'local C='\n\n\n'local D;if m then D=1600 else D=160 end;local E=D;local F=D/16 *9;local G=1 /16 *D;local H=5 /16 *D;local I=1000;local J=1 /40 *D;local K=0 *D;local L=1 /16 *D;local M=0 *D;local N={3 /40 *D,0}N[1]=1 /4 *D;local O=200;local P=O/4;local Q=1 /40 *D;local R=20;local S={[1]={color='red'},[2]={color='blue'},[3]={color='red'},[4]={color='blue'},[5]={color='yellow'},[6]={color='yellow'},[7]={color='cyan'}}local T=M+D;local U;if m then U={0,-F/2,E,F/2}else U={M,-L*2,T,L*2}end;local V={U[1]-G,U[2]-G,U[3]+G,U[4]+G}local W={U[1]-H,U[2]-H,U[3]+H,U[4]+H}local function X(Ub)return math.floor(Ub+0.5)end;local function Y(Ub)return Ub- (math.floor(Ub/360)*360)end;local function Z(Ub)return(Ub.data=='note')or(Ub.data=='event'and Ub.event=='barline')end;local function ab(Ub,Vb,Wb,Xb,Yb,Zb)return Wb<=Ub and Ub<=Yb and Xb<=Vb and Vb<=Zb end;local function bb(Ub,Vb,Wb,Xb,Yb,Zb,ac,bc)Yb,Zb,ac,bc=Yb-Ub,Zb-Vb,ac-Ub,bc-Vb;local cc=Xb/Wb;if Xb<0 then local dc,ec=Zb/cc,Zb;if Yb<=dc and dc<=ac then return dc,ec end else local dc,ec=bc/cc,bc;if Yb<=dc and dc<=ac then return dc,ec end end;if Wb<0 then local dc,ec=Yb,Yb*cc;if Zb<=ec and ec<=bc then return dc,ec end else local dc,ec=ac,ac*cc;if Zb<=ec and ec<=bc then return dc,ec end end;return nil end;local function cb(Ub,Vb)local Wb,Xb=bb(N[1],N[2],-Ub.scrollx,-Ub.scrolly,V[1],V[2],V[3],V[4])return Vb- (Wb~=0 and Wb/-Ub.speed[1]or Xb/-Ub.speed[2])end;local function db(Ub,Vb)return N[1]+ (-Ub.speed[1]* (Ub.ms-Vb-Ub.delay)), (N[2]- (Ub.speed[2]* (Ub.ms-Vb-Ub.delay)))end;local eb=Taiko.GetAllNotes(h.Data)local fb=h.Metadata.OFFSET;local gb=1000 /60;local hb=h.Metadata.TIMING(gb/t)local ib={}for Ub,Vb in pairs(eb)do Vb.ms=Vb.oms or Vb.ms;Vb.oms=Vb.ms;Vb.ms=(Vb.ms-fb)/t;Vb.s=MsToS(Vb.ms)Vb.delay=Vb.odelay or Vb.delay;Vb.odelay=Vb.delay;Vb.p={}Vb.delay=Vb.delay/t;Vb.speed=Taiko.CalculateSpeed(Vb,J)Vb.speed[1]=Vb.speed[1]*s;Vb.speed[2]=Vb.speed[2]*s;Vb.loadms=cb(Vb,Vb.ms)Vb.loads=MsToS(Vb.loadms)Vb.hit=nil;ib[#ib+1]=Vb.ms end;if u then for Xb,Yb in pairs(h.Data)do if Yb.branch then for Zb,ac in pairs(Yb.branch.paths)do table.sort(ac,function(bc,cc)return bc.ms<cc.ms end)end end end;table.sort(h.Data,function(Xb,Yb)if Xb.branch and Yb.branch then for Zb,ac in pairs(Xb.branch.paths)do for bc,cc in pairs(Yb.branch.paths)do return ac[1].ms<cc[1].ms end end elseif Xb.branch then for Zb,ac in pairs(Xb.branch.paths)do return ac[1].ms<Yb.ms end elseif Yb.branch then for Zb,ac in pairs(Yb.branch.paths)do return Xb.ms<ac[1].ms end else return Xb.ms<Yb.ms end end)local Ub=nil;local Vb=0;local Wb={}Taiko.ForAll(h.Data,function(Xb,Yb,Zb)if Xb.delay~=Vb then if Ub then Ub.stopms=Xb.delay-Ub.delay;Ub.stopstart=Ub.ms;Ub.stopend=Ub.stopstart+Ub.stopms end;Vb=Xb.delay end;if Ub and Ub.delay~=0 then Ub.ms=Ub.ms-Ub.delay;Ub.s=MsToS(Ub.ms)Ub.loadms=cb(Ub,Ub.ms)Ub.loads=MsToS(Ub.loadms)Ub.ms=Ub.ms+Ub.delay;Ub.s=MsToS(Ub.ms)end;Ub=Xb end)end;for Ub,Vb in pairs(h.Data)do if Vb.branch then for Wb,Xb in pairs(Vb.branch.paths)do table.sort(Xb,function(Yb,Zb)return Yb.loadms<Zb.loadms end)end end end;table.sort(h.Data,function(Ub,Vb)if Ub.branch and Vb.branch then for Wb,Xb in pairs(Ub.branch.paths)do for Yb,Zb in pairs(Vb.branch.paths)do return Xb[1].loadms<Zb[1].loadms end end elseif Ub.branch then for Wb,Xb in pairs(Ub.branch.paths)do return Xb[1].loadms<Vb.loadms end elseif Vb.branch then for Wb,Xb in pairs(Vb.branch.paths)do return Ub.loadms<Xb[1].loadms end else return Ub.loadms<Vb.loadms end end)Taiko.ConnectAll(h.Data)Taiko.ForAll(h.Data,function(Ub,Vb,Wb)Ub.n=Wb end)local jb=I/t;local kb=ib[1]for i=1,#ib do if ib[i]>kb then kb=ib[i]end end;kb=kb+jb;local lb={}local mb={barline={},drumroll={},notes={}}local nb={}local ob=h.Data[1]local pb=ob.loads;local qb='M'local rb=0;local sb,tb,ub=h.Metadata.SCOREINIT,h.Metadata.SCOREDIFF,Taiko.Data.ScoreMode.Note[h.Metadata.SCOREMODE]local vb=0;local wb=false;local xb=nil;local yb=nil;local zb=nil;local Ab=Taiko.Data.ScoreMode.Balloon[h.Metadata.SCOREMODE]local Bb=Taiko.Data.ScoreMode.BalloonPop[h.Metadata.SCOREMODE]local Cb=nil;local Db=nil;local Eb=nil;local Fb=Taiko.Data.ScoreMode.Drumroll[h.Metadata.SCOREMODE]local Gb={startms=nil,status=nil}local Hb=nil;local Ib=nil;local Jb=nil;local Kb=0;local Lb=nil;local Mb=nil;local Nb={nil,nil}local Ob={nil,nil}local Pb={}local Qb={-1,nil}local Rb=0;local Sb=0;local Tb=true;if m then local Ub='Assets/'local function Vb()rl.CloseWindow()rl.CloseAudioDevice()end;local function Wb(Fc)return rl.LoadImage(Ub..Fc)end;rl.SetConfigFlags(rl.FLAG_VSYNC_HINT)rl.InitWindow(E,F,'Taiko')rl.SetExitKey(rl.KEY_NULL)local Xb,Yb=0,F/2;local Zb=Taiko.Data.BigNoteMul;local ac=54;local bc={N[1],N[2]}local cc={}local dc=require('texturemap')local ec={Notes=Wb('Graphics/5_Game/Notes.png'),Barlines={bar=Wb('Graphics/5_Game/Bar.png'),bar_branch=Wb('Graphics/5_Game/Bar_Branch.png')},Judges=Wb('Graphics/5_Game/Judge.png'),Balloon={Anim={[0]=Wb('Graphics/5_Game/11_Balloon/Breaking_0.png'),[1]=Wb('Graphics/5_Game/11_Balloon/Breaking_1.png'),[2]=Wb('Graphics/5_Game/11_Balloon/Breaking_2.png'),[3]=Wb('Graphics/5_Game/11_Balloon/Breaking_3.png'),[4]=Wb('Graphics/5_Game/11_Balloon/Breaking_4.png'),[5]=Wb('Graphics/5_Game/11_Balloon/Breaking_5.png')}}}local fc={Notes={target={0,0},[1]={1,0},[2]={2,0},[3]={3,0},[4]={4,0},drumrollnote={5,0},drumrollrect={6,0},drumrollend={7,0},DRUMROLLnote={8,0},DRUMROLLrect={9,0},DRUMROLLend={10,0},[7]={11,0}},Barlines={bar=nil,bar_branch=nil},Judges={great={0,0},good={0,1},bad={0,2},adlib={0,3}}}local gc={130,130}local hc={130,130}ec.Notes=dc.SplitUsingMap(ec.Notes,fc.Notes,gc,hc)ec.Notes.drumrollstart=rl.ImageCopy(ec.Notes.drumrollend)rl.ImageFlipHorizontal(ec.Notes.drumrollstart)ec.Notes.DRUMROLLstart=rl.ImageCopy(ec.Notes.DRUMROLLend)rl.ImageFlipHorizontal(ec.Notes.DRUMROLLstart)local ic=(J*2)/ (ac*2 /Zb)for Fc,Gc in pairs(ec.Notes)do rl.ImageResize(Gc,ic*Gc.width,ic*Gc.height)end;local jc,kc=ec.Notes.target.width,ec.Notes.target.height;local lc=rl.new('Rectangle',0,0,jc,kc)local mc=rl.new('Vector2',jc/2,kc/2)local nc,oc=Xb- (jc/2),Yb- (kc/2)local pc,qc=1,-1;ec.Notes=dc.ReplaceWithTexture(ec.Notes)for Fc,Gc in pairs(ec.Barlines)do rl.ImageResize(Gc,ic*Gc.width,ic*Gc.height)end;ec.Barlines=dc.ReplaceWithTexture(ec.Barlines)local rc,sc=ec.Barlines.bar.width,ec.Barlines.bar.height;local tc=rl.new('Rectangle',0,0,rc,sc)local uc=rl.new('Vector2',rc/2,sc/2)for Fc,Gc in pairs(ec.Balloon.Anim)do rl.ImageResize(Gc,ic*Gc.width,ic*Gc.height)end;ec.Balloon.Anim=dc.ReplaceWithTexture(ec.Balloon.Anim)local vc={90,60}local wc={90,60}ec.Judges=dc.SplitUsingMap(ec.Judges,fc.Judges,vc,wc)for Fc,Gc in pairs(ec.Judges)do rl.ImageResize(Gc,ic*Gc.width,ic*Gc.height)end;ec.Judges=dc.ReplaceWithTexture(ec.Judges)local xc=h.Metadata.WAVE;rl.InitAudioDevice()local yc;if xc then yc=rl.LoadMusicStream(h.Metadata.WAVE)end;Taiko.ForAll(h.Data,function(Fc,Gc,Hc)local Ic=Y(math.deg(math.atan2(-Fc.scrollx,-Fc.scrolly))-90)if Ic<90 or Ic>=270 then Fc.rotationr=Ic else Fc.rotationr=180 +Ic end;if Fc.type==3 or Fc.type==4 or Fc.type==6 then Fc.radiusr=Fc.radius/Zb else Fc.radiusr=Fc.radius or 1 end;if Fc.data=='event'and Fc.event=='barline'then Fc.type='bar'Fc.pr=rl.new('Rectangle',0,0,rc,sc)Fc.tcenter=rl.new('Vector2',uc.x*Fc.radiusr,uc.y*Fc.radiusr)else Fc.pr=rl.new('Rectangle',0,0,jc,kc)Fc.tcenter=rl.new('Vector2',mc.x*Fc.radiusr,mc.y*Fc.radiusr)end;Fc.pr.width=Fc.pr.width*Fc.radiusr;Fc.pr.height=Fc.pr.height*Fc.radiusr;if Fc.startnote then local Jc=Fc.startnote;if Jc.type==5 or Jc.type==6 then Fc.rotationr=Ic;Fc.drumrollrect=rl.new('Rectangle',0,0,0,0)Fc.drumrollrect2=rl.new('Rectangle',0,0,0,0)if Jc.type==5 then Jc.notetype='drumrollnote'Jc.recttype='drumrollrect'Jc.endtype='drumrollend'elseif Jc.type==6 then Jc.notetype='DRUMROLLnote'Jc.recttype='DRUMROLLrect'Jc.endtype='DRUMROLLend'end elseif Jc.type==7 then Fc.balloonrect=rl.new('Rectangle',0,0,0,0)end end end)local zc;local Ac,Bc={},{}local function Cc(Fc)if Bc[Fc]and(not Bc[Fc].hit)then local Gc=Bc[Fc]local Hc=Gc.type;local Ic=Ac[Fc]local Jc;local Kc=( (Hc==3 or Hc==4)and Taiko.Data.BigLeniency)or 1;if Ic< (hb.good)then Jc=( (Hc==3 or Hc==4)and 3)or 2;vb=vb+1 elseif Ic< (hb.ok*Kc)then Jc=1;vb=vb+1 elseif Ic< (hb.bad*Kc)then Jc=0;vb=0 else Jc=nil end;if Jc then rb=ub(rb,vb,sb,tb,Jc,Gc.gogo)Bc[Fc].hit=true;Gb={startms=zc,status=Jc}end end;if(Fc==1)and yb and(zc>yb and zc<zb)then rb=Ab(rb,xb.type,notegogo)end;if(Fc==1 or Fc==2)and Db and(zc>Db and zc<Eb)then rb=Fb(rb,Cb.type,notegogo)end end;local function Dc(Fc)local Gc=r[Fc.type]Ac[Gc]=0;Bc[Gc]=Fc;Cc(Gc)end;local Ec=os.clock()while true do rl.BeginDrawing()rl.ClearBackground(rl.RAYWHITE)rl.DrawFPS(10,10)rl.DrawRectangleLines(U[1]+Xb,U[2]+Yb,U[3]-U[1],U[4]-U[2],rl.RED)rl.DrawRectangleLines(V[1]+Xb,V[2]+Yb,V[3]-V[1],V[4]-V[2],rl.GREEN)rl.DrawRectangleLines(W[1]+Xb,W[2]+Yb,W[3]-W[1],W[4]-W[2],rl.PURPLE)local Fc=os.clock()local Gc=Fc-Ec;zc=Gc*1000;if Jb and zc>Jb then Hb,Ib,Jb=nil,nil,nil end;if zb and zc>zb then xb,yb,zb=nil,nil,nil end;if Eb and zc>Eb then Cb,Db,Eb=nil,nil,nil end;if v then for i=1,#Pb do local Kc=Pb[i]if(Kc.jposscroll and(zc>=Kc.ms or unloadnow))then Lb=Kc.ms;Mb=Kc.ms+Kc.jposscroll.lengthms;if Kc.jposscroll.p=='default'then Nb[1]=(bc[1]-N[1])/Kc.jposscroll.lengthms;Nb[2]=(bc[2]-N[2])/Kc.jposscroll.lengthms else Nb[1]=( (Kc.jposscroll.p)and(Kc.jposscroll.p[1])or(Kc.jposscroll.lanep[1]*D))/Kc.jposscroll.lengthms;Nb[2]=( (Kc.jposscroll.p)and(Kc.jposscroll.p[2])or(Kc.jposscroll.lanep[2]*D))/Kc.jposscroll.lengthms end;Ob[1]=N[1]Ob[2]=N[2]table.remove(Pb,i)break end end;if Mb and zc>Mb then local Kc=Mb-Lb;N[1]=Ob[1]+ (Nb[1]*Kc)N[2]=Ob[2]+ (Nb[2]*Kc)Lb,Mb=nil,nil end end;if ob then while true do if ob and ob.loadms<zc+Kb then lb[#lb+1]=ob;if ob.endnote then lb[#lb+1]=ob.endnote end;ob=ob.nextnote;if ob then if ob.startnote then ob=ob.nextnote end;if ob and ob.branch then ob=ob.branch.paths[qb][1]end end else break end end else if zc>kb then break end end;if Lb and zc>=Lb then N[1]=Ob[1]+ (Nb[1]* (zc-Lb))N[2]=Ob[2]+ (Nb[2]* (zc-Lb))end;local Hc=N[1]-bc[1]local Ic=N[2]-bc[2]cc[1]=W[1]+Hc;cc[2]=W[2]+Ic;cc[3]=W[3]+Hc;cc[4]=W[4]+Ic;rl.DrawTexture(ec.Notes.target,X(N[1]*pc)+nc,X(N[2]*qc)+oc,rl.WHITE)Ac={}Bc={}mb={barline={},drumroll={},balloon={},notes={}}local Jc=0;for i=1,#lb do local Kc=i+Jc;local Lc=lb[Kc]if Lc then if not(Lc.hit)and Lc.data=='note'then if(Lc.type==1 or Lc.type==3)and(not Ac[1]or math.abs(zc-Lc.ms)<Ac[1])then Ac[1]=math.abs(zc-Lc.ms)Bc[1]=Lc elseif(Lc.type==2 or Lc.type==4)and(not Ac[2]or math.abs(zc-Lc.ms)<Ac[2])then Ac[2]=math.abs(zc-Lc.ms)Bc[2]=Lc end end;local Mc,Nc=db(Lc,Hb or(zc+Kb))Lc.p[1]=Mc*pc;Lc.p[2]=Nc*qc;if zc>Lc.ms then wb=Lc.gogo;if Lc.type==7 then if xb then if xb.n==Lc.n then Lc.p[1]=N[1]Lc.p[2]=N[2]else end end;xb=Lc;yb=Lc.ms;zb=Lc.ms+Lc.length elseif Lc.type==5 or Lc.type==6 then Cb=Lc;Db=Lc.ms;Eb=Lc.ms+Lc.length end end;Lc.pr.x=X(Lc.p[1])+Xb;Lc.pr.y=X(Lc.p[2])+Yb;if u and Lc.stopstart and zc>Lc.stopstart then Hb=Kb+Lc.stopstart;stopms=Lc.stopms;Kb=Kb-Lc.stopms;Ib=Lc.stopstart;Jb=Lc.stopend;Lc.stopstart=nil end;if q then if not Lc.hit and r[Lc.type]and zc>=Lc.ms then Dc(Lc)end end;if(v)and Lc.jposscroll and(not Lc.jposscrolldone)then Pb[#Pb+1]=Lc;Lc.jposscrolldone=true end;if(Lc.hit and not(u and Lc.stopstart and not(zc>Lc.stopstart)))or(zc>Lc.ms and ab(Lc.p[1],Lc.p[2],cc[1],cc[2],cc[3],cc[4])==false)then Lc.done=true;table.remove(lb,Kc)Jc=Jc-1 else if Lc.data=='event'then if Lc.event=='barline'then mb.barline[#mb.barline+1]=Lc end else if Lc.type==8 then mb.drumroll[#mb.drumroll+1]=Lc elseif Lc.type==7 then mb.balloon[#mb.balloon+1]=Lc else mb.notes[#mb.notes+1]=Lc end end end end end;if q then local Kc=Ac[1]local Lc=Ac[2]local Mc=(Kc and Lc)and( (Kc<Lc)and 1 or 2)or(Kc and 1 or 2)local Nc=Ac[Mc]local Oc=Bc[Mc]if not Nc or(Nc and Nc> (hb.bad* ( ( (Oc.type==3 or Oc.type==4)and Taiko.Data.BigLeniency)or 1)))then if yb and(zc>yb and zc<zb)then Cc(1)elseif Db and(zc>Db and zc<Eb)then Cc(1)end end end;for Kc,Lc in pairs(w.Hit)do if rl.IsKeyPressed(Kc)then Cc(Lc)end end;nb=mb.barline;table.sort(mb.drumroll,function(Kc,Lc)return Kc.p[1]>Lc.p[1]end)table.sort(mb.notes,function(Kc,Lc)return Kc.p[1]>Lc.p[1]end)for i=1,#mb.drumroll do nb[#nb+1]=mb.drumroll[i]end;for i=1,#mb.notes do nb[#nb+1]=mb.notes[i]end;for i=1,#mb.balloon do nb[#nb+1]=mb.balloon[i]end;for i=1,#nb do local Kc=nb[i]if Kc then if not Kc.hit then local Lc=( (notetype==3 or notetype==4)and Taiko.Data.BigLeniency)or 1;if(Kc.type==1 or Kc.type==2 or Kc.type==3 or Kc.type==4)and zc-Kc.ms> (hb.bad*Lc)then vb=0 end;if Tb then if Kc.data=='event'then if Kc.event=='barline'then rl.DrawTexturePro(ec.Barlines[Kc.type],tc,Kc.pr,Kc.tcenter,Kc.rotationr,rl.WHITE)end elseif Kc.data=='note'then if ec.Notes[Kc.type]then rl.DrawTexturePro(ec.Notes[Kc.type],lc,Kc.pr,Kc.tcenter,Kc.rotationr,rl.WHITE)elseif Kc.type==8 then local Mc=Kc.startnote;if Mc.type==5 or Mc.type==6 then local Nc=J*Kc.radius;local Oc,Pc=Mc.p[1],Kc.p[1]local Qc,Rc=Mc.p[2],Kc.p[2]if X(Pc-Oc)~=0 or X(Rc-Qc)~=0 then local Sc=Mc.scrollx>0;local Tc=Mc.scrolly<=0;local Uc=ec.Notes.drumrollrect.width;local Vc=ec.Notes.drumrollrect.height;local Wc=math.sqrt((Pc-Oc)^2 + (Rc-Qc)^2)local Xc=(Pc-Oc)/Wc;local Yc=(Rc-Qc)/Wc;local Zc=Uc*Xc;local ad=Uc*Yc;local bd=Kc.tcenter.x*Xc;local cd=Kc.tcenter.y*Yc;Pc=Pc-bd;Rc=Rc-cd;Wc=math.sqrt((Pc-Oc)^2 + (Rc-Qc)^2)local dd=math.floor(Wc/Uc)local ed=Wc- (dd*Uc)local fd=ed*Xc;local gd=ed*Yc;Kc.drumrollrect.width=Uc;Kc.drumrollrect.height=Vc;local hd=Oc+Xb+bd;local id=Qc+Yb+cd;for i=1,dd do Kc.drumrollrect.x=hd;Kc.drumrollrect.y=id;rl.DrawTexturePro(ec.Notes[Mc.recttype],lc,Kc.drumrollrect,Kc.tcenter,Kc.rotationr,rl.WHITE)hd=hd+Zc;id=id+ad end;Kc.drumrollrect.width=ed;Kc.drumrollrect.x=hd;Kc.drumrollrect.y=id;Kc.drumrollrect2.x=0;Kc.drumrollrect2.y=0;Kc.drumrollrect2.width=Kc.drumrollrect.width;Kc.drumrollrect2.height=Kc.drumrollrect.height;rl.DrawTexturePro(ec.Notes[Mc.recttype],Kc.drumrollrect2,Kc.drumrollrect,Kc.tcenter,Kc.rotationr,rl.WHITE)hd=hd+fd;id=id+gd;rl.DrawTexturePro(ec.Notes[Mc.endtype],lc,Kc.pr,Kc.tcenter,Kc.rotationr,rl.WHITE)end;rl.DrawTexturePro(ec.Notes[Mc.notetype],lc,Mc.pr,Mc.tcenter,Mc.rotationr,rl.WHITE)end end else error('Invalid note.data')end end end end end;rl.EndDrawing()if rl.WindowShouldClose()then rl.CloseWindow()break end end;return true else local Ub=j or{window=curses.initscr()}curses.keypad(Ub,true)curses.echo(false)curses.raw(true)curses.nl(false)curses.cbreak(true)curses.nodelay(Ub,true)local Vb={[0]={Data={[1]={'0','1','1','1','1','1','1','1'},[2]={[2]='1',[5]='1',[8]='1'},[3]={[2]='1',[5]='1',[8]='1'},[4]={[2]='1',[5]='1',[8]='1'},[5]={[2]='1',[5]='1',[8]='1'},[6]={[3]='1',[4]='1',[6]='1',[7]='1'},[8]={'0','0','1','1','1','1','1','1'},[9]={[2]='1',[5]='1'},[10]={[2]='1',[5]='1'},[11]={[2]='1',[5]='1'},[12]={[2]='1',[5]='1'},[13]={'0','0','1','1','1','1','1','1'},[15]={'0','1','1','1','1','1','1','1'},[16]={[2]='1',[8]='1'},[17]={[2]='1',[8]='1'},[18]={[2]='1',[8]='1'},[19]={[2]='1',[8]='1'},[20]={'0','0','1','1','1','1','1','0'}},Color={All='blue'},Offset={-1,0}},[1]={Data={[1]={'0','0','1','1','1','1','1','0'},[2]={[2]='1',[8]='1'},[3]={[2]='1',[8]='1'},[4]={[2]='1',[8]='1'},[5]={[2]='1',[8]='1'},[6]={'0','0','1','1','1','1','1','0'},[8]={'0','1','1','1','1','1','1','1'},[9]={[5]='1'},[10]={[4]='1',[6]='1'},[11]={[3]='1',[7]='1'},[12]={[2]='1',[8]='1'}},Color={All='white'},Offset={-1,0}},[2]={Data={[1]={'0','0','1','1','1','1','1','0'},[2]={[2]='1',[8]='1'},[3]={[2]='1',[8]='1'},[4]={[2]='1',[5]='1',[8]='1'},[5]={[2]='1',[5]='1',[8]='1'},[6]={'0','1','0','0','1','1','1','1'},[8]={'0','0','1','1','1','1','1','0'},[9]={[2]='1',[8]='1'},[10]={[2]='1',[8]='1'},[11]={[2]='1',[8]='1'},[12]={[2]='1',[8]='1'},[13]={'0','0','1','1','1','1','1','0'},[15]={'0','0','1','1','1','1','1','0'},[16]={[2]='1',[8]='1'},[17]={[2]='1',[8]='1'},[18]={[2]='1',[8]='1'},[19]={[2]='1',[8]='1'},[20]={'0','0','1','1','1','1','1','0'},[22]={'0','1','1','1','1','1','1','1'},[23]={[2]='1',[8]='1'},[24]={[2]='1',[8]='1'},[25]={[2]='1',[8]='1'},[26]={[2]='1',[8]='1'},[27]={'0','0','1','1','1','1','1','0'}},Color={All='yellow'},Offset={-1,0}},Size={27,8}}Vb[3]=Vb[2]local Wb={[0]=nil,[1]={},[2]={}}local Xb;os.execute('chcp 65001')Xb={}local Yb=([[
⠀ ⢀ ⠠ ⢠ ⠐ ⢐ ⠰ ⢰ ⠈ ⢈ ⠨ ⢨ ⠘ ⢘ ⠸ ⢸
⡀ ⣀ ⡠ ⣠ ⡐ ⣐ ⡰ ⣰ ⡈ ⣈ ⡨ ⣨ ⡘ ⣘ ⡸ ⣸
⠄ ⢄ ⠤ ⢤ ⠔ ⢔ ⠴ ⢴ ⠌ ⢌ ⠬ ⢬ ⠜ ⢜ ⠼ ⢼
⡄ ⣄ ⡤ ⣤ ⡔ ⣔ ⡴ ⣴ ⡌ ⣌ ⡬ ⣬ ⡜ ⣜ ⡼ ⣼
⠂ ⢂ ⠢ ⢢ ⠒ ⢒ ⠲ ⢲ ⠊ ⢊ ⠪ ⢪ ⠚ ⢚ ⠺ ⢺
⡂ ⣂ ⡢ ⣢ ⡒ ⣒ ⡲ ⣲ ⡊ ⣊ ⡪ ⣪ ⡚ ⣚ ⡺ ⣺
⠆ ⢆ ⠦ ⢦ ⠖ ⢖ ⠶ ⢶ ⠎ ⢎ ⠮ ⢮ ⠞ ⢞ ⠾ ⢾
⡆ ⣆ ⡦ ⣦ ⡖ ⣖ ⡶ ⣶ ⡎ ⣎ ⡮ ⣮ ⡞ ⣞ ⡾ ⣾
⠁ ⢁ ⠡ ⢡ ⠑ ⢑ ⠱ ⢱ ⠉ ⢉ ⠩ ⢩ ⠙ ⢙ ⠹ ⢹
⡁ ⣁ ⡡ ⣡ ⡑ ⣑ ⡱ ⣱ ⡉ ⣉ ⡩ ⣩ ⡙ ⣙ ⡹ ⣹
⠅ ⢅ ⠥ ⢥ ⠕ ⢕ ⠵ ⢵ ⠍ ⢍ ⠭ ⢭ ⠝ ⢝ ⠽ ⢽
⡅ ⣅ ⡥ ⣥ ⡕ ⣕ ⡵ ⣵ ⡍ ⣍ ⡭ ⣭ ⡝ ⣝ ⡽ ⣽
⠃ ⢃ ⠣ ⢣ ⠓ ⢓ ⠳ ⢳ ⠋ ⢋ ⠫ ⢫ ⠛ ⢛ ⠻ ⢻
⡃ ⣃ ⡣ ⣣ ⡓ ⣓ ⡳ ⣳ ⡋ ⣋ ⡫ ⣫ ⡛ ⣛ ⡻ ⣻
⠇ ⢇ ⠧ ⢧ ⠗ ⢗ ⠷ ⢷ ⠏ ⢏ ⠯ ⢯ ⠟ ⢟ ⠿ ⢿
⡇ ⣇ ⡧ ⣧ ⡗ ⣗ ⡷ ⣷ ⡏ ⣏ ⡯ ⣯ ⡟ ⣟ ⡿ ⣿]]):gsub('\n',' ')function GenerateDotData()function ToBinary(Cc)local Dc={}while Cc>0 do local Fc=math.fmod(Cc,2)Dc[#Dc+1]=string.sub(Fc,1,1)Cc=(Cc-Fc)/2 end;local Ec=string.reverse(table.concat(Dc))return string.rep('0',8 -#Ec)..Ec end;local function wc(Cc)return Cc end;local xc=Split(Yb,' ')local yc={}local zc=false;local Ac=''local Bc=' 'for i=1,#xc do yc[i-1]=wc(xc[i])end;return yc end;Xb.Data={}Xb.Data.Dot=GenerateDotData()Xb.ColorData={reset=0,clear=0,space=0,bright=1,bold=1,dim=2,faint=1,italic=3,underline=4,blink=5,reverse=7,invisible=8,hidden=8,strikethrough=9,black=30,red=31,green=32,yellow=33,blue=34,purple=35,magenta=35,cyan=36,white=37,onblack=40,onred=41,ongreen=42,onyellow=43,onblue=44,onpurple=45,onmagenta=45,oncyan=46,onwhite=47}Xb.Color={}for wc,xc in pairs(Xb.ColorData)do Xb.Color[wc]='\27['..xc..'m'end;local Zb,ac=U[1],U[3]local bc,cc=-U[4],-U[2]Xb.Convert={}Xb.Convert.ToDots=function(wc)local xc,yc=wc.Data,wc.Color;local zc={}local Ac=0;local Bc=Xb.Data.Dot[Ac]local Cc=nil;local Dc=nil;local Ec=Xb.Color['reset']if wc.Color.All then local Fc=Xb.Color[wc.Color.All]zc[#zc+1]=Fc;Dc=Fc end;if not bc then return''end;for y=cc,bc,-4 do for x=Zb,ac,2 do local Fc=xc[x]local Gc=xc[x+1]local Hc=(Fc and( (Fc[y]or 0)*128 + (Fc[y-1]or 0)*64 + (Fc[y-2]or 0)*32 + (Fc[y-3]or 0)*16)or 0)+ (Gc and( (Gc[y]or 0)*8 + (Gc[y-1]or 0)*4 + (Gc[y-2]or 0)*2 + (Gc[y-3]or 0))or 0)if Hc~=Ac then Hc=Xb.Data.Dot[Hc]if not Dc then local Ic=yc[x]local Jc=yc[x+1]local Kc=( (Ic)and(Ic[y]or Ic[y-1]or Ic[y-2]or Ic[y-3]))or( (Jc)and(Jc[y]or Jc[y-1]or Jc[y-2]or Jc[y-3]))if Kc then Kc=Xb.Color[Kc]else Kc=Ec end;if Cc==Kc then else zc[#zc+1]=Kc;Cc=Kc end end;zc[#zc+1]=Hc else zc[#zc+1]=Bc end end;zc[#zc+1]='\n'end;zc[#zc+1]=Ec;return table.concat(zc)end;Xb.ToDotsParallel=function(wc,xc)local yc,zc=wc.Data,wc.Color;local Ac,Bc=xc.Data,xc.Color;local Cc={}local Dc=0;local Ec=Xb.Data.Dot[Dc]local Fc=nil;local Gc=nil;local Hc=Xb.Color['reset']if wc.Color.All then local Ic=Xb.Color[wc.Color.All]Cc[#Cc+1]=Ic;Gc=Ic end;if not bc then return''end;for y=cc,bc,-4 do for x=Zb,ac,2 do local Ic=yc[x]local Jc=yc[x+1]local Kc=Ac[x]local Lc=Ac[x+1]local Mc=( (Ic and Kc)and( (Ic[y]or Kc[y]or 0)*128 + (Ic[y-1]or Kc[y-1]or 0)*64 + (Ic[y-2]or Kc[y-2]or 0)*32 + (Ic[y-3]or Kc[y-3]or 0)*16)or(Ic)and( (Ic[y]or 0)*128 + (Ic[y-1]or 0)*64 + (Ic[y-2]or 0)*32 + (Ic[y-3]or 0)*16)or(Kc)and( (Kc[y]or 0)*128 + (Kc[y-1]or 0)*64 + (Kc[y-2]or 0)*32 + (Kc[y-3]or 0)*16)or 0)+ ( (Jc and Lc)and( (Jc[y]or Lc[y]or 0)*8 + (Jc[y-1]or Lc[y-1]or 0)*4 + (Jc[y-2]or Lc[y-2]or 0)*2 + (Jc[y-3]or Lc[y-3]or 0))or(Jc)and( (Jc[y]or 0)*8 + (Jc[y-1]or 0)*4 + (Jc[y-2]or 0)*2 + (Jc[y-3]or 0))or(Lc)and( (Lc[y]or 0)*8 + (Lc[y-1]or 0)*4 + (Lc[y-2]or 0)*2 + (Lc[y-3]or 0))or 0)if Mc~=Dc then Mc=Xb.Data.Dot[Mc]if not Gc then local Nc=Bc[x]local Oc=Bc[x+1]local Pc=zc[x]local Qc=zc[x+1]local Rc=Pc and(Pc[y]or Pc[y-1]or Pc[y-2]or Pc[y-3])or Qc and(Qc[y]or Qc[y-1]or Qc[y-2]or Qc[y-3])or Nc and(Nc[y]or Nc[y-1]or Nc[y-2]or Nc[y-3])or Oc and(Oc[y]or Oc[y-1]or Oc[y-2]or Oc[y-3])if Rc then Rc=Xb.Color[Rc]else Rc=Hc end;if Fc==Rc then else Cc[#Cc+1]=Rc;Fc=Rc end end;Cc[#Cc+1]=Mc else Cc[#Cc+1]=Ec end end;Cc[#Cc+1]='\n'end;Cc[#Cc+1]=Hc;return table.concat(Cc)end;Xb.CircleGen=function(wc,xc,yc,zc,Ac)Ac=Ac or{}local Bc=Ac.color;local Cc=zc*zc;local Dc=zc;for y=0,zc do Dc=Dc+1;repeat Dc=Dc-1 until Dc*Dc+y*y<=Cc;for x2=0,Dc do wc.Data[xc+x2]=wc.Data[xc+x2]or{}wc.Data[xc-x2]=wc.Data[xc-x2]or{}wc.Data[xc+x2][yc+y]='1'wc.Data[xc-x2][yc+y]='1'wc.Data[xc+x2][yc-y]='1'wc.Data[xc-x2][yc-y]='1'wc.Color[xc+x2]=wc.Color[xc+x2]or{}wc.Color[xc-x2]=wc.Color[xc-x2]or{}wc.Color[xc+x2][yc+y]=Bc;wc.Color[xc-x2][yc+y]=Bc;wc.Color[xc+x2][yc-y]=Bc;wc.Color[xc-x2][yc-y]=Bc end end;return wc end;local dc={}Xb.Circle=function(wc,xc,yc,zc,Ac)local Bc=nil;if dc[zc]then else dc[zc]=Xb.CircleGen(Xb.New(),0,0,zc)end;local Cc=Ac and Ac.color;Bc=dc[zc]for Dc,Ec in pairs(Bc.Data)do for Fc,Gc in pairs(Ec)do local Hc,Ic=Dc+xc,Fc+yc;wc.Data[Hc]=wc.Data[Hc]or{}wc.Data[Hc][Ic]=Gc;wc.Color[Hc]=wc.Color[Hc]or{}wc.Color[Hc][Ic]=Cc end end;return wc end;Xb.New=function()return{Data={},Color={}}end;local function ec(wc,xc)local yc=math.floor(xc.p[1])local zc=math.floor(xc.p[2])local Ac,Bc=zc-L,zc+L;for y=Ac,Bc do wc.Data[yc]=wc.Data[yc]or{}wc.Data[yc][y]='1'end end;local function fc(wc,xc,yc)yc=yc or xc.p;Xb.Circle(wc,math.floor(yc[1]),math.floor(yc[2]),J*xc.radius,S[xc.type])end;local function gc(wc,xc,yc,zc,Ac,Bc)xc=math.floor(xc)yc=math.floor(yc)zc=math.floor(zc)Ac=math.floor(Ac)local Cc=Bc or{}color=Cc.color;for y=yc,Ac do for x=xc,zc do wc.Data[x]=wc.Data[x]or{}wc.Data[x][y]='1'if color then wc.Color[x]=wc.Color[x]or{}wc.Color[x][y]=color end end end end;local function hc(wc,xc,yc)local zc=xc.type;if zc==1 or zc==2 or zc==3 or zc==4 then fc(wc,xc)elseif zc==5 or zc==6 then elseif zc==7 then xc.radius=0.8;fc(wc,xc)elseif zc==8 then fc(wc,xc)local Ac=xc.startnote;fc(wc,Ac)local Bc=J*xc.radius;local Cc,Dc=math.floor(Ac.p[1]),math.floor(xc.p[1])fc(wc,Ac,xc.p)local Ec=math.floor(K-Bc)local Fc=math.floor(K+Bc)if yc then else if Cc>Dc then Cc,Dc=Dc,Cc end;if Cc<V[1]then Cc=V[1]end;if Dc>V[3]then Dc=V[3]end end;gc(wc,Cc,Ec,Dc,Fc,S[Ac.type])end end;local function ic(wc,xc,yc)local zc=Q/ (P/2)local Ac=-zc*math.abs(( (yc-xc.startms)/ (O/P))- (Q/zc))+Q;local Bc=Vb[xc.status]local Cc=Bc.Offset;local Dc=Bc.Color.All;local Ec,Fc=0,-math.floor(J*Taiko.Data.BigNoteMul)-8 -math.floor(Ac)local Gc,Hc=Cc[1]+Ec,Cc[2]+Fc;for x=1,Vb.Size[1]do for y=1,Vb.Size[2]do local Ic,Jc=x+Gc,y+Hc;wc.Data[Ic]=wc.Data[Ic]or{}wc.Data[Ic][-Jc]=Bc.Data[x]and Bc.Data[x][y]wc.Color[Ic]=wc.Color[Ic]or{}wc.Color[Ic][-Jc]=Dc end end end;local function jc(wc,xc)local yc=Wb[xc.status]local zc=yc.Offset;local Ac=yc.Color.All;local Bc,Cc=0,0;for Dc,Ec in pairs(yc.Data)do for Fc,Gc in pairs(Ec)do if Gc=='1'then local Hc,Ic=Dc+zc[1]+Bc,Fc+zc[2]+Cc;wc.Data[Hc]=wc.Data[Hc]or{}wc.Data[Hc][Ic]=Gc;wc.Color[Hc]=wc.Color[Hc]or{}wc.Color[Hc][Ic]=Ac end end end end;local kc={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(wc,xc)io.write(string.format("\27[%d;%dH",xc,wc))end}local lc=10;local mc=string.rep(' ',lc)local nc={}local function oc(wc,xc)nc[#nc+1]=wc;nc[#nc+1]=': 'nc[#nc+1]=tostring(xc)nc[#nc+1]=mc;nc[#nc+1]='\n'end;local function pc()print(table.concat(nc))nc={}end;local qc={}local function rc(wc)qc[#qc+1]=wc end;local function sc()print(table.concat(qc,'\n'))qc={}end;kc.ClearScreen()local tc=os.clock()local uc,vc;if n then uc=1 /n;vc=tc+uc end;while true do local wc=Xb.New()local xc=os.clock()local yc=xc-tc;local zc=yc*1000;if Jb and zc>Jb then Hb,Ib,Jb=nil,nil,nil end;if zb and zc>zb then xb,yb,zb=nil,nil,nil end;if Eb and zc>Eb then Cb,Db,Eb=nil,nil,nil end;if ob then while true do if ob and ob.loadms<zc+Kb then lb[#lb+1]=ob;if ob.endnote then lb[#lb+1]=ob.endnote end;ob=ob.nextnote;if ob then if ob.startnote then ob=ob.nextnote end;if ob and ob.branch then ob=ob.branch.paths[qb][1]end end else break end end else if zc>kb then break end end;Xb.Circle(wc,math.floor(N[1]),math.floor(N[2]),J,{color='purple'})local Ac={}local Bc={}local Cc=0;for i=1,#lb do local Hc=i+Cc;local Ic=lb[Hc]if Ic then if not(Ic.hit)and Ic.data=='note'then if(Ic.type==1 or Ic.type==3)and(not Ac[1]or math.abs(zc-Ic.ms)<Ac[1])then Ac[1]=math.abs(zc-Ic.ms)Bc[1]=Ic elseif(Ic.type==2 or Ic.type==4)and(not Ac[2]or math.abs(zc-Ic.ms)<Ac[2])then Ac[2]=math.abs(zc-Ic.ms)Bc[2]=Ic end end;local Jc,Kc=db(Ic,Hb or(zc+Kb))Ic.p[1]=Jc;Ic.p[2]=Kc;if zc>Ic.ms then wb=Ic.gogo;if Ic.type==7 then if xb then if xb.n==Ic.n then Ic.p[1]=N else end end;xb=Ic;yb=Ic.ms;zb=Ic.ms+Ic.length elseif Ic.type==5 or Ic.type==6 then Cb=Ic;Db=Ic.ms;Eb=Ic.ms+Ic.length end end;if u and Ic.stopstart and zc>Ic.stopstart then Hb=Kb+Ic.stopstart;stopms=Ic.stopms;Kb=Kb-Ic.stopms;Ib=Ic.stopstart;Jb=Ic.stopend;Ic.stopstart=nil end;if q then if not Ic.hit and r[Ic.type]and zc>=Ic.ms then local Lc;Lc=( (notetype==3 or notetype==4)and 3)or 2;vb=vb+1;if Lc then rb=ub(rb,vb,sb,tb,Lc,Ic.gogo)Ic.hit=true;Gb={startms=zc,status=Lc}end end end;if(Ic.hit and not(u and Ic.stopstart and not(zc>Ic.stopstart)))or ab(Ic.p[1],Ic.p[2],W[1],W[2],W[3],W[4])==false and(not(Ic.type==8 and zc<Ic.ms))then Ic.done=true;table.remove(lb,Hc)Cc=Cc-1 else if not Ic.hit then local Lc=( (notetype==3 or notetype==4)and Taiko.Data.BigLeniency)or 1;if(Ic.type==1 or Ic.type==2 or Ic.type==3 or Ic.type==4)and zc-Ic.ms> (hb.bad*Lc)then vb=0 end;if Tb then if Ic.data=='event'then if Ic.event=='barline'then ec(wc,Ic)end elseif Ic.data=='note'then hc(wc,Ic)else error('Invalid note.data')end end end end end end;if Gb.status then if zc>Gb.startms+O then Gb={}else ic(wc,Gb,zc,0)end end;kc.SetCursor(1,1)if n then local Hc=Xb.Convert.ToDots(wc)repeat until os.clock()>=vc;vc=vc+uc;print(Hc)else print(Xb.Convert.ToDots(wc))end;Rb=Rb+1;local Dc=os.clock()-xc;Sb=Sb+Dc;local Ec=curses.getch(Ub)local Fc=curses.getkeyname(Ec)local Gc=x.Hit[Fc]if q then local Hc=Ac[1]local Ic=Ac[2]local Jc=(Hc and Ic)and( (Hc<Ic)and 1 or 2)or(Hc and 1 or 2)local Kc=Ac[Jc]local Lc=Bc[Jc]if not Kc or(Kc and Kc> (hb.bad* ( ( (Lc.type==3 or Lc.type==4)and Taiko.Data.BigLeniency)or 1)))then if yb and(zc>yb and zc<zb)then Gc=1 elseif Db and(zc>Db and zc<Eb)then Gc=1 end end end;if Gc then if Ac[Gc]and(not Bc[Gc].hit)then local Hc=Bc[Gc]local Ic=Hc.type;local Jc=Ac[Gc]local Kc;local Lc=( (Ic==3 or Ic==4)and Taiko.Data.BigLeniency)or 1;if Jc< (hb.good)then Kc=( (Ic==3 or Ic==4)and 3)or 2;vb=vb+1 elseif Jc< (hb.ok*Lc)then Kc=1;vb=vb+1 elseif Jc< (hb.bad*Lc)then Kc=0;vb=0 else Kc=nil end;if Kc then rb=ub(rb,vb,sb,tb,Kc,Hc.gogo)Bc[Gc].hit=true;Gb={startms=zc,status=Kc}end end;if(Gc==1)and yb and(zc>yb and zc<zb)then rb=Ab(rb,xb.type,notegogo)end;if(Gc==1 or Gc==2)and Db and(zc>Db and zc<Eb)then rb=Fb(rb,Cb.type,notegogo)end end;if x.Escape[Fc]then local Hc=os.clock()kc.ClearScreen()curses.nodelay(Ub,false)local Ic={'Back','Retry','Back to Select'}while true do kc.SetCursor(1,1)local Jc={}for i=1,#Ic do Jc[i]=( (i==z)and(B..string.rep(' ',A-#B))or string.rep(' ',A))..Ic[i]end;print(table.concat(Jc,C))local Kc=curses.getch(Ub)local Lc=curses.getkeyname(Kc)if x.L[Lc]then z=z==1 and 1 or z-1 elseif x.R[Lc]then z=z==3 and 3 or z+1 elseif x.Select[Lc]then if z==1 then elseif z==2 then return'Retry'elseif z==3 then return nil end;break elseif x.Escape[Lc]then break end end;curses.nodelay(Ub,true)tc=tc+ (os.clock()-Hc)end;if Ec~=-1 then Qb={Ec,Fc}end;oc('Input (ascii)',Qb[1])oc('Input (key)',Qb[2])oc('S',yc)oc('Ms',zc)oc('Loaded',#lb)oc('Frames Rendered',Rb)oc('Last Frame Render (ms)',Dc*1000)oc('Frame Render Total (ms)',Sb*1000)oc('Frame Render Total (%)',Sb/yc*100)oc('FPS (Frame)',Rb/yc)oc('Stop Start',Ib or'')oc('Stop End',Jb or'')oc('Total Delay',Kb)oc('Score',rb)oc('Combo',vb)oc('Gogo',wb)oc('Drumroll Start',Db)oc('Drumroll End',Eb)pc()sc()end;return true end end;a='tja/neta/ekiben/neta.tja'a='tja/neta/ekiben/loadingtest2.tja'a='tja/neta/ekiben/updowntest.tja'a='tja/neta/ekiben/drumrolltest.tja'a='tja/saitama.tja'a='tja/neta/ekiben/neta.tja'a='tja/neta/ekiben/jposscrolltest.tja'Taiko.PlaySong(Taiko.GetDifficulty(Taiko.ParseTJA(io.open(a,'r'):read('*all')),'Oni'),nil,{[2]=2})error()function Taiko.SongSelect(h,j,k)local l={}local m,n=10,10;local o,p,q,r=-m,m,-n,n;local s=true;local t=1;local u=1;local v=4;local w=5;local x=5;local y=2;local z='V'local A='>'local B=10;local C=nil;local D='>'local E='>'local F=2;local G=true;local H='_Original_'local I=k or{}local J=false;local K={[2]={'Normal','Auto'},[3]={'Normal','2x Speed','3x Speed','4x Speed','0.25x Speed','0.5x Speed','0.75x Speed'},[4]={'Normal','2x Speed','3x Speed','4x Speed','0.25x Speed','0.5x Speed','0.75x Speed'},[5]={'Normal','Reverse','Invisible','Messy'}}local L={4,1,1,1,1,1}local M={nil}for ib,jb in pairs(K)do M[ib]={1,#jb,jb}end;local N={[1]=nil,[2]={function(ib)return ib,'type',ib.type and(Taiko.Data.Notes.ReverseNotes[ib.type]or ib.type)or ib.type end,function(ib)return ib,'type'end},[3]={function(ib)return ib,'scrollx',10000 end,function(ib)return ib,'scrollx'end},[4]={function(ib)return ib,'type',ib.type and(ib.type==1 and math.random(1,2)or ib.type==2 and math.random(1,2)or ib.type==3 and math.random(3,4)or ib.type==4 and math.random(3,4)or ib.type)end,function(ib)return ib,'type'end}}local O={window=curses.initscr()}curses.keypad(O,true)curses.echo(false)curses.raw(true)curses.nl(false)curses.cbreak(true)curses.nodelay(O,true)curses.getch(O)curses.nodelay(O,false)local P,Q=curses.cols(),curses.lines()C=C or P-2;local R={Escape={['\27']=true,ALT_ESC=true},Scroll={L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_A2=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true}},Select={Init={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},Select={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},Escape={['\27']=true,ALT_ESC=true},L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true},U={KEY_UP=true,KEY_A2=true},D={KEY_DOWN=true,KEY_C2=true},Play={Hit={['4']=2,['v']=1,['n']=1,['8']=2},Escape={['\27']=true,ALT_ESC=true},L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_DOWN=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true},Select={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true}}},Search={Init={ALT_F=true,f=true,F=true},Backspace={['\8']=true,KEY_BACKSPACE=true,ALT_BKSP,CTL_BKSP},FirstResult={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},Select={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true},Up={KEY_A2=true,KEY_UP=true},Down={KEY_C2=true,KEY_DOWN=true},Escape={['\27']=true,ALT_ESC=true}},Add={Init={ALT_N=true,n=true,N=true},Backspace={['\8']=true,KEY_BACKSPACE=true,ALT_BKSP,CTL_BKSP},Select={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true}},StandardInput={Backspace={['\8']=true,KEY_BACKSPACE=true,ALT_BKSP,CTL_BKSP},Escape={KEY_ENTER=true,PADENTER=true,CTL_PADENTER=true,ALT_PADENTER=true,CTL_PADCENTER=true,ALT_ENTER=true,CTL_ENTER=true,SHF_PADENTER=true,['\n']=true,['\r']=true},L={KEY_LEFT=true,KEY_SLEFT=true,CTL_LEFT=true,KEY_B1=true,ALT_LEFT=true,KEY_SHIFT_L=true,KEY_UP=true,KEY_DOWN=true},R={KEY_RIGHT=true,KEY_SRIGHT=true,CTL_RIGHT=true,KEY_B3=true,ALT_RIGHT=true,KEY_SHIFT_R=true,KEY_DOWN=true,KEY_C2=true}},Reload={Init={r=true}},ReloadAll={Init={R=true}},Rename={Init={KEY_F2=true}}}local S={ClearScreen=function()io.write("\27[2J")end,SetCursor=function(ib,jb)io.write(string.format("\27[%d;%dH",jb,ib))end,ClearLine=function()io.write("\27[2K")end,CursorLeft=function(ib)io.write(string.format("\27[%dD",ib))end,CursorRight=function(ib)io.write(string.format("\27[%dC",ib))end,SaveCursor=function()io.write("\27[s")end,RestoreCursor=function()io.write("\27[u")end}local function T(ib)return ib..string.rep(' ',C-#ib)end;local function U()local ib=curses.getch(O)local jb=curses.getkeyname(ib)return ib,jb end;local function V()local ib=''local jb=0;local kb=jb;while true do local lb,mb=U()if R.StandardInput.Backspace[mb]then ib=string.sub(ib,1,jb-1)..string.sub(ib,jb+1,-1)jb=jb-1 elseif R.StandardInput.Escape[mb]then io.write('\n')return ib elseif R.StandardInput.L[mb]then jb=jb-1 elseif R.StandardInput.R[mb]then jb=jb+1 else ib=string.sub(ib,1,jb)..mb..string.sub(ib,jb+1,-1)jb=jb+1 end;jb=ClipN(jb,0,#ib)local nb=jb-kb;if nb<0 then S.CursorLeft(-nb)elseif nb>0 then S.CursorRight(nb)end;S.SaveCursor()S.ClearLine()io.write('\r')io.write(ib)S.RestoreCursor()kb=jb end end;local function W(ib)return ib>=32 and ib<=126 end;local function X(ib,jb,kb,lb)return(ib and(jb..string.sub(kb,#jb+1,-1))or kb)..lb end;local function Y(ib,jb,kb)return ib>kb and jb or ib<jb and kb or ib end;local Z={[0]='No',[1]='Yes'}local function ab(ib)return ib and Z[1]or Z[0]end;local function bb(ib)return ib*100 ..'%'end;local function cb(ib)return MsToS(ib)..'s'end;local function db(ib)return cb(SToMs(ib))end;local function eb(ib)return tonumber(ib)and tonumber(ib)or 0 end;local function fb(ib,jb,kb)ib[H..jb]=ib[jb]ib[jb]=kb end;local function gb(ib,jb)ib[jb]=ib[H..jb]end;local hb={}S.ClearScreen()while true do l={}if s then l[o]={}for i=t-w,t+w do local mb=nil;if i<1 then mb=#h+i elseif i>#h then mb=i-#h else mb=i end;local nb=h[mb]if nb then l[0]=l[0]or{}l[0][(i-t)*x]=nb end end;local kb={}local lb=string.rep(' ',y)for y=q,r do kb[#kb+1]=X(y==0,A,lb,'')kb[#kb+1]=T(l[0]and l[0][y]or'')kb[#kb+1]='\n'end;S.SetCursor(1,1)print(table.concat(kb))else l[0]={}l[0][q]=z;for i=t-w,t+w do local lb=nil;if i<1 then lb=#h+i elseif i>#h then lb=i-#h else lb=i end;local mb=h[lb]if mb then local nb=(i-t)*x;l[nb]=l[nb]or{}local ob=q+y;for i2=1,#mb do l[nb][ob]=string.sub(mb,i2,i2)ob=ob+1 end end end;local kb={}for y=q,r do for x=o,p do if l[x]and l[x][y]then local lb=l[x][y]if W(string.byte(lb))then kb[#kb+1]=lb else kb[#kb+1]=' 'end else kb[#kb+1]=' 'end end;kb[#kb+1]='\n'end;S.SetCursor(1,1)print(table.concat(kb))end;local ib,jb=U()if R.Scroll.L[jb]then t=t-1 elseif R.Scroll.R[jb]then t=t+1 elseif R.Select.Init[jb]then local kb;if G then if hb[t]then kb=hb[t]else kb=Taiko.ParseTJA(j[t])hb[t]=kb end else kb=Taiko.ParseTJA(j[t])end;local lb={}for pb,qb in pairs(kb)do lb[#lb+1]={pb,qb.Metadata.COURSE}end;table.sort(lb,function(pb,qb)return pb[2]<qb[2]end)min=1;max=#lb;M[1]={min,max,lb}DifficultyMap=lb;L[1]=ClipN(L[1],min,max)local mb=string.rep(' ',F)S.ClearScreen()S.SetCursor(1,1)local nb=nil;local ob=u;while true do u=ClipN(u,1,5)if u~=ob then v=L[u]ob=u end;local pb=M[u]min,max=pb[1],pb[2]v=Y(v,min,max)L[u]=v;S.SetCursor(1,1)local qb=DifficultyMap[L[1]][2]nb=Taiko.GetDifficulty(kb,qb)local rb=nb.Metadata;local sb=Taiko.Analyze(nb)local tb={{'',rb.TITLE},{'\t',rb.SUBTITLE},{'',''},{'','Select Options:'},{X(u==1,E,mb,'Difficulty: '),Taiko.Data.CourseName[rb.COURSE]},{X(u==2,E,mb,'Mode: '),K[2][L[2]]},{X(u==3,E,mb,'Note Speed: '),K[3][L[3]]},{X(u==4,E,mb,'Song Speed: '),K[4][L[4]]},{X(u==5,E,mb,'Modifiers: '),K[5][L[5]]},{'',''},{'Difficulty: ',Taiko.Data.CourseName[rb.COURSE]},{'Stars: ',rb.LEVEL},{'Diverge Notes: ',ab(rb.DIVERGENOTES)},{'',''},{'','Statistics:'},{'Length: ',cb(sb.lengthms)},{'Don (DON) / Ka (KA): ',eb(sb.notes[1])..' + ('..eb(sb.notes[3])..') / '..eb(sb.notes[2])..' + ('..eb(sb.notes[4])..') = '..bb((eb(sb.notes[1])+eb(sb.notes[3]))/sb.notes.validn)..' / '..bb((eb(sb.notes[2])+eb(sb.notes[4]))/sb.notes.validn)},{'Max Score (without drumroll): ',sb.maxscore},{'Max Combo: ',sb.maxcombo},{'Drumroll Time (total): ',cb(sb.drumrollms+sb.drumrollbigms)},{'Balloon Time: ',cb(sb.balloonms)},{'Balloon Hits: ',sb.balloonhit},{'Special Time: ',cb(sb.specialms)},{'Special Hits: ',sb.specialhit},{'',''},{'','Press Enter to Play!'}}for i=1,#tb do local wb=tb[i]print(T(wb[1]..tostring(wb[2])))end;local ub,vb=U()if R.Select.L[vb]then v=v-1 elseif R.Select.R[vb]then v=v+1 elseif R.Select.U[vb]then u=u-1 elseif R.Select.D[vb]then u=u+1 elseif R.Select.Select[vb]then local wb=N[L[5]]if wb and wb[1]then local xb=wb[1]Taiko.ForAll(nb.Data,function(yb,zb,Ab)fb(xb(yb))end)end;while true do local xb,yb=Taiko.PlaySong(nb,O,L,R.Select.Play)if xb and yb then break elseif xb=='Retry'then else break end end;curses.nodelay(O,false)S.ClearScreen()if wb and wb[2]then local xb=wb[2]Taiko.ForAll(nb.Data,function(yb,zb,Ab)gb(xb(yb))end)end elseif R.Select.Escape[vb]then break end end elseif R.Search.Init[jb]then local kb=''local lb={}local mb=1;local nb=nil;local ob=1;S.ClearScreen()S.SetCursor(1,1)print('Searching...')while true do S.SetCursor(#kb+1,2)local pb,qb=U()S.SetCursor(1,2)if R.Search.Backspace[qb]then kb=string.sub(kb,1,-2)elseif R.Search.FirstResult[qb]then nb=lb[1]break elseif R.Search.Select[qb]then nb=lb[ob]break elseif R.Search.Down[qb]then ob=ob+1 elseif R.Search.Up[qb]then ob=ob-1 elseif R.Search.Escape[qb]then break else kb=kb..qb end;print(T(kb))local rb=e.SearchHeaderAll(h,kb)for i=1,B do if rb[i]and rb[i][2]==-math.huge then mb=i-1;break elseif i==B then mb=i end end;ob=ClipN(ob,1,mb)local sb=false;for i=1,B do local tb=rb[i]if sb then print(T(''))else if tb then if tb[2]==-math.huge then sb=true;print(T(''))else print(T((i==ob and D or i)..'. '..rb[i][3]))lb[i]=tb end end end end end;t=(nb and nb[1]or t)or t elseif R.Add.Init[jb]then print('Import a Custom Song')while true do print('Enter a .tja or .tjac file path (with the file extention)')local kb=V()local lb=io.open(kb,'rb')if lb then local mb=lb:read('*all')if EndsWith(kb,'.tja')then print('Enter a song name')local nb=V()local ob=#h+1;h[ob]=nb;j[ob]=mb;I[ob]={kb}break elseif EndsWith(kb,'.tjac')then local nb,ob=e.Decompress(mb)for i=1,#nb do local pb=#h+1;h[pb]=ob[i]j[pb]=nb[i]I[pb]={kb,nb}end;break else print('Invalid file type')end;lb:close()else print('Unable to read file')end end elseif R.Reload.Init[jb]then print('Reloading selected file...')if I[t]then local kb=I[t]local lb=io.open(kb[1],'rb')if lb then local mb=lb:read('*all')local nb=t;if kb[2]then local ob,pb=e.Decompress(mb)if J then h[nb]=pb[i]end;j[nb]=ob[i]else j[nb]=mb end;if G then hb[nb]=nil end;lb:close()else print('Unable to read file')end else print('File source not found')end elseif R.ReloadAll.Init[jb]then print('Reloading all files...')local kb={}for lb,mb in pairs(I)do kb[mb[1]]=kb[mb[1]]and kb[mb[1]]or{}kb[mb[1]][#kb[mb[1]]+1]={lb,mb[2]}end;for lb,mb in pairs(kb)do local nb=io.open(lb,'rb')if nb then local ob=nb:read('*all')if mb[1][2]then local pb,qb=e.Decompress(ob)for i=1,#mb do local rb=mb[i]if J then h[rb[1]]=qb[rb[2]]end;j[rb[1]]=pb[rb[2]]if G then hb[rb[1]]=nil end end else for i=1,#mb do local pb=mb[i]j[pb[1]]=ob;if G then hb[pb[1]]=nil end end end;nb:close()else print('Unable to read file')end end elseif R.Rename.Init[jb]then print('Enter a song name')local kb=V()h[t]=kb elseif R.Escape[jb]then return end;t=Y(t,1,#h)end end;function Taiko.Game()end;local f='./CompactTJA/taikobuipm.tjac'f='./CompactTJA/ESE/06 Classical.tjac'f='./CompactTJA/ESE/ESE.tjac'local function g(h)local j,k,l={},{},{}for i=1,#h do local m=h[i]j[#j+1]=m:gsub('(.-)/','')local n=io.open(m,'r')local o=n:read('*all')n:close()k[#k+1]=o;l[#l+1]=m end;return j,k,l end;Taiko.SongSelect(g({'./tja/neta/ekiben/spiraltest.tja','./tja/neta/ekiben/delay.tja','./tja/neta/ekiben/neta.tja','./tja/neta/kita/kita.tja','./taikobuipm/Kita Saitama 2000.tja'}))error()